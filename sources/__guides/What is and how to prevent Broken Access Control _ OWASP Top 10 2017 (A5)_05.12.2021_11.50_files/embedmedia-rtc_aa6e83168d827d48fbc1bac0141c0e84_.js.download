!function(){var w={WAITING_TIME_30:3e4,WAITING_TIME:6e4,RINGTONE_DURATION:65e3,WAITING_TIME_SECS:60,audio:"audio",video:"video",screen_share:"screen_share",screen_view:"screen_view",request_screen:"request_screen",audio_unified_mix:"audio_unified_mix",audio_smart:"audio_smart",screen_share_smart:"screen_share_smart",screen_view_smart:"screen_view_smart",data_channel:"data_channel",mic_permission_blocked:"mic_permission_blocked",screen_permission_blocked:"screen_permission_blocked",call_timer:"call_timer",waiting_timer:"waiting_timer",isAlreadySharing:"isAlreadySharing",0:"audio",2:"video",1:"screen_share",connecting:"connecting",connected:"connected",cancelled:"cancelled",sharing:"sharing",viewing:"viewing",facebookUrl:"https://facebook.com/pages",negotiation:"negotiation",offer:"offer",answer:"answer",height:"260",width:"400",reinit:"reinit",accept:"accept",miss:"miss",reject:"reject",end:"end",failed:"failed",request:"request",restart:"restart",candidates:"candidates",candidate:"candidate",screenshare:"screenshare",voicemessage:"voicemessage",upstream:"upstream",downstream:"downstream",incoming:"incoming",outgoing:"outgoing",ringing:"ringing",missed:"missed",rejected:"rejected",reconnecting:"reconnecting",requested:"requested",invited:"invited",ended:"ended",cancel:"cancel",visitor:"visitor",stopscreen:"stopscreen",click:"click",keyup:"keyup",stopsharing:"stopsharing",Zoho_SalesIQ:"Zoho_SalesIQ",window:"window",screen:"screen",Entire_Screen:"Entire Screen",desktop:"desktop",function:"function",requestscreensahre:"requestscreensahre",showConstent:"showConsent",call_initiate:"call_initiate",call_cancel:"call_cancel",call_miss:"call_miss",call_failed:"call_failed",invite:"invite",setCredential:"setCredential",handleInvitation:"handleInvitation",handleCallAccept:"handleCallAccept",handleCallReject:"handleCallReject",handleCandidates:"handleCandidates",handleCallAnswer:"handleCallAnswer",handleCallEnd:"handleCallEnd",handleCallOffer:"handleCallOffer",handleCallCancel:"handleCallCancel",handleCallMissed:"handleCallMissed",handleCallInvite:"handleCallInvite",handleCallRequest:"handleCallRequest",handleCallFailed:"handleCallFailed",audiocall:"audiocall",outgoingcall:"outgoingcall",incomingcall:"incomingcall",siq_directcall:"siq_directcall",siq_unifiedMedia:"siq_unifiedMedia",status:"status",is_refreshed:"is_refreshed",media_inv:"media_inv",https:"https",User_Agent:"User-Agent",disable:"disable",show:"show",hide:"hide",media_active:"media_active",requestCancelled:"requestCancelled",requestRejected:"requestRejected",requestMissed:"requestMissed",mediaCallDetails:"mediaCallDetails",mediaDetailsKeys:{wmsPushData:"wmsPushData",apiData:"apiData",callStatus:"callStatus",isCallInitiatedFromOldUI:"isCallInitiatedFromOldUI",isMobileOperator:"isMobileOperator"},chidMapList:"chidMapList",activity:{MEDIA_AUDIO_INITIATE:101,MEDIA_AUDIO_ACCEPT:102,MEDIA_AUDIO_OFFER:103,MEDIA_AUDIO_ANSWER:104,MEDIA_AUDIO_CONNECT:105,MEDIA_AUDIO_REJECT:106,MEDIA_AUDIO_CANCEL:107,MEDIA_AUDIO_END:108,MEDIA_AUDIO_MISS:109,MEDIA_AUDIO_UI_SHOWN:131,MEDIA_AUDIO_UI_CLEARED:132,MEDIA_AUDIO_INVITATION_SHOWN:133,MEDIA_AUDIO_INVITATION_CLEARED:134,MEDIA_AUDIO_OUTGOING_UI_SHOWN:135,MEDIA_AUDIO_OUTGOING_UI_CLEARED:136,MEDIA_AUDIO_INCOMING_SOUND_START:146,MEDIA_AUDIO_OUTGOING_SOUND_START:147,MEDIA_AUDIO_SOUND_STOP:148,MEDIA_AUDIO_MIC_PERMISSION_ALLOWED:149,MEDIA_AUDIO_MIC_PERMISSION_BLOCKED:150,MEDIA_AUDIO_INPUT_DEVICE_CHANGED:151,MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED:152,MEDIA_AUDIO_MUTE:161,MEDIA_AUDIO_UNMUTE:162,MEDIA_AUDIO_VOICE:163,MEDIA_AUDIO_START:164,MEDIA_AUDIO_RECONNECT_STATE:165,MEDIA_AUDIO_RENEGOTIATION_INITIATE:171,MEDIA_AUDIO_RENEGOTIATION_ACCEPT:172,MEDIA_AUDIO_RENEGOTIATION_CANCEL:173,MEDIA_AUDIO_RENEGOTIATION_REJECT:174,MEDIA_AUDIO_RENEGOTIATION_MISS:175,MEDIA_AUDIO_RENEGOTIATION_TRACKADDED:176,MEDIA_AUDIO_RENEGOTIATION_TRACKREMOVED:177,MEDIA_SCREENSHARE_INITIATE:201,MEDIA_SCREENSHARE_ACCEPT:202,MEDIA_SCREENSHARE_OFFER:203,MEDIA_SCREENSHARE_ANSWER:204,MEDIA_SCREENSHARE_CONNECT:205,MEDIA_SCREENSHARE_REJECT:206,MEDIA_SCREENSHARE_CANCEL:207,MEDIA_SCREENSHARE_END:208,MEDIA_SCREENSHARE_MISS:209,MEDIA_SCREENSHARE_UI_SHOWN:231,MEDIA_SCREENSHARE_UI_CLEARED:232,MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN:233,MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED:234,MEDIA_SCREENSHARE_POPUP_SHOWN:235,MEDIA_SCREENSHARE_POPUP_CLEARED:236,MEDIA_SCREENSHARE_PLAYER_SHOWN:237,MEDIA_SCREENSHARE_PLAYER_CLEARED:238,MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED:246,MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED:247,MEDIA_SCREENSHARE_SHARESCREEN:261,MEDIA_SCREENSHARE_REQUESTSCREEN:262,MEDIA_SCREENSHARE_RECONNECT_STATE:263,MEDIA_SCREENSHARE_SWAP:264,MEDIA_SCREENSHARE_RENEGOTIATION_REQUEST:271,MEDIA_SCREENSHARE_RENEGOTIATION_ACCEPT:272,MEDIA_SCREENSHARE_RENEGOTIATION_CANCEL:273,MEDIA_SCREENSHARE_RENEGOTIATION_REJECT:274,MEDIA_SCREENSHARE_RENEGOTIATION_MISS:275,MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED:276,MEDIA_SCREENSHARE_RENEGOTIATION_TRACKREMOVED:277},TURN_URL:["geo","primary","secondary","default"],error_code:{AUDIO_CALL_NOT_ALLOWED:5001,UNABLE_TO_INTIATE_CALL:5004,ALREADY_CLOSE_CONVERSATION:6104},iceConnectionStates:{CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},callMode:{P2P:"visitor",O2O:"operator",UNIFIED_P2P:"unifiedVisitor"},connectionType:{PEER2PEER:"p2p",UNIFIED:"unified",SMART:"smart"},audioCallAllowedBrowserVersions:{chrome:53,firefox:68,opera:40,safari:11,edge:79},screenShareAllowedBrowserVersions:{chrome:72,firefox:66,opera:60,safari:13,edge:79},consent_audioandscreen:"audio_call_and_screen_share",consent_recordingdisabled:'do_not_record"',consent_onlyaudio:"audio_call"};function R(e){try{return JSON.parse(e)}catch(e){}return i(e)?e:{}}function D(e){try{return JSON.stringify(e)}catch(e){}return""}function d(e){return"function"==typeof e}function i(e){return"object"==typeof e}function v(e){return!!(e&&0<Object.keys(e).length)}function s(t){return i(t)?Object.keys(t).map(function(e){return(encodeURIComponent(e)+"="+encodeURIComponent(t[e])).replace(/%2C/g,",").replace(/%2F/g,"/")}).filter(Boolean).join("&").replace(/%20/g,"+"):encodeURIComponent(t)}function t(){}function n(l,u,e){var n,t=Object.assign({},{aspectRatio:1.6,widthRange:{min:w.width,max:(u?window.parent:window).innerWidth},heightRange:{min:w.height,max:(u?window.parent:window).innerHeight}},e),p=1!==t.aspectRatio,i={},h={},a={},o=0,s=0,r=!1,m={},c="",d=R(localStorage.getItem("siqmedia_ss_playersize")),e=d?d.width:"",d=d?d.height:"";e&&(l.style.width=e+"px"),d&&(l.style.height=d+"px");function _(e,t,i){return Math.min(Math.max(e,t),i)}function f(e){e=e?1:-1;return{width:_(h.width+e*i.x,t.widthRange.min,t.widthRange.max),height:_(h.height+e*i.y,t.heightRange.min,t.heightRange.max),aspectRatioWidth:_(h.width+i.y*(e*t.aspectRatio),t.widthRange.min,t.widthRange.max),aspectRatioHeigth:_(h.height+i.x/(e*t.aspectRatio),t.heightRange.min,t.heightRange.max)}}function g(e,t,i,n){var a,o,s,r,c,d;n+t<=(u?window.parent:window).innerHeight&&i+e<=(u?window.parent:window).innerWidth&&(r=s=o=a="",n===m.top?a=m.top:o=m.bottom,i===m.left?s=m.left:r=m.right,n=e.toString(),i=t.toString(),e=a.toString(),t=o.toString(),a=s.toString(),o=r.toString(),localStorage.setItem("siqmedia_ss_playersize",D({width:n,height:i})),n&&(l.style.width=n+"px"),i&&(l.style.height=i+"px"),e&&o?(s=i-h.height,r=n-h.width,l.style.top=e+"px",l.style.right=o+"px",l.style.left=p?m.left-r+"px":m.left+"px",l.style.bottom=p?m.bottom-s+"px":m.bottom+"px"):e&&a?(c=i-h.height,d=n-h.width,l.style.top=e+"px",l.style.left=a+"px",l.style.bottom=p?m.bottom-c+"px":m.bottom+"px",l.style.right=p?m.right-d+"px":m.right+"px"):a&&t?(c=i-h.height,d=n-h.width,l.style.left=a+"px",l.style.bottom=t+"px",l.style.top=p?m.top-c+"px":m.top+"px",l.style.right=p?m.right-d+"px":m.right+"px"):t&&o&&(i=i-h.height,n=n-h.width,l.style.bottom=t+"px",l.style.right=o+"px",l.style.top=p?m.top-i+"px":m.top+"px",l.style.left=p?m.left-n+"px":m.left+"px"))}function y(e){(u?window.parent:window).removeEventListener("mousemove",S)}function C(e){!0===r&&(r=!1,(u?window.parent:window).removeEventListener("mousemove",I))}var v={top_left_corner:function(){var e=f(!1);g(e.aspectRatioWidth,e.height,m.right,m.bottom)},top_border:function(){var e=f(!1);g(p?e.aspectRatioWidth:h.width,e.height,m.right,m.bottom)},top_right_corner:function(){var e=f(!0);g(e.width,e.aspectRatioHeigth,m.left,m.bottom)},right_border:function(){var e=f(!0);g(e.width,p?e.aspectRatioHeigth:h.height,m.left,m.bottom)},bottom_right_corner:function(){var e=f(!0);g(e.aspectRatioWidth,e.height,m.left,m.top)},bottom_border:function(){var e=f(!0);g(p?e.aspectRatioWidth:h.width,e.height,m.left,m.top)},bottom_left_corner:function(){var e=f(!1);g(e.width,e.aspectRatioHeigth,m.right,m.top)},left_border:function(){var e=f(!1);g(e.width,p?e.aspectRatioHeigth:h.height,m.right,m.top)}},S=function(e){e.preventDefault(),i={x:e.pageX-a.x,y:e.pageY-a.y},v[c](e)},I=function(e){A(e),e.preventDefault();var t=parseInt(getComputedStyle(l,null).getPropertyValue("left").replace("px","")),i=parseInt(getComputedStyle(l,null).getPropertyValue("top").replace("px",""));if(t<0||i<0)return t<0&&(l.style.left="0px"),i<0&&(l.style.top="0px"),r=!1,void(u?window.parent:window).removeEventListener("mousemove",I);var n=parseInt(getComputedStyle(l,null).getPropertyValue("right").replace("px","")),a=parseInt(getComputedStyle(l,null).getPropertyValue("bottom").replace("px",""));if(n<0||a<0){e.pageX,e.pageY;return n<0&&(l.style.left=t+n+"px"),a<0&&(l.style.top=i+a+"px"),n<0&&(l.style.right="0px"),a<0&&(l.style.bottom="0px"),r=!1,void(u?window.parent:window).removeEventListener("mousemove",I)}l.style.left=e.pageX-o+"px",l.style.top=e.pageY-s+"px",l.style.right=(u?window.parent:window).innerWidth-h.width-(e.pageX-o)+"px",l.style.bottom=(u?window.parent:window).innerHeight-h.height-(e.pageY-s)+"px"};function A(e){e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}l.addEventListener("mousedown",function(e){var t,i;A(e),e.preventDefault(),h={width:parseInt(getComputedStyle(l,null).getPropertyValue("width").replace("px","")),height:parseInt(getComputedStyle(l,null).getPropertyValue("height").replace("px",""))},a={x:e.pageX,y:e.pageY},n=l.getBoundingClientRect(),m={right:(u?window.parent:window).innerWidth-n.left-h.width,bottom:(u?window.parent:window).innerHeight-n.top-h.height,left:n.left,top:n.top},(c=e.target.getAttribute("position"))?((u?window.parent:window).addEventListener("mousemove",S),(u?window.parent:window).addEventListener("mouseup",y)):(e.preventDefault(),r=!0,t=parseInt(getComputedStyle(l,null).getPropertyValue("left").replace("px","")),i=parseInt(getComputedStyle(l,null).getPropertyValue("top").replace("px","")),o=e.pageX-t,s=e.pageY-i,(u?window.parent:window).addEventListener("mousemove",I),(u?window.parent:window).addEventListener("mouseup",C))})}t.prototype.request=function(e){var t=e.url,i=e.type,n=e.data,a=e.rest,o=new XMLHttpRequest;o.open(i,this.processUrl(t,i,n),!0),o.onreadystatechange=this.handleStateChange(e),this.beforeSend(o,e),o.send(function(e,t,i){if(-1!=["POST","PUT"].indexOf(e))return i?JSON.stringify(t):s(t);["GET","DELETE"].indexOf(e)}(i,n,a))},t.prototype.processUrl=function(e,t,i){return-1!=["GET","DELETE"].indexOf(t)&&i&&"object"==typeof i&&0<Object.keys({}).length?e+"?"+s(i):e},t.prototype.handleStateChange=function(n){return function(){var e,t,i="2"===this.status.toString()[0]?n.success:n.error;4===this.readyState&&(e=i,i=R(this.response),void 0===t&&(t=!1),d(e)&&(t?e.call(t,i):e(i)))}},t.prototype.beforeSend=function(e,t){var i=t.rest?"application/json":"application/x-www-form-urlencoded",n=SiqAVRouter.container.detailsHandler.isembed;n||e.setRequestHeader("X-reqsrc","ajax"),-1!=["POST","PUT","DELETE"].indexOf(t.type)&&(n||e.setRequestHeader("X-ZCSRF-TOKEN","zls_csrparam="+function(e){if(2==(e=("; "+document.cookie).split("; "+e+"=")).length)return e.pop().split(";").shift()}("LS_CSRF_TOKEN")),e.setRequestHeader("Content-Type",i))};function a(e,t){this.container=t,this._statsObjects={},this._statsGatheringInterval=void 0,this._statsGatheringIntervalTime=1e3,this.statsConstants={connectedTransportKeyIncludes:"RTCTransport_",candidateKeyIncludes:"RTCIceCandidate",hostCandidateTypeValue:"host",candidatePairType:"candidate-pair",candidatePairSelectedState:"succeeded",localCandidateType:"local-candidate",remoteCandidateType:"remote-candidate"},this.statValidKeysMapping={RTCLiveIceCandidatePair:{bytesSent:"bytessent",bytesReceived:"bytesreceived",availableOutgoingBitrate:"availablebitrate",availableIncomingBitrate:"recvbitrate",totalRoundTripTime:"totalrtt",currentRoundTripTime:"rtt"},RTCOutboundRTPVideoStream_:{pliCount:"videoplisrecv",nackCount:"videonacksrecv"},RTCInboundRTPAudioStream_:{packetsLost:"recvaudiopacketlost"},RTCInboundRTPVideoStream_:{pliCount:"videoplissent",nackCount:"videonackssent",packetsLost:"recvvideopacketlost"}},this._initiateGathering(e)}function o(e,t){var n=this;this.container=t,this._id=e.mediaID,this._connection=e.connection,this._timeVsStats={},this._networkInfo={},this._networkInfoCallBack=e.networkInfoCallBack,this._updateStatsCallBack=e.updateStatsCallBack,this._hasSentNetworkInfo=!1,this._statsObjectMaxSize=30,o.prototype.setNetworkInfo=function(e,t,i){n._networkInfo={network_type:e,private_ip:t,public_ip:i}},o.prototype.getId=function(){return this._id},o.prototype.getConnection=function(){return this._connection},o.prototype.isConnectionActive=function(){var e=this.getConnection().iceConnectionState;return e===w.iceConnectionStates.CONNECTED||e===w.iceConnectionStates.COMPLETED},o.prototype.isConnectionClosed=function(){return this.getConnection().iceConnectionState===w.iceConnectionStates.CLOSED},o.prototype.hasSentNetworkInfo=function(){return this._hasSentNetworkInfo},o.prototype.sendNetworkInfo=function(){"function"==typeof this._networkInfoCallBack&&this._networkInfoCallBack(this._id,this._networkInfo),this._hasSentNetworkInfo=!0},o.prototype.updateAndSendStats=function(e,t){this._timeVsStats[e]=t,Object.keys(this._timeVsStats).length===this._statsObjectMaxSize&&this._sendStats()},o.prototype._sendStats=function(){this._updateStatsCallBack(this._id,this._timeVsStats),this._timeVsStats={}}}a.prototype._isHostCandidate=function(e){return(this._isLocalCandidate(e)||this._isRemoteCandidate(e))&&e.candidateType===this.statsConstants.hostCandidateTypeValue},a.prototype._isLocalCandidate=function(e){return void 0!==e&&e.type===this.statsConstants.localCandidateType},a.prototype._isRemoteCandidate=function(e){return void 0!==e&&e.type===this.statsConstants.remoteCandidateType},a.prototype._isCandidatePair=function(e){return void 0!==e&&e.type===this.statsConstants.candidatePairType},a.prototype._isCandidatePairSelected=function(e){return this._isCandidatePair(e)&&e.state===this.statsConstants.candidatePairSelectedState},a.prototype._getSelectedCandidatePair=function(e){var t=void 0,i=e.values(),n=void 0;do{var a=(n=i.next()).value;if(this._isCandidatePairSelected(a)){t=a.id;break}}while(!n.done);return t},a.prototype._getValidStatKey=function(e){for(var t in this.statValidKeysMapping)if(-1!==e.indexOf(t)||e.toUpperCase()===t.toUpperCase())return t},a.prototype._redefineStats=function(e,t){var i={},e=this._getValidStatKey(e);if(e){var n,a=this.statValidKeysMapping[e];for(n in a)i[a[n]]=t[n]}return i},a.prototype._findHostCandidate=function(e,i){var n,a=this;return e.forEach(function(e,t){a._isHostCandidate(e)&&e.networkType===i&&(n=e)}),n},a.prototype._updateAndSendNetworkInfo=function(e,t,i){var n=t.get(i.localCandidateId),a=n.networkType,o=n.ip||n.address,s=void 0,i=void 0;void 0!==(i=this._isHostCandidate(n)?n:this._findHostCandidate(t,a))&&(s=i.ip||i.address),e.setNetworkInfo(a,s,o),e.sendNetworkInfo()},a.prototype._updateStatsData=function(n){var a=this,e=n.getConnection();n.isConnectionClosed()?this._stopGathering(n.getId()):n.isConnectionActive()&&e.getStats().then(function(e){var i,t=a._getSelectedCandidatePair(e);void 0!==t&&(t=e.get(t),n.hasSentNetworkInfo()||a._updateAndSendNetworkInfo(n,e,t),i=a._redefineStats("RTCLiveIceCandidatePair",t),e.forEach(function(e,t){i=Object.assign({},i,a._redefineStats(t,e))}),n.updateAndSendStats((new Date).getTime(),i))})},a.prototype._initiateGathering=function(e){var t,i=this,n=e.mediaID;this.container.MediaDetails.checkBrowserSupportedForStats()&&((t=this._statsObjects[n]||{})[n]=new o(e,this.container),this._statsObjects=t,void 0===this._statsGatheringInterval&&(this._statsGatheringInterval=setInterval(function(){i._gatherStats()},this._statsGatheringIntervalTime)))},a.prototype._gatherStats=function(){for(var e in this._statsObjects){e=this._statsObjects[e];try{this._updateStatsData(e)}catch(e){}}},a.prototype._stopGathering=function(e){var t=this._statsObjects[e];t&&t._sendStats(),delete this._statsObjects[e],0===Object.keys(this._statsObjects).length&&(clearInterval(this._statsGatheringInterval),this._statsGatheringInterval=void 0)};function S(e,t){this.container=t,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.audio="audio",this.screen_share="screen_share",this.video="video",this.curr_connection={audio:!1,screen_share:!1,video:!1},this.init(e)}S.prototype.init=function(e){this.chid=e.chatid,this.mid=e.id,this.type=e.type,this.localDescription="",this.remoteDescription="",this.localStream="",this.remoteStream="",this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceRestart=e.iceRestart,this.isUpStream=e.isUpStream,this.connectionStatus="",this.rtcConnection="",this.isReconnecting=!1,this.remoteCandidatePushed=!1,this.mediaRequest=e.mediaRequest,this.reconnectInterval=null,this.statsObj=null,this.reconnectEndTimer=null,this.audioStream=null,this.screenStream=null,this.remoteStream=[],this.remoteAudioStream=null,this.remoteScreenStream=null,this.screenRtpSenders=null,this.audioRtpSenders=null,this.videoRtpSenders=null,this.isOfferer=!1,this.remoteTracksId=null,this.isNegotiation=!1,this.negotiationType=null,this.streamType={audio:"audioStream",screen_share:"screenStream",video:"videoStream",screen_view:"screenStream"},this.streamData={audio:"audioRtpSenders",screen_share:"screenRtpSenders",screen_view:"screenRtpSenders",video:"videoRtpSenders"},this.currentPerfectRenegotiation=this.container.MediaDetails.getClientSupport().perfect_renegotiation,this.remotePerfectRenegotiation=e.perfectReNegotiation||!0,this.isFirstOfferer=!1,this.istransceiverAdded=!1,this.isCallConnected=!1,this.intRTCConn()},S.prototype.intRTCConn=function(){try{this.rtcConnection=new RTCPeerConnection(this.getCredentail()),this.getStream(),this.isUpStream&&(!this.iceRestart&&this[this.streamType[this.type]]&&this.addStream(),this.isFirstOfferer=!0,this.createOffer(),this[this.curr_connection[this.type]]=!0),this.getRemoteStream(),this.rtcConnectionStatus()}catch(e){}},S.prototype.getStream=function(){this[this.streamType[this.type]]=this.container.MediaPermission.getStreamByType(this.type)},S.prototype.getCredentail=function(){var e=this.mid,t=this.container.dataHandler.get(e+"_credential").credential;if(t){var t=R(t),e=this.getServerUrl(t,e).split(","),i=t.user_name,n=t.token,a=[];return e.forEach(function(e){a.push({username:i,urls:e,credential:n})}),{iceServers:a}}return null},S.prototype.getServerUrl=function(e,t){var i=this.container.dataHandler;switch(i.get(t+"_nextTurnServer")){case w.TURN_URL[0]:return i.set(t+"_nextTurnServer",w.TURN_URL[1]),e.geo_turnurls||this.getServerUrl(e,t);case w.TURN_URL[1]:return i.set(t+"_nextTurnServer",w.TURN_URL[2]),e.primary_turnurls||this.getServerUrl(e,t);case w.TURN_URL[2]:return i.set(t+"_nextTurnServer",w.TURN_URL[3]),e.secondary_turnurls||this.getServerUrl(e,t);case w.TURN_URL[3]:if(i.remove(t+"_nextTurnServer"),e.servers)return e.servers;break;default:return i.remove(t+"_nextTurnServer"),e.servers}},S.prototype.createOffer=function(){var t=this,e=this.getSDPConstraints();this.iceRestart&&(e.iceRestart=!0),this.rtcConnection.createOffer(e).then(function(e){return t.offerSuccessCallBack(e)}).catch(function(e){return t.offerErrorCallBack(e)})},S.prototype.offerSuccessCallBack=function(e){var t=this.container,i=t.commonImpl,t=t.constants;this.isOfferer=!0,this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e));e={session:D(e)};this.isNegotiation&&(e.tracks_id=D(this.tracksId),e.negotiation_type=this.negotiationType,e.process_type=t.negotiation);e={action:t.offer,success_cbk:null,failure_cbk:null,extraData:e};i.setApiData(this.mid,e),i.makeApiCall(this.mid),this.createIceCandidates()},S.prototype.offerErrorCallBack=function(e){},S.prototype.createAnswer=function(){var t=this;this.rtcConnection.createAnswer(this.sdpConstraints).then(function(e){return t.answerSuccessCallBack(e)}).catch(function(e){return t.answerErrorCallBack(e)})},S.prototype.answerSuccessCallBack=function(e){var t=this.container,i=t.commonImpl,t=t.constants;this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e));e={session:D(e)};this.negotiationType&&(e.tracks_id=D(this.tracksId),e.negotiation_type=this.negotiationType,e.process_type=t.negotiation);e={action:t.answer,success_cbk:null,failure_cbk:null,extraData:e};i.setApiData(this.mid,e),i.makeApiCall(this.mid)},S.prototype.addStream=function(){var t=this;this[this.streamType[this.type]]&&this[this.streamType[this.type]].getTracks().forEach(function(e){t[t.streamData[t.type]]="function"==typeof t.rtcConnection.addTrack?t.rtcConnection.addTrack(e,t[t.streamType[t.type]]):t.rtcConnection.addStream(t[t.streamType[t.type]])})},S.prototype.createIceCandidates=function(){var i=this,e=this.container,n=e.commonImpl,a=e.constants;this.localIceCandidates=[],this.rtcConnection.onicecandidate=function(e){i.localIceCandidates.push(e);var t={};e.candidate&&(t.label=e.candidate.sdpMLineIndex,t.type=a.candidate,t.id=e.candidate.sdpMid,t.candidate=e.candidate.candidate,t={candidates:D(t)},t={action:a.candidates,success_cbk:null,failure_cbk:null,extraData:t},n.setApiData(i.mid,t),n.makeApiCall(i.mid))}},S.prototype.setRemoteDescription=function(e){var t=this;this.negotiationType&&this.negotiationType==this.audio&&!this.audioRtpSenders&&(this.audioStream=this.container.MediaPermission.getStreamByType("audio"),this.audioRtpSenders=this.addTrack(this.audioStream)),this.isUpStream||this.isReconnecting||this.iceRestart||!this.audioStream||this.audioRtpSenders||this.addStream(),this.rtcConnection.setRemoteDescription(new RTCSessionDescription(R(e))).then(function(){t.isOfferer||(t.createAnswer(),t.createIceCandidates()),t.clearReconnectNWTimer()}),this.remoteDescription=e,this.remoteCandidatePushed||this.pushIceCandidate(),this.negotiationType&&this.updateRemoteStream()},S.prototype.setOfferRemoteDescription=function(e){this.isOfferer=!1,this.localDescription=null,this.curr_connection.audio=!(!this.remoteTracksId||!this.remoteTracksId[this.audio]),this.curr_connection.screen_share=!(!this.remoteTracksId||!this.remoteTracksId[this.screen_share]),this.tracksId=this.container.MediaPermission.getTracksId(),this.setRemoteDescription(e)},S.prototype.setAnswerRemoteDesription=function(e){this.isOfferer=!0,this.setRemoteDescription(e)},S.prototype.pushIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate});t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},S.prototype.setIceCandidates=function(e){var t=R(e.candidates||e.msg.candidate);this.remoteDescription&&this.localDescription?(this.remoteIceCandidates&&0<this.remoteIceCandidates.length&&!this.remoteCandidatePushed&&this.pushIceCandidate(),e=new RTCIceCandidate({sdpMid:t.id,sdpMLineIndex:t.label,candidate:t.candidate}),this.rtcConnection.addIceCandidate(e)):(this.remoteIceCandidates&&0<this.remoteIceCandidates.length||(this.remoteIceCandidates=[]),this.remoteIceCandidates.push(t))},S.prototype.rtcConnectionStatus=function(){var n=this;this.rtcConnection.oniceconnectionstatechange=function(){var e,t=n.rtcConnection.iceConnectionState,i=n.mid;"connected"==t?(n.remoteIceCandidates=[],n.localIceCandidates=[],n.remoteDescription=null,n.localDescription=null,n.isCallConnected=!0,e=n.type+"Impl",n.container[e].callConnected(n),n.container.commonImpl.clearNetworkTimer(n),n.statsObj=new a({mediaID:i,connection:n.rtcConnection,networkInfoCallBack:n.container.commonImpl.sendRTCNetworkStats,updateStatsCallBack:n.container.commonImpl.sendRTCConnectionStats},n.container)):"failed"==t&&(n.isCallConnected?n.initReconnect():n.container.dataHandler.get(i+"_nextTurnServer")?(n.clearRTCData(),n.intRTCConn()):n.initCallFailed())},this.rtcConnection.onconnectionstatechange=function(e){var t=n.mid;"failed"==n.rtcConnection.connectionState&&(n.isCallConnected?n.initReconnect():n.container.dataHandler.get(t+"_nextTurnServer")?(n.clearRTCData(),n.intRTCConn()):n.initCallFailed()),"connected"==n.rtcConnection.iceConnectionState&&(n.remoteIceCandidates=[],n.localIceCandidates=[],n.remoteDescription=null,n.localDescription=null,n.isCallConnected=!0,n.updateRemoteStream())}},S.prototype.initReconnect=function(){this.isReconnecting=!0,this.iceRestart=!0,this.remoteIceCandidates=[],this.remoteDescription=null,this.remoteCandidatePushed=!1,this.container.commonImpl.checkNetwork(this.chid,this.mid)},S.prototype.initCallFailed=function(){this.container.commonImpl.callFailed(this.chid,this.mid)},S.prototype.getRemoteStream=function(){var t=this;this.rtcConnection.onaddstream=this.rtcConnection.ontrack=function(e){t.remoteStream.push(e),(e.streams&&e.streams[0]||e.stream)&&t.container[t.type+"Impl"].addRemoteStream(e,t),t.type!=t.screen_share&&"screen_view"!=t.type||t.negotiationType||e.streams&&(e.streams[0].onremovetrack=t.handleScreenTrackremoved),t.negotiationType&&e.streams&&e.streams[0]&&t.updateRemoteStream()}},S.prototype.updateRemoteStream=function(){try{for(var e in this.remoteStream){var t,i=this.remoteStream[e],n=null,n="track"==i.type?i.streams&&i.streams[0]?i.streams[0].id:null:i.stream?i.stream.id:null;for(t in this.remoteTracksId){var a=this.remoteTracksId[t];n&&n===a&&(this.container[t+"Impl"].addRemoteStream(i,this),t==this.screen_share&&i.streams&&i.streams[0]&&(i.streams[0].onremovetrack=this.handleScreenTrackremoved))}}}catch(e){}},S.prototype.handleScreenTrackremoved=function(){SiqAVRouter.container.commonImpl.handleScreenTrackEnd()},S.prototype.contructResponse=function(e){var t=this.mid,i=this.type,n=this.chid;return Object.assign({},{mid:t,type:i,chid:n},e)},S.prototype.closeConnection=function(){try{this.rtcConnection.close(),this.statsObj._stopGathering(this.mid),this[this.streamType[this.type]]&&this.closeTracksInStream(this[this.streamType[this.type]])}catch(e){}},S.prototype.closeTracksInStream=function(e){try{e.getTracks().forEach(function(e){return e.stop()})}catch(e){}},S.prototype.getSDPConstraints=function(){var e=this.type,t=(this.mid,this.chid),i=this.container,n=i.dataHandler,i=i.constants,t=(n.get(t+"_call_status",!0),{offerToReceiveAudio:!0,offerToReceiveVideo:!0});return e==i.audio?t.offerToReceiveVideo=!0:e==i.screen_share&&(t.offerToReceiveVideo=!0,t.offerToReceiveAudio=!0),t},S.prototype.clearReconnectNWTimer=function(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.iceRestart=!1)},S.prototype.addAudioTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),!0)},S.prototype.removeAudioTrackInConnection=function(){this.rtcConnection.removeTrack(this.audioRtpSenders),this.container.MediaPermission.closeStreamByType(this.audio)},S.prototype.addScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),this.istransceiverAdded=!0)},S.prototype.removeScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!1,this.screenRtpSenders=null,this.createOffer(),!0)},S.prototype.addTrack=function(t){var i,n=this;return t&&t.getTracks().forEach(function(e){i="function"==typeof n.rtcConnection.addTrack?n.rtcConnection.addTrack(e,t):n.rtcConnection.addStream(t)}),i},S.prototype.checkIsEligibleToCreateOfferOnNegotiation=function(){return!!(this.currentPerfectRenegotiation&&this.remotePerfectRenegotiation||this.isFirstOfferer)},S.prototype.screenShareRenegotiation=function(){this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.istransceiverAdded||(this.rtcConnection.addTransceiver(this.video),this.istransceiverAdded=!0),this.createOffer()},S.prototype.handleScreenShareRenegotiation=function(e,t){(t=void 0===t?!1:t)?(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share)):(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream)),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.setOfferRemoteDescription(e)},S.prototype.audioRenegotiation=function(){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.createOffer()},S.prototype.handleAudioRenegotiation=function(e){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.setOfferRemoteDescription(e)},S.prototype.__addAudioTracks=function(){this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream)},S.prototype.clearRTCData=function(){this.remoteIceCandidates=[],this.remoteDescription=null,this.localDescription=null,this.audioRtpSenders=null,this.rtcConnection.close(),this.container.uiHandler.updateCallInvitationState(this.type,{chid:this.chid,media_id:this.mid},w.reconnecting)};function r(e,t){this.container=t,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.audio="audio",this.screen_share="screen_share",this.video="video",this.curr_connection={audio:!1,screen_share:!1,video:!1},this.init(e)}r.prototype.init=function(e){this.chid=e.chatid||e.chid,this.mid=e.id,this.type=e.datatype||e.type,this.localDescription="",this.remoteDescription="",this.localStream="",this.remoteStream="",this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceRestart=e.iceRestart||!1,this.isUpStream=e.isUpStream,this.connectionStatus="",this.rtcConnection="",this.isReconnecting=!1,this.remoteCandidatePushed=!1,this.mediaRequest=e.mediaRequest,this.reconnectInterval=null,this.statsObj=null,this.reconnectEndTimer=null,this.audioStream=null,this.screenStream=null,this.remoteStream=[],this.remoteAudioStream=null,this.remoteScreenStream=null,this.screenRtpSenders=null,this.audioRtpSenders=null,this.videoRtpSenders=null,this.isOfferer=!1,this.remoteTracksId=null,this.isNegotiation=!1,this.negotiationType=null,this.dataChannel=null,this.isDataChannel=e.isDataChannel||!1,this.streamType={audio:"audioStream",screen_share:"screenStream",video:"videoStream",screen_view:"screenStream",audio_unified_mix:"audioStream",audio_smart:"audioStream",screen_share_smart:"screenStream"},this.streamData={audio:"audioRtpSenders",screen_share:"screenRtpSenders",screen_view:"screenRtpSenders",video:"videoRtpSenders",audio_unified_mix:"audioRtpSenders",screen_share_smart:"screenRtpSenders",audio_smart:"audioRtpSenders"},this.currentPerfectRenegotiation=this.container.MediaDetails.getClientSupport().perfect_renegotiation,this.remotePerfectRenegotiation=e.perfectReNegotiation||!0,this.isFirstOfferer=!1,this.istransceiverAdded=!1,this.firstCandidate=null,this.creatorid=e.creatorid,this.isNotified=!1,this.intRTCConn()},r.prototype.intRTCConn=function(){try{this.rtcConnection=new RTCPeerConnection(this.getCredentail()),this.getStream(),this.isUpStream&&(this.iceRestart||!this[this.streamType[this.type]]||this.isDataChannel||this.addStream(),this.isFirstOfferer=!0,this.isDataChannel&&this.createDataChannel(),this.createOffer(),this[this.curr_connection[this.type]]=!0),this.getRemoteStream(),this.rtcConnectionStatus()}catch(e){}},r.prototype.getStream=function(){var e=this.type,t={audio_unified_mix:w.audio,audio_smart:w.audio,screen_share_smart:w.screen_share,screen_view_smart:w.screen_share},e=null!=t[e]?t[e]:e;this[this.streamType[this.type]]=this.container.MediaPermission.getStreamByType(e)},r.prototype.getCredentail=function(){var e=this.mid,t=this.container.dataHandler.get(e+"_credential");if(t.credential){var e=R(t.credential),t=e.servers.split(","),i=e.user_name,n=e.token,a=[];return t.forEach(function(e){a.push({urls:e,username:i,credential:n})}),{iceServers:a}}return null},r.prototype.createOffer=function(){var t=this,e=this.getSDPConstraints();this.iceRestart&&(e.iceRestart=!0),this.rtcConnection.createOffer(e).then(function(e){return t.offerSuccessCallBack(e)}).catch(function(e){return t.offerErrorCallBack(e)})},r.prototype.offerSuccessCallBack=function(e){this.isOfferer=!0,this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e)),this.isNegotiation?this.sendOffer():this.createIceCandidates()},r.prototype.sendOffer=function(){var e={description:this.localDescription.sdp,dataType:this.type};this.firstCandidate&&(e.candidate=this.firstCandidate.candidate.candidate),this.tracksId&&(e.tracksId=this.tracksId),this.isNegotiation&&(e.negotiationType=this.negotiationType,e.processType="negotiation"),this.iceRestart&&(e.processType=w.restart);var t=this.contructResponse(e),e=this.type+"Impl";this.container[e].sendUnifiedOffer(t)},r.prototype.offerErrorCallBack=function(e){},r.prototype.createAnswer=function(){var t=this;this.rtcConnection.createAnswer(this.sdpConstraints).then(function(e){return t.answerSuccessCallBack(e)}).catch(function(e){return t.answerErrorCallBack(e)})},r.prototype.answerSuccessCallBack=function(e){this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e))},r.prototype.sendAnswer=function(){var e={description:this.localDescription.sdp,candidate:this.firstCandidate.candidate.candidate,dataType:this.type,creatorid:this.creatorid};this.isNegotiation&&(e.tracksId=this.tracksId,e.negotiationType=this.negotiationType,e.processType="negotiation");var t=this.contructResponse(e),e=this.type+"Impl";this.container[e].sendUnifiedAnswer(t)},r.prototype.addStream=function(){var t=this;this[this.streamType[this.type]]&&this[this.streamType[this.type]].getTracks().forEach(function(e){t[t.streamData[t.type]]="function"==typeof t.rtcConnection.addTrack?t.rtcConnection.addTrack(e,t[t.streamType[t.type]]):t.rtcConnection.addStream(t[t.streamType[t.type]])})},r.prototype.createIceCandidates=function(){var t=this;this.localIceCandidates=[],this.rtcConnection.onicecandidate=function(e){t.firstCandidate?e.candidate&&e.candidate.candidate&&t.localIceCandidates.push(e.candidate.candidate):(t.firstCandidate=e,t.isOfferer?t.sendOffer():t.sendAnswer()),e.candidate}},r.prototype.sendCandidates=function(){this.container[this.type+"Impl"].sendUnifiedCandidates(this.contructResponse({candidates:this.localIceCandidates,isupstream:this.isUpStream,dataType:this.type,creatorid:this.creatorid}))},r.prototype.createDataChannel=function(){this.dataChannel=this.rtcConnection.createDataChannel("receiveChannel"),this.dataChannel.binaryType="arraybuffer"},r.prototype.setRemoteDescription=function(e){var t=this;this.rtcConnection.setRemoteDescription(new RTCSessionDescription(R(e))).then(function(){t.isOfferer||(t.createAnswer(),t.createIceCandidates()),t.clearReconnectNWTimer()}),this.remoteDescription=e,this.remoteCandidatePushed||this.pushIceCandidate(),this.negotiationType&&this.updateRemoteStream()},r.prototype.setOfferRemoteDescription=function(e){this.isOfferer=!1,this.localDescription=null,this.curr_connection.audio=!(!this.remoteTracksId||!this.remoteTracksId[this.audio]),this.curr_connection.screen_share=!(!this.remoteTracksId||!this.remoteTracksId[this.screen_share]),this.tracksId=this.container.MediaPermission.getTracksId(),this.setRemoteDescription(e)},r.prototype.setAnswerRemoteDesription=function(e){this.isOfferer=!0,this.setRemoteDescription(e)},r.prototype.pushIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate});t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},r.prototype.setIceCandidatesArray=function(e){this.remoteIceCandidates=e.candidates,this.pushUnifiedIceCandidate()},r.prototype.setIceCandidates=function(e){var t=R(e.candidates||e.msg.candidate);this.remoteDescription&&this.localDescription?(this.remoteIceCandidates&&0<this.remoteIceCandidates.length&&!this.remoteCandidatePushed&&this.pushIceCandidate(),e=new RTCIceCandidate({sdpMid:t.id,sdpMLineIndex:t.label,candidate:t.candidate}),this.rtcConnection.addIceCandidate(e)):(this.remoteIceCandidates&&0<this.remoteIceCandidates.length||(this.remoteIceCandidates=[]),this.remoteIceCandidates.push(t))},r.prototype.rtcConnectionStatus=function(){var i=this;this.rtcConnection.oniceconnectionstatechange=function(){var e,t=i.rtcConnection.iceConnectionState;"connected"==t?(i.remoteIceCandidates=[],i.remoteDescription=null,i.localDescription=null,e=i.type+"Impl",i.type!=w.data_channel&&i.container[e].unifiedcallConnected(i),i.container.commonImpl.clearNetworkTimer(i),!i.isUpStream||i.isNegotiation||i.isNotified||i.container[e].notifyUser(i)):"failed"==t&&i.initReconnect()},this.rtcConnection.onconnectionstatechange=function(e){"failed"==i.rtcConnection.connectionState&&i.initReconnect(),"connected"==i.rtcConnection.iceConnectionState&&(i.remoteIceCandidates=[],i.remoteDescription=null,i.localDescription=null,i.updateRemoteStream())}},r.prototype.initReconnect=function(){this.isReconnecting=!0,this.iceRestart=!0,this.remoteIceCandidates=[],this.remoteDescription=null,this.remoteCandidatePushed=!1,this.container.commonImpl.checkUnifiedNetwork(this)},r.prototype.getRemoteStream=function(){var t=this;this.rtcConnection.onaddstream=this.rtcConnection.ontrack=function(e){t.remoteStream.push(e),e.streams&&e.streams[0]&&t.container[t.type+"Impl"].addUnifiedRemoteStream(e,t),t.type!=t.screen_share&&"screen_view"!=t.type||t.negotiationType||e.streams&&(e.streams[0].onremovetrack=t.handleScreenTrackremoved),t.negotiationType&&e.streams&&e.streams[0]&&t.updateRemoteStream()}},r.prototype.updateRemoteStream=function(){try{for(var e in this.remoteStream){var t,i=this.remoteStream[e],n=null,n="track"==i.type?i.streams&&i.streams[0]?i.streams[0].id:null:i.stream?i.stream.id:null;for(t in this.remoteTracksId){var a=this.remoteTracksId[t];n&&n===a&&(this.container[t+"Impl"].addUnifiedRemoteStream(i,this),t==this.screen_share&&i.streams&&i.streams[0]&&(i.streams[0].onremovetrack=this.handleScreenTrackremoved))}}}catch(e){}},r.prototype.handleScreenTrackremoved=function(){SiqAVRouter.container.commonImpl.handleScreenTrackEnd()},r.prototype.contructResponse=function(e){var t=this.mid,i=this.type,n=this.chid;return Object.assign({},{mid:t,type:i,chid:n},e)},r.prototype.closeConnection=function(){try{this.rtcConnection.close(),this[this.streamType[this.type]]&&this.closeTracksInStream(this[this.streamType[this.type]])}catch(e){}},r.prototype.closeTracksInStream=function(e){try{e.getTracks().forEach(function(e){return e.stop()})}catch(e){}},r.prototype.getSDPConstraints=function(){var e=this.type,t=(this.mid,this.chid),i=this.container,n=i.dataHandler,i=i.constants,t=(n.get(t+"_call_status",!0),{offerToReceiveAudio:!0,offerToReceiveVideo:!1});return e==i.audio?t.offerToReceiveVideo=!1:e==i.screen_share||e==i.screen_share_smart||e==i.screen_view_smart?(t.offerToReceiveVideo=!0,t.offerToReceiveAudio=!1):e==i.data_channel&&(t.offerToReceiveVideo=!1,t.offerToReceiveAudio=!1),t},r.prototype.clearReconnectNWTimer=function(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.iceRestart=!1)},r.prototype.addAudioTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),!0)},r.prototype.removeAudioTrackInConnection=function(){this.rtcConnection.removeTrack(this.audioRtpSenders),this.container.MediaPermission.closeStreamByType(this.audio)},r.prototype.addScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),this.istransceiverAdded=!0)},r.prototype.removeScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!1,this.screenRtpSenders=null,this.createOffer(),!0)},r.prototype.addTrack=function(t){var i,n=this;return t&&t.getTracks().forEach(function(e){i="function"==typeof n.rtcConnection.addTrack?n.rtcConnection.addTrack(e,t):n.rtcConnection.addStream(t)}),i},r.prototype.checkIsEligibleToCreateOfferOnNegotiation=function(){return!!(this.currentPerfectRenegotiation&&this.remotePerfectRenegotiation||this.isFirstOfferer)},r.prototype.screenShareRenegotiation=function(){this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.istransceiverAdded||(this.rtcConnection.addTransceiver(this.video),this.istransceiverAdded=!0),this.createOffer()},r.prototype.handleScreenShareRenegotiation=function(e,t){(t=void 0===t?!1:t)?(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share)):(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream)),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.setOfferRemoteDescription(e)},r.prototype.audioRenegotiation=function(){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=w.audio_unified_mix,this.firstCandidate=null,this.createOffer()},r.prototype.handleAudioRenegotiation=function(e){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.setOfferRemoteDescription(e)},r.prototype.__addAudioTracks=function(){this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream)},r.prototype.pushUnifiedIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate(R(e));t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0};var e=function(e){(this.container=e).audioImpl=this,e.audio_unified_mixImpl=this,e.audio_smartImpl=this,(e.data_channelImpl=this).init(),this.audio="audio",this.timeout={},this.iconClicked={},this.reinit=!1,this.isWaitingForPermission=!1};e.prototype.setCredential=function(e){this.container.commonImpl.setCredential(e)},e.prototype.handleInvitation=function(e,t){var i=this;void 0===t&&(t=0);var n=this.container,a=n.constants,o=n.detailsHandler,s=n.commonImpl,r=n.mediaUIHandler,c=s.getWmsPushData(e),d=c.chatid,l=c.type,u=c.mediaRequest,p=c.isOldUI,h=c.perfectReNegotiation,m=c.mediaInvitation,_=c.isMobileOperator,f=c.connection_type,g=c.recordingType,n=a.RINGTONE_DURATION,c={};if(o.isOldUI()?(c.is_old_ui=o.isOldUI(),f=w.connectionType.PEER2PEER):(f&&(l=s.getTypeFromConnectionType(f,l)),o.isEmbed()||o.checkAndFillVisitorStore(d)),s.endCallFromSameChat(e),o.canShowAudioCallInvitation(d))try{var y=s.getActiveCallData();if(o.isembed&&y&&y!=d){var C={action:a.reject,success_cbk:null,failure_cbk:null,extraData:c};return s.setApiData(e,C),void s.makeApiCall(e)}function v(){clearTimeout(i.timeout[e]),i.handleUIReject(e)}var S,I,A,R,D={rejectCbk:v,acceptCbk:function(){clearTimeout(i.timeout[e]),f==w.connectionType.PEER2PEER||!o.isEmbed()||i.isConsentBannerAccepted()||!o.isScreenRecordingEnabled()?i.handleUIAccept(e):i.showConsentUI(e,!0)},chid:d,media_id:e,isDirectCall:!1};if(s.checkIncomingCallAllowed(e)){var b={action:a.reject,success_cbk:null,failure_cbk:null,extraData:c};return s.setApiData(e,b),s.makeApiCall(e),!0}s.setCredential(e),p&&s.setIsCallInitiatedFromOldUI(p,e),_&&s.setIsMobileOperator(_,e),o.handleIncomingCall({type:l,chid:d}),m?(setTimeout(function(){r.handleAudioCallInvite(l,D)},500),S={callType:a.incoming,callStatus:a.ringing,mediarequest:u,host:a.downstream,isdirectcall:!1,isPerfectRenegotiation:h,type:l,connection_type:f,recording_type:g},s.setCallStatusData(e,S),I=s.getActiveTab(),A={chatid:d,type:a.audiocall,duration:I?"3":n,tone:I?a.outgoingcall:a.incomingcall,isEncrypted:!1},s.playMediaNotificationSound(A),s.sendMediaActivity({param:{action_type:A.tone==a.incomingcall?w.activity.MEDIA_AUDIO_INCOMING_SOUND_START:w.activity.MEDIA_AUDIO_OUTGOING_SOUND_START,add_info:o.getMediaActivityAddInfo()},mid:e}),s.showDesktopNotif({chatid:d}),this.timeout[e]=setTimeout(v,n)):(R={callType:a.incoming,callStatus:a.connecting,mediarequest:u,host:a.downstream,isdirectcall:!1,isPerfectRenegotiation:h,connection_type:f},s.setCallStatusData(e,R),this.handleUIAccept(e));var E={chid:d,type:l,media_id:e,status:w.incoming};s.setMediaCache(w.siq_unifiedMedia,E),s.updateIncomingRequestData(e);var k="siqMedia: media invitation  | chid :"+d+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,k),o.triggerIconCheck(d)}catch(e){}else t<3&&(0==t&&o.joinChat(d),setTimeout(function(){return i.handleInvitation(e,t++)},3e3))},e.prototype.handleCallRequest=function(a){var o=this,e=this.container,s=e.commonImpl,r=e.mediaUIHandler,t=e.dataHandler,c=e.MediaPermission,d=e.constants,i=e.detailsHandler,n=s.getWmsPushData(a),l=n.chatid,e=n.negotiationType,n=n.processType,u=t.get(l+"_peer")||{},p={process_type:d.negotiation,negotiation_type:e};if(i.isOldUI()&&(p.is_old_ui=i.isOldUI()),n&&n==d.reinit)s.getPeerObject(a).audioRenegotiation();else try{function h(){clearTimeout(o.timeout[a]),r.updateCallInvitationState(d.audio,{chid:l,media_id:a},d.rejected);var e={action:d.reject,success_cbk:null,failure_cbk:null,extraData:p};s.setApiData(a,e),s.makeApiCall(a)}var m={chid:l,media_id:a,rejectCbk:h,acceptCbk:function(){function e(){clearTimeout(o.timeout[a]);var e={action:d.reject,success_cbk:null,failure_cbk:null,extraData:p},i={chid:l,media_id:a,isDirectCall:s.getCallStatusData(a).isdirectcall,muteCbk:function(){return o.toggleMute()},rejectCbk:function(){return s.setApiData(a,e)&&s.makeApiCall(a)}},n=function(){clearTimeout(t)},t=setTimeout(function(){n=r.mediaPermissionUI()},3e3);s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_RENEGOTIATION_ACCEPT},mid:a}),c.getAudioStream(function(){n(),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED},mid:a}),r.updateCallInvitationState(d.audio,i,d.connecting);var e={action:d.accept,success_cbk:null,failure_cbk:null,extraData:p},t=s.isSmartFlow(a);s.setApiData(a,e),s.makeApiCall(a),t?o.addAudioCallInConnection():u[a].addAudioTrackInConnection()||o.handleInitReNegotiation(a),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_RENEGOTIATION_TRACKADDED}})},o.onDownStreamMediaPermissionFailureSecondary({chatid:l,id:a,cbk:n}))}i.isEmbed()&&!o.isConsentBannerAccepted()&&i.isScreenRecordingEnabled()&&i.isAudioRecordAllowed()?o.showConsentUIForAudioRequest(a,e):e.call()}};n&&n==w.negotiation&&(m.process_type=n),this.timeout[a]=setTimeout(h,65e3),r.handleAudioCallInvite(e,m)}catch(e){}},e.prototype.callConnected=function(e){var t=this,i=e.chid,n=(e.type,e.mid),a=(e.isReconnecting,this.container),o=a.commonImpl,s=a.dataHandler,r=a.mediaUIHandler,c=a.detailsHandler,d=a.constants,l=o.getCallStatusData(n).isdirectcall;clearTimeout(s.get(n+"_connecting_timer"));e=l?function(){return t.handleUIApiCallEnd(n)}:function(){var e={action:d.end,success_cbk:null,failure_cbk:null,extraData:{}};o.setApiData(n,e),o.makeApiCall(n),t.handleCallEnd(n)},a=n;r.updateCallInvitationState(d.audio,{chid:i,callEndCbk:e,muteCbk:function(){return t.toggleMute()},media_id:a,isDirectCall:l},d.connected),o.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected);a=o.getCallStatusData(n);a?a.callStatus=d.connected:a={callStatus:d.connected},o.setCallStatusData(n,a),c.triggerIconCheck(i),o.sendMediaStats({id:n},"call connected ");c="siqMedia: Audio call connected  | chid :"+i+" | mediaid : "+n+" | curUserId : "+c.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,c);i=s.get(i+"_peer");i&&i[n]&&i.reconnectEndTimer&&clearTimeout(i.reconnectEndTimer),l&&o.updateMediaCache(w.siq_directcall,w.status,w.connected),o.updateMediaStatsDetail({connectedTime:Date.now(),isreconnected:!1,mediaid:n}),o.getConnectedStatsDetail(n),o.makeApiCall(n),o.stopNotificationSound()},e.prototype.handleCallAccept=function(t){var i=this,e=this.container,n=e.dataHandler,a=e.constants,o=e.commonImpl,s=e.mediaUIHandler,r=e.detailsHandler,c=o.getWmsPushData(t),d=c.chatid,l=c.type,u=c.processType,p=c.isOldUI,h=c.isMobileOperator,m=c.perfectReNegotiation,_=c.connection_type,f=a.WAITING_TIME,g=d+"_peer",e=n.get(g)||{},y=o.getCallStatusData(t);if(clearTimeout(n.get(t+"_waiting_timer")),n.remove(t+"_waiting_timer"),r.handleOutgoingAccept({type:l,chid:d}),!u||u!=a.negotiation){p&&o.setIsCallInitiatedFromOldUI(p,t),h&&o.setIsMobileOperator(h,t);c.isUpStream=!0,c.iceRestart=!1,e[t]=new S(c,this.container),n.set(g,e),o.updateMediaCache(w.siq_unifiedMedia,w.status,w.accept);e=o.getCallStatusData(t);e?(e.type=l,e.callStatus=a.connecting,e.isPerfectRenegotiation=m,e.connection_type=_):e={callStatus:a.connecting,isPerfectRenegotiation:m,connection_type:_},o.setCallStatusData(t,e),n.set(t+"_connecting_timer",setTimeout(function(){var e={action:a.end,success_cbk:null,failure_cbk:null,extraData:{}};o.setApiData(t,e),o.makeApiCall(t),i.clearData(t),s.updateCallInvitationState(a.audio,{chid:d,media_id:t},a.ended)},f));f={};r.isOldUI()&&(f.is_old_ui=r.isOldUI());f={action:y.host==a.upstream?a.cancel:a.reject,success_cbk:null,failure_cbk:null,extraData:f};o.setApiData(t,f);f={chid:d,media_id:t,isDirectCall:y.isdirectcall,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return y.host,a.upstream,o.makeApiCall(t)}};s.updateCallInvitationState(a.audio,f,a.connecting),o.stopNotificationSound(),o.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_SOUND_STOP,add_info:r.getMediaActivityAddInfo()},mid:t});try{var C={type:l,acceptedTime:Date.now(),callerType:0,reconnectCount:0,mediaid:t};o.setMediaStatsDetail(C)}catch(e){}r="siqMedia: call accept request received  | chid :"+d+" | mediaid : "+t+" | curUserId : "+r.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,r)}},e.prototype.handleCallReject=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.dataHandler,o=t.detailsHandler,s=t.constants,r=i.getWmsPushData(e),c=r.chatid,d=r.processType,t=r.opruser,r=i.getCallStatusData(e),t={chid:c,media_id:e,isDirectCall:r.isdirectcall,lsuid:R(t).lsuid,process_type:d};delete this.iconClicked[c],clearTimeout(a.get(e+"_waiting_timer")),clearTimeout(a.get(e+"_connecting_timer")),n.updateCallInvitationState(s.audio,t,s.rejected),r.isdirectcall&&i.removeMediaCache(s.siq_directcall),d&&d==s.negotiation||(this.clearData(e),i.removeCredential(e),i.removeMediaCache(w.siq_unifiedMedia),o.handleCallRejected({type:s.audio,chid:c}),o="siqMedia: call reject request received  | chid :"+c+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId(),this.callBackAction(this.implConstants.postDebugLog,o))},e.prototype.handleCandidates=function(e){var t=this.container,i=t.dataHandler,n=t.commonImpl,a=n.getWmsPushData(e),o=a.chatid,t=i.get(o+"_peer")[e];t||((t={})[e]=new S(a,this.container),i.set(o+"_peer",t),t=t[e],n.setRemotePerfectReNegotiation(t,e,o)),t.setIceCandidates(a)},e.prototype.handleCallAnswer=function(e){var t=this.container,i=t.commonImpl,n=t.dataHandler,a=i.getWmsPushData(e),o=a.chatid,t=a.session,i=a.tracksId,a=a.negotiationType,e=n.get(o+"_peer")[e];e.remoteTracksId=i?JSON.parse(i):null,e.negotiationType=a||null,e.setAnswerRemoteDesription(t)},e.prototype.handleCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=t.screenShareImpl,r=i.getWmsPushData(e).chatid,c=i.getCallStatusData(e),t={chid:r,media_id:e,isDirectCall:c.isdirectcall};n.updateCallInvitationState(o.audio,t,o.ended),c.isdirectcall&&i.removeMediaCache(o.siq_directcall),s.handleAudioCallEnd(r),this.clearData(e),a.removeAudioPlayers(),a.handleCallEnded({type:o.audio,chid:r})},e.prototype.handleCallOffer=function(e){var t,i,n,a,o,s=this.container,r=s.dataHandler,c=s.constants,d=s.MediaPermission,l=s.commonImpl;l.isSmartFlow(e)||(i=(t=l.getWmsPushData(e)).chatid,n=t.session,a=t.tracksId,o=t.negotiationType,s=r.get(i+"_peer")||{},d.getStreamByType(c.screen_share)&&o==c.screen_share&&r.set(c.isAlreadySharing,!0),t.isUpStream=!1,t.iceRestart=!1,c=s[e],s[e]||(s[e]=new S(t,this.container),r.set(i+"_peer",s),c=s[e]),c.remoteTracksId=a?JSON.parse(a):null,c.negotiationType=o||null,l.setRemotePerfectReNegotiation(c,e,i),this.reinit?c.handleAudioRenegotiation(n):c.setOfferRemoteDescription(n),this.reinit=!1)},e.prototype.handleCallCancel=function(e){try{var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.dataHandler,o=t.detailsHandler,s=t.constants,r=i.getWmsPushData(e),c=r.chatid,d=r.type,l=r.processType,u={chid:c,media_id:e,isDirectCall:i.getCallStatusData(e).isdirectcall};if(clearTimeout(this.timeout[e]),clearTimeout(a.get(e+"_waiting_timer")),clearTimeout(a.get(e+"_connecting_timer")),n.updateCallInvitationState(s.audio,u,s.cancelled),l&&l==s.negotiation)return;i.removeCredential(e),i.removeMediaCache(w.siq_unifiedMedia);var p="siqMedia: call cancel request received  | chid :"+c+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,p),this.clearData(e),o.handleCallCancelled({type:d,chid:c})}catch(e){}},e.prototype.handleCallFailed=function(e){try{var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=(t.screenShareImpl,i.getWmsPushData(e)),r=(s.processType,s.chatid),c=i.getCallStatusData(e),d={chid:r,media_id:e,isDirectCall:c.isdirectcall};n.updateCallInvitationState(o.audio,d,o.failed),c.isdirectcall&&i.removeMediaCache(o.siq_directcall),this.clearData(e),a.handleCallFailed({type:o.audio,chid:r})}catch(e){}},e.prototype.clearData=function(e){try{var t=this.container,i=t.detailsHandler,n=t.commonImpl,a=(t.mediaUIHandler,n.getWmsPushData(e));if(!a)return;var o=a.chatid,s="siqMedia: before clearing Audio call data  | chid :"+o+" | mediaid : "+e+" | curUserId : "+i.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,s),this.closePeerConn(e),this.closeAllPeerConn(e),n.removeCredential(e),n.checkAVIcon(o),n.clearCallDetails(o,e),n.clearMissedCallTimeout(e),n.getActiveCallData()&&n.getActiveCallData()==o&&(n.removeActiveCallData(),n.removeActiveTab(),this.clearMediaPermision(w.audio),i.removeAudioPlayers()),n.removeIncomingRequestData({id:e,chatid:o}),i.isEmbed()&&i.checkIsChatEndTimerAlive(o)||n.stopNotificationSound(),n.checkAndPlayNotification(),i.triggerIconCheck(o),n.clearConnectedStatsDetail(e),n.removeMediaCallDetails(e),n.removeChidMapList(o),n.removeMediaCache(w.siq_unifiedMedia)}catch(e){}},e.prototype.handleCallInvite=function(){},e.prototype.closePeerConn=function(t){var e=this.container,i=e.dataHandler,n=e.detailsHandler,a=e.commonImpl,o=a.getWmsPushData(t),e=o.type,o=o.chatid;try{var s,r=i.get(o+"_peer");r&&(s=r[t],a.clearNetworkTimer(s),s.closeConnection(),delete r[t],this.clearMediaPermision(a.getType(e)),this.removeAudioPlayer())}catch(e){n="siqMedia: error while clearing peer connection  | chid :"+o+" | mediaid : "+t+" | curUserId : "+n.getCurrentUserId()+" | error msg :"+e;this.callBackAction(this.implConstants.postDebugLog,n)}},e.prototype.clearMediaPermision=function(e){"audio_unified_mix"==e?e="audio":"screen_share_smart"!=e&&"screen_view_smart"!=e||(e="screen_share"),this.container.MediaPermission.closeStreamByType(e)},e.prototype.startAudioCall=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.detailsHandler,o=i.mediaUIHandler,s=i.MediaPermission,r=i.MediaDetails,c=i.constants,d=e.chatid,l=e.normalchid,u=e.mode,i=n.getActiveCallData();if((!i||i==d||a.isEmbed())&&!this.iconClicked[l||d]){if(this.iconClicked[l||d]=!0,a.isoldUI&&(e.is_old_ui=a.isoldUI),e.perfect_renegotiation=r.getClientSupport().perfect_renegotiation,i){i=n.getMediaIdByChid(i),i=i?n.getCallStatusData(i):{};if(v(i)&&i.type==c.audio)return void delete this.iconClicked[l||d]}try{var p=a.isembed;if(u!=w.callMode.P2P||(!!p||this.isAudioCallAllowed(e))){if(a.isAudioCallDisabled(d))return void delete this.iconClicked[l||d];var h,m=function(){clearTimeout(permissionUItimer)};this.isWaitingForPermission=!0,this.getAudioInputDevice()&&!a.isOldUI()&&(h=this.getAudioInputDevice(),s.updatePreferredDeviceByDeviceId(h,"audioInput"));function _(){permissionUItimer=setTimeout(function(){m=o.mediaPermissionUI()},3e3);s.getAudioStream(function(){m(),t.onMediaPermissionSuccess(e).call(t)},t.onUpStreamMediaPermissionFailure(function(){return m()},d))}var f,g=o.getUIState().states,y=g&&g[l||d]&&g[l||d].screen_share;a.isEmbed()&&a.isScreenRecordingEnabled()&&a.isAudioRecordAllowed()&&!this.isConsentBannerAccepted()&&y?(delete this.iconClicked[l||d],f={cancelCbk:function(){t.handleUICancel(y.media_id)},muteCbk:function(){return t.toggleMute()},chid:l,media_id:y.media_id},o.handleAudioCallInitiate(c.audio,f),this.showConsentUI(y.media_id,!1,_,function(){t.hideConsentUI(y.media_id),t.isWaitingForPermission=!1;var e=n.getCallStatusData(y.media_id),e={chid:l||d,media_id:y.media_id,isDirectCall:e.isdirectcall};o.updateCallInvitationState(c.audio,e,c.rejected)})):_.call()}else{var C="siqMedia: To start AUDIO call - permission checks failed | chid - "+d+" ";this.callBackAction(this.implConstants.postDebugLog,C),delete this.iconClicked[l||d]}}catch(e){}}},e.prototype.constructResponeObj=function(e){return Object.assign({},{type:"audio"},e)},e.prototype.onMediaPermissionSuccess=function(t){var i=this;try{var e=this.container,n=e.constants,a=e.commonImpl,o=e.ajaxHandler,s=e.MediaPermission,r=t.normalchid,c=t.chatid,d=t.mode,l=t.mediainvitation,u=t.mediarequest,c=(t.type,n.WAITING_TIME_SECS,r||c),p=a.getMediaIdByChid(c),h=p?a.getCallStatusData(p):{};if(t.mode=d||n.visitor,!this.isCallAllowed(c))return s.closeStreamByType(n.audio),delete this.iconClicked[c],function(){i.isWaitingForPermission=!1};var m=this.constructResponeObj(t);a.setActiveTab(),m.mediainvitation=l||!1,m.mediarequest=u||!1;var _=a.constructURL(null,null);return a.setActiveCallData(c),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED}}),function(){i.isWaitingForPermission=!1;var e=i.onstarted.bind(i);if(v(h)){m={};a.getCallStatusData(p).type;return _=a.constructURL(n.audio,p),e=function(){return i.onstartedSecondary({chid:c,id:p,negotiationType:m.negotiation_type||n.audio})},m.action=w.request,m.process_type=w.negotiation,m.negotiation_type=w.audio,void o.put(_,m,e,i.startCallFailure.bind(i),!0,"v3")}delete t.normalchid,m.normalchid&&delete m.normalchid,o.post(_,m,e,i.startCallFailure.bind(i),!0,!1,"v3")}}catch(e){}},e.prototype.onUpStreamMediaPermissionFailure=function(i,n){var a=this,e=this.container,o=e.commonImpl,s=e.mediaUIHandler;return function(e,t){o.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED}}),i(),a.isWaitingForPermission=!1;e=o.getFailureMessage(e);s.mediaPermissionUnlock(),s.showDialog({desc:e,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),delete a.iconClicked[n]}},e.prototype.onDownStreamMediaPermissionFailure=function(e){var o=this,t=this.container,s=t.commonImpl,r=t.mediaUIHandler,c=t.detailsHandler,d=t.constants,l=e.chatid,u=e.id,p=e.cbk;return function(e,t){try{s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED},mid:u}),p(),r.mediaPermissionUnlock();var i=s.getFailureMessage(e),n={closed_reason:d.mic_permission_blocked};c.isOldUI()&&(n.is_old_ui=c.isOldUI());var a={action:d.reject,success_cbk:null,failure_cbk:null,extraData:n};s.setApiData(u,a),s.makeApiCall(u),c.handleCallRejected(),o.clearData(u),s.removeActiveTab(),r.updateCallInvitationState(d.audio,{chid:l,media_id:u},d.rejected),r.showDialog({desc:i,buttons:{accept:{text:"common.ok",callback:function(){return null}}}})}catch(e){}}},e.prototype.onDownStreamMediaPermissionFailureSecondary=function(e){var t=this.container,a=t.commonImpl,o=t.mediaUIHandler,i=t.detailsHandler,s=t.constants,r=e.chatid,c=e.id,d=e.cbk,l={process_type:s.negotiation,negotiation_type:s.audio};return i.isOldUI()&&(l.is_old_ui=i.isOldUI()),function(e,t){try{a.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED},mid:c}),d(),o.mediaPermissionUnlock();var i=a.getFailureMessage(e),n={action:s.reject,success_cbk:null,failure_cbk:null,extraData:l};a.setApiData(c,n),a.makeApiCall(c),o.updateCallInvitationState(s.audio,{chid:r,media_id:c},s.rejected),o.showDialog({desc:i,buttons:{accept:{text:"common.ok",callback:function(){return null}}}})}catch(e){}}},e.prototype.isAudioCallAllowed=function(t){var e=this.container,i=e.commonImpl,n=e.mediaUIHandler,a=e.detailsHandler,e=e.MediaDetails,t=t.chatid;try{var o=a.getVisitorBrowser(t),s=a.getVisitorPage(t),r=!0,c="",d="",l=a.getVisitorID(t);return i.getMediaDataByChidAndType({chatid:t,type:this.audio})?(d="siqMedia - Call data not cleared/call ongoing | chid - "+t+" | visitorId - "+l,this.callBackAction(this.implConstants.postDebugLog,d),!1):(a.isChatMonitor(t)?(d="siqMedia - call Not Allowed because chat is in monitor | chid - "+t+" | chatMonitors - "+MediaLib.getConversationByCHID(chid).chat.ismonitor,c=a.I18N("av.info.chatinvite"),r=!1):a.isVisitorBrowserSupported(t)?e.checkBrowserSupported(w.audio)?a.isVisitorPageSecured(t)?a.isGroupConversation(t)?(c=a.I18N("av.info.chatinvite"),d="siqMedia - Failed Visitor not in secure connection | chid - "+t+" |  visitorId - "+l,r=!1):a.isAttenderBot(t)?(d="siqMedia - Failed bot attender | chid - "+t+" |  visitorId - "+l,r=!1):a.isFaceBookIntegration(t)&&(c=a.I18N("av.info.facebookpagenotsupported"),d="siqMedia - Failed Visitor is in Facebook page | chid - "+t+" |  visitorId - "+l,r=!1):(c=a.I18N("av.info.insecuredwebsite"),d="siqMedia - Failed Visitor not in secure connection | chid - "+t+" |  visitor page - "+s,r=!1):(c=a.I18N("av.audio.info.agentbrowsernotsupported"),d="siqMedia - Failed agent browser not supported| chid - "+t,r=!1):(c=a.I18N("av.audio.info.visitorbrowsernotsupported"),d="siqMedia - Failed visitor browser not supported | chid - "+t+" | browser-"+o,r=!1),r||(n.showDialog({desc:c,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),this.callBackAction(this.implConstants.postDebugLog,d)),r)}catch(e){this.callBackAction(this.implConstants.postDebugLog,"siqMedia - Failed in isAudioCallAllowed method | chid - "+t)}},e.prototype.postDebugLog=function(e){this.container.detailsHandler.sendDebugLogger(e,null,null,!0)},e.prototype.callBackAction=function(e,t){({postDebugLog:this.postDebugLog.bind(this)})[e](t)},e.prototype.init=function(){this.implConstants={postDebugLog:"postDebugLog"}},e.prototype.addRemoteStream=function(e,t){var i=this,n=this.container,a=n.detailsHandler,o=n.commonImpl,s=n.mediaUIHandler,r=n.constants,c=t.chid,d=t.mid,l=t.type,n=t.negotiationType,t=o.getCallStatusData(d).isdirectcall;try{var u="siqMedia: adding remote stream  | chid :"+c+" | mediaid : "+d+" | lsuid : "+a.getCurrentUserId(),p=t?function(){i.handleUIApiCallEnd(d)}:function(){i.handleUIEnd(d)};n==r.audio&&s.updateCallInvitationState(r.audio,{chid:c,id:d,callEndCbk:p},r.connected),this.callBackAction(this.implConstants.postDebugLog,u);var h,m="",_=e.stream;l!=this.audio&&n!=this.audio&&l!=r.audio_unified_mix||(m=this.addAudioPlayer()),e.streams&&(_=e.streams[0]);try{m.srcObject=_,this.getAudioOutputDevice()&&!a.isOldUI()&&(h=this.getAudioOutputDevice(),this.changeAudioPlayer(h,c))}catch(e){m.src=window.URL.createObjectURL(_)}o.checkAndUpdateUIForApi()}catch(e){a="siqMedia: adding remote stream  | chid :"+c+" | mediaid : "+d+" | lsuid : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,a)}},e.prototype.addAudioPlayer=function(){try{var e="siqMedia: creating audio player stream  | curUserId : "+this.container.detailsHandler.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,e);var t=document.querySelector("#remoteaudio");if(null!=t&&0!=t.length)return t;var i=document.createElement("audio");return i.id="remoteaudio",i.autoplay=!0,document.querySelector("body").appendChild(i),i}catch(e){}},e.prototype.removeAudioPlayer=function(){var e=document.querySelector("#remoteaudio");e.parentNode.removeChild(e)},e.prototype.startCallFailure=function(e){this.iconClicked={},callBackAction()},e.prototype.startcall=function(e,t,i){var n={},a=this.container,o=a.ajaxHandler,s=a.commonImpl,a=a.constants;n.type=e,n.chatid=t,n.mode=i||a.visitor;a=s.constructURL(null,null);s.setActiveCallData(t),o.post(a,n,this.onstarted,this.startCallFailure)},e.prototype.handleUIReject=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),r=s.chatid,t=s.type,s={chid:r,media_id:e,isDirectCall:i.getCallStatusData(e).isdirectcall};n.updateCallInvitationState(o.audio,s,o.rejected);s={};a.isOldUI()&&(s.is_old_ui=a.isOldUI());s={action:o.reject,success_cbk:null,failure_cbk:null,extraData:s};i.setApiData(e,s),i.makeApiCall(e),i.removeMediaCache(w.siq_unifiedMedia),this.clearData(e),a.handleCallRejected({type:t,chid:r});a="siqMedia -  reject trigger from UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,a)},e.prototype.handleUIEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.screenShareImpl,s=t.constants,r=i.getWmsPushData(e),c=r.type,t=r.chatid,r=i.getCallStatusData(e);try{var d={chid:t,media_id:e,isDirectCall:r.isdirectcall},l={action:s.end,success_cbk:null,failure_cbk:null,extraData:{}};i.clearConnectingTimer(e),i.setApiData(e,l),i.makeApiCall(e),n.updateCallInvitationState(s.audio,d,s.ended),a.triggerIconCheck(t),this.clearData(e),a.removeAudioPlayers(),o.handleAudioCallEnd(t),this.container.detailsHandler.handleCallEnded({type:c,chid:t})}catch(e){}},e.prototype.endOngoingCall=function(e,t,i){try{var n=this.container,a=n.dataHandler,o=n.mediaUIHandler,s=n.commonImpl,r=n.screenShareImpl,c=n.detailsHandler,d=n.constants,l=a.get(e+"_peer");if(r.handleAudioCallEnd(e),l)for(var u in l){var p=l[u],h=p.type,m=p.mid;o.updateCallInvitationState(h,{chid:e,media_id:m},d.ended);var _={action:d.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(m,_),s.makeApiCall(m),this.clearData(m),delete l[u]}else{var f={action:d.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(t,f),s.makeApiCall(t),this.clearData(t)}s.stopNotificationSound(),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_SOUND_STOP,add_info:c.getMediaActivityAddInfo()},mid:t}),s.removeActiveCallData(e)}catch(e){}},e.prototype.endFailedCall=function(e){var t=this.container,i=t.dataHandler,n=t.mediaUIHandler,a=t.commonImpl,o=t.constants,s=a.getWmsPushData(e),t=s.chatid,s=s.type;try{var r=i.get(t+"_peer");a.updateFailedTimeForMediaStats({failedTime:Date.now(),isreconnected:!1,mediaid:e}),a.getFailedStatsDetail(e),a.makeApiCall(e),n.updateCallInvitationState(s,{chid:t,media_id:e},o.failed),this.clearData(e),delete r[e]}catch(e){}},e.prototype.__handleUIAccept=function(t){var e,i,n,a,o=this,s=this.container,r=s.commonImpl,c=s.detailsHandler,d=s.mediaUIHandler,l=s.MediaPermission,u=s.dataHandler,p=s.constants,h=s.MediaDetails,m=r.getWmsPushData(t),_=m.chatid,f=(m.mediaInvitation,r.getActiveCallData()),g=r.getMediaIdByChid(f),y=g?r.getCallStatusData(g):{},C=r.getCallStatusData(t);c.isOldUI()&&c.focusChatWindow(_),f&&f!=_&&(e=y.type,i=y.callStatus,n=y.isdirectcall,a=y.host,s=r.getImplType(e),s+="Impl",m=function(){return n&&c.endSession(f)},y={type:e,chid:f,media_id:g},i==p.connected?(e.includes(p.connectionType.UNIFIED)||e.includes(p.connectionType.SMART)?this.container.commonImpl.endOngoingUnifiedCall(g,f,m):this.container[s].endOngoingCall(f,g,m),d.updateCallInvitationState(e,y,p.ended)):i!=p.ringing&&i!=p.connecting||(a==p.upstream?this.container[s].handleUICancel(g):this.container[s].handleUIReject(g),r.removeActiveCallData()),this.clearData(g));var v=function(){clearTimeout(S)},S=setTimeout(function(){v=d.mediaPermissionUI()},3e3);l.getAudioStream(function(){v(),r.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED},mid:t});var e=r.getCallStatusData(t);e?e.callStatus=p.connecting:e={callStatus:p.connecting},r.setCallStatusData(t,e),r.setActiveCallData(_);e={};c.isoldUI&&(e.is_old_ui=c.isoldUI),e.perfect_renegotiation=h.getClientSupport().perfect_renegotiation,e.session_id=c.getSessionID();e={action:p.accept,success_cbk:null,failure_cbk:null,extraData:e};r.setApiData(t,e),r.makeApiCall(t),d.updateCallInvitationState(p.audio,{chid:_,media_id:t,muteCbk:function(){return o.toggleMute()},rejectCbk:function(){return C.host==p.upstream?o.handleUICancel(t):o.handleUIReject(t)}},p.connecting);e=p.WAITING_TIME;u.set(t+"_connecting_timer",setTimeout(function(){var e={action:p.end,success_cbk:null,failure_cbk:null,extraData:{}};r.setApiData(t,e),r.makeApiCall(t),o.clearData(t),d.updateCallInvitationState(p.audio,{chid:_,media_id:t},p.ended),r.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INVITATION_CLEARED,add_info:c.getMediaActivityAddInfo()},mid:t})},e))},this.onDownStreamMediaPermissionFailure({chatid:_,id:t,cbk:v})),r.removeIncomingRequestData({id:t,chatid:_}),r.setActiveTab(),r.stopNotificationSound(),r.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_SOUND_STOP,add_info:c.getMediaActivityAddInfo()},mid:t})},e.prototype.handleUIAccept=function(e){var t=this,i=this.container,n=i.detailsHandler,a=i.mediaUIHandler,o=i.commonImpl,s=o.getWmsPushData(e),r=s.type,i=s.chatid,s=o.getActiveCallData();this.isWaitingForPermission||(o.isSmartFlow(e)&&n.isEmbed()&&!n.isScreenRecordingEnabled()&&n.showEmbedBanner("av.info.recording.disclaimer",5e3,i),o.updateMediaCache(w.siq_unifiedMedia,w.status,w.accept),s&&s!=i?a.handleCallClash(function(){return t.__handleUIAccept(e)},function(){return t.handleUIReject(e)}):this.__handleUIAccept(e),a={type:r,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:e},o.setMediaStatsDetail(a),n.handleIncomingAccept({type:r,chid:i}))},e.prototype.handleUICancel=function(e){var t=this.container,i=t.detailsHandler,n=t.mediaUIHandler,a=t.commonImpl,o=t.dataHandler,s=t.constants,r=a.getWmsPushData(e),t=r.type,r=r.chatid;n.updateCallInvitationState(t,{chid:r,media_id:e},s.cancelled);n=a.getCallStatusData(e);n&&(n.callStatus=s.cancelled),a.setCallStatusData(e,n);n={};i.isOldUI()&&(n.is_old_ui=i.isOldUI());n={action:s.cancel,success_cbk:null,failure_cbk:null,extraData:n};a.setApiData(e,n),a.makeApiCall(e),a.removeMediaCache(w.siq_unifiedMedia),this.clearData(e),i.handleCallCancelled({type:t,chid:r}),clearTimeout(this.timeout[e]),clearTimeout(o.get(e+"_waiting_timer")),clearTimeout(o.get(e+"_connecting_timer")),o.remove(e+"_waiting_timer"),i.clearChatWindow(),i.clearPlayer()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:e});i="siqMedia - cancel trigger from UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+i.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,i)},e.prototype.toggleMute=function(){this.container.MediaPermission.toggleMute()},e.prototype.startVisitorAudioCall=function(e){var t=this.container.constants,t={chatid:e,mode:t.visitor,mediarequest:!0,mediainvitation:!0,type:t.audio};this.startAudioCall(t)},e.prototype.handleCallMissed=function(t){var i=this.container,n=i.detailsHandler,e=i.mediaUIHandler,a=i.constants,o=i.commonImpl,s=o.getWmsPushData(t),i=s.chatid,s=s.processType;try{delete this.iconClicked[i];var r={chid:i,media_id:t};if(clearTimeout(this.timeout[t]),e.updateCallInvitationState(a.audio,r,a.missed),s&&s==a.negotiation)return void this.hideConsentUI(t);o.removeMediaCache(w.siq_unifiedMedia),this.clearData(t),n.handleCallMissed({type:a.audio,chid:i})}catch(e){n="siqMedia - call missed  | chid :"+i+" | mediaid : "+t+" | curUserId : "+n.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,n)}},e.prototype.acceptAudioCallForDsk=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,t=i.getMediaDataByChidAndType({chatid:e,type:this.audio}).id;clearTimeout(this.timeout[t]);e={chatid:e,id:t,type:this.type,mediaInvitation:!0};i.setWmsPushData(t,e),this.handleUIAccept(t),n.clearAudioCallInvite(this.audio,t)},e.prototype.rejectAudioCallForDsk=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,t=i.getMediaDataByChidAndType({chatid:e,type:this.audio}).id;clearTimeout(this.timeout[t]);e={chatid:e,id:t,type:this.type};i.setWmsPushData(t,e),this.handleUIReject(t),n.clearAudioCallInvite(this.audio,t)},e.prototype.hasIncommingCall=function(e){var t=this.container,i=t.commonImpl,n=t.constants,a=i.getActiveCallData(),t=i.getMediaIdByChid(a),t=t?i.getCallStatusData(t):{};return!(!v(t)||(t.type!=n.audio||t.callType!=n.incoming||t.callStatus!=n.ringing)&&a!=e)},e.prototype.handleCallRequestSuccesCbk=function(e){e.mid,e.chid},e.prototype.initCallRequest=function(e){var t=e.mid,i=e.negotiationType,n=e.chid,a=this.container,o=a.commonImpl,e=a.dataHandler,s=a.constants,r=a.mediaUIHandler,c=a.screenShareImpl,a=a.detailsHandler,d={negotiation_type:i,process_type:s.negotiation};a.isOldUI()&&(d.is_old_ui=a.isOldUI());e.set(t+"_connecting_timer",setTimeout(function(){var e={action:s.miss,success_cbk:null,failure_cbk:null,extraData:d};o.setApiData(t,e),o.makeApiCall(t);e=r.getUIState().states[n];e&&e.screen_share&&e.screen_share.type!=s.sharing&&!o.getSwapRequestCallbackState()?(r.updateCallInvitationState(s.screenshare,{chid:n,media_id:t},s.requestMissed),r.deleteScreenShareState(n)):o.getSwapRequestCallbackState()&&c.handlingRequestStateOnSwap(n,t,s.requestMissed)},s.WAITING_TIME));e={action:s.request,success_cbk:null,failure_cbk:null,extraData:d};o.setApiData(t,e),o.makeApiCall(t)},e.prototype.addScreenShareTrack=function(e){var t=e.chid,i=e.id,e=this.container,n=e.commonImpl,a=e.screenShareImpl,o=e.MediaPermission,s=e.mediaUIHandler,r=e.constants,c=n.getMediaIdByChid(t),d=n.getPeerObject(i);o.getScreenShareStream(function(){d.addScreenTrackInConnection()||a.handleInitReNegotiation(i),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED}});var e=s.getUIState().states[t];e.screen_share=e.screen_share||{};e=function(){return a.handleUIEnd(c)};s.makeScreenShareConnected(r.screen_share,{chid:t,media_id:c,callEndCbk:e,ss_type:r.sharing}),o.screenEndFromBrowserUI(e),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:c})},function(){n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED},mid:c})})},e.prototype.handleAudioCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.MediaPermission,a=t.commonImpl,o=t.detailsHandler,s=t.constants,r=a.getWmsPushData(e).chatid,t=a.getCallStatusData(e);n.closeStreamByType(s.audio),i.clearAudioCallInvite(s.audio,e);t={chid:r,media_id:e,isDirectCall:!!t&&t.isdirectcall};i.updateCallInvitationState(s.audio,t,s.ended),i.stopTimer(r),i.clearAllStates(r),o.clearAudioUI(),o.clearChatWindow(),o.clearPlayer()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e}),o.clearPopup()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e})},e.prototype.isCallAllowed=function(e){for(var t=this.container,i=t.dataHandler,n=t.detailsHandler,t=t.constants,a=i.get(t.media_inv),o=0;a&&a.length>o;o++)if(a[o][e=n.isembed?n.getChatWinObjById(e,!0).RCHID:e])return!1;return!0},e.prototype.handleInitReNegotiation=function(e){var t=this.container,i=t.commonImpl,n=t.constants;this.reinit=!0;t={process_type:n.reinit,negotiation_type:n.audio},t={action:n.request,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},e.prototype.changeAudioPlayer=function(e,t){var i=document.querySelector("#remoteaudio");void 0!==i.sinkId&&(this.setAudioOutputDevice(e),i.setSinkId(e),this.container.commonImpl.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED}}))},e.prototype.changeAudioInputDevice=function(e,t,i){var n=this,a=this.container,o=a.MediaPermission,a=a.commonImpl,t=a.getActiveMediaID(t),s=a.getPeerObject(t);s&&s.removeAudioTrackInConnection(),o.updatePreferredDeviceByDeviceId(e,"audioInput"),o.getAudioStream(function(){s.audioRenegotiation(),i&&n.toggleMute(),n.setAudioIputDevice(e),n.container.commonImpl.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INPUT_DEVICE_CHANGED}})},function(){})},e.prototype.setAudioIputDevice=function(e){localStorage.setItem("siqmedia_audio_input_device",D(e))},e.prototype.setAudioOutputDevice=function(e){localStorage.setItem("siqmedia_audio_output_device",D(e))},e.prototype.getAudioInputDevice=function(){return R(localStorage.getItem("siqmedia_audio_input_device"))},e.prototype.getCurrentStreamDeviceId=function(){var e=this.container.MediaPermission.getStreamByType(w.audio);return e&&e.getAudioTracks()&&e.getAudioTracks()[0].getSettings().deviceId},e.prototype.getAudioOutputDevice=function(){return R(localStorage.getItem("siqmedia_audio_output_device"))},e.prototype.showConsentUI=function(e,t,i,n){var a=this;void 0===t&&(t=!1),void 0===i&&(i=void 0),void 0===n&&(n=void 0);var o=this.container,s=o.mediaUIHandler,o={acceptCbk:function(){a.setConsentBannerAccepted(),a.hideConsentUI(e),"function"==typeof i?i.call():t?a.handleUIAccept(e):a.__handleunifiedcallcredentail(e)},rejectCbk:function(){"function"==typeof n?n.call():a.handleUIConsentReject(e)},chid:o.commonImpl.getWmsPushData(e).chatid};s.updateCallInvitationState(w.audio,o,w.showConstent)},e.prototype.handleUIConsentReject=function(e){this.hideConsentUI(e);var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=t.dataHandler,r=i.getWmsPushData(e),c=r.chatid,d=r.type,t=(r.negotiationType,{chid:c,media_id:e,isDirectCall:i.getCallStatusData(e).isdirectcall,isConsent:!0}),r={};a.isOldUI()&&(r.is_old_ui=a.isOldUI()),r.is_consent_allowed=!1;r={action:o.reject,success_cbk:null,failure_cbk:null,extraData:r};i.setApiData(e,r),i.makeApiCall(e),n.updateCallInvitationState(o.audio,t,o.rejected),i.removeMediaCache(w.siq_unifiedMedia),this.clearData(e),clearTimeout(this.timeout[e]),clearTimeout(s.get(e+"_waiting_timer")),clearTimeout(s.get(e+"_connecting_timer")),a.handleCallRejected({type:d,chid:c});a="siqMedia -  reject trigger from consent UI | chid :"+c+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,a)},e.prototype.hideConsentUI=function(e){var t=this.container,i=t.mediaUIHandler,e=t.commonImpl.getWmsPushData(e).chatid;i.clearConsentUIState(e)},e.prototype.isConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();return!!e.getValueInSession(t)},e.prototype.setConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();e.setValueInSession(t,!0)},e.prototype.getConsentCookieKey=function(){var e=this.container.detailsHandler,t=e.getAppName(),i=e.getApiVisitorId(),e=e.getAVUID();return i?i+"_"+t+"_audio_consent":e+"_"+t+"_audio_consent"},e.prototype.showConsentUIForAudioRequest=function(t,e){var i=this,n=this.container,a=n.mediaUIHandler,o=n.commonImpl,s=n.constants,n=o.getWmsPushData(t),r=n.chatid,c=n.negotiationType,n={acceptCbk:function(){i.setConsentBannerAccepted(),i.hideConsentUI(t),e.call()},rejectCbk:function(){i.hideConsentUI(t);var e={process_type:s.negotiation,negotiation_type:c,is_consent_allowed:!1};clearTimeout(i.timeout[t]),a.updateCallInvitationState(s.audio,{chid:r,media_id:t},s.rejected);e={action:s.reject,success_cbk:null,failure_cbk:null,extraData:e};o.setApiData(t,e),o.makeApiCall(t)},chid:r};a.updateCallInvitationState(w.audio,n,w.showConstent)};function c(e){e.videoImpl=this}c.prototype.handleInvitation=function(){},c.prototype.handleCallAccept=function(){},c.prototype.handleCallReject=function(){},c.prototype.handleCandidates=function(){},c.prototype.handleCallAnswer=function(){},c.prototype.handleCallEnd=function(){},c.prototype.handleCallOffer=function(){},c.prototype.handleCallCancel=function(){},c.prototype.handleCallCancel=function(){},c.prototype.handleCallInvite=function(){};var l=function(e){e.screenShareImpl=this,e.screen_viewImpl=this,e.screen_share_smartImpl=this,(e.screen_view_smartImpl=this).container=e,this.timeout={},this.init(),this.reinit=!1,this.removeTrackOnReNegotiation=!1};l.prototype.setCredential=function(e){this.container.commonImpl.setCredential(e)},l.prototype.handleInvitation=function(i){var n=this,e=this.container,a=e.commonImpl,t=e.mediaUIHandler,o=e.MediaPermission,s=e.detailsHandler,r=e.MediaDetails,c=e.constants,d=a.getWmsPushData(i),l=d.chatid,u=d.type,p=d.perfectReNegotiation,h=d.mediaInvitation,m=d.mediaRequest,_=d.connection_type,f=d.recordingType;a.endCallFromSameChat(i),s.isEmbed()&&s.clearBusyUI();function g(){return y(!1)}var y=function(e){(e=void 0===e?!0:e)&&a.isSmartFlow(i)&&s.isScreenRecordingEnabled()&&!n.isConsentBannerAccepted()&&n.setConsentBannerAccepted(),clearTimeout(n.timeout[i]),e?n.handleUIAccept(i):n.handleUIReject(i);try{var t={type:u,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:i};a.setMediaStatsDetail(t)}catch(e){}},e={chid:l,media_id:i,rejectCbk:g,acceptCbk:y},d={};if(s.isOldUI()&&(d.is_old_ui=s.isOldUI()),a.checkIncomingCallAllowed(i)){d={action:c.reject,success_cbk:null,failure_cbk:null,extraData:d};return a.setApiData(i,d),a.makeApiCall(i),!0}if(a.setScreenShareRequestData(l),a.setCredential(i),h){h={callType:c.incoming,callStatus:c.ringing,mediarequest:m,host:c.downstream,isdirectcall:!1,isPerfectRenegotiation:p,type:u,connection_type:_,recording_type:f};a.setCallStatusData(i,h),t.handleAudioCallInvite(c.screen_share,e),a.setMediaCache(w.siq_unifiedMedia,{chid:l,type:u,media_id:i,status:w.incoming});e={chatid:l,type:c.audiocall,duration:"1",tone:c.requestscreensahre,isEncrypted:!1};a.playMediaNotificationSound(e),this.timeout[i]=setTimeout(g,65e3)}else{var C={perfect_renegotiation:r.getClientSupport().perfect_renegotiation,session_id:getSid()};a.setMediaCache(w.siq_unifiedMedia,{chid:l,type:u,media_id:i,status:w.accept});f={callType:c.incoming,callStatus:c.connecting,mediarequest:m,host:c.downstream,isdirectcall:!1,isPerfectRenegotiation:p,type:u,connection_type:_,recording_type:f};a.setCallStatusData(i,f),m?o.getScreenShareStream(function(){var e;a.isScreenRequestPending(l)&&(e={action:c.accept,success_cbk:null,failure_cbk:null,extraData:C},a.setApiData(i,e),a.makeApiCall(i),o.screenEndFromBrowserUI(function(){return n.handleUIEnd(i)}),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:i}))},this.onMediaPermissionFailure(i)):(a.setActiveCallData(l),setTimeout(function(){var e={action:c.accept,success_cbk:null,failure_cbk:null,extraData:C};a.setApiData(i,e),a.makeApiCall(i)},2e3)),a.setActiveTab(),s.triggerIconCheck(l);try{var v={type:u,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:i};a.setMediaStatsDetail(v)}catch(e){}}s.handleIncomingCall({type:u,chid:l})},l.prototype.handleAcceptSuccessCbk=function(e){var t=this.container,i=t.dataHandler,n=t.constants,a=t.commonImpl.getWmsPushData(e).chatid,o=a+"_peer",t=i.get(o)||{},n={id:e,chatid:a,type:n.screen_share,iceRestart:!1,isUpStream:!0,mediaRequest:!0};t[e]=new S(n,this.container),i.set(o,t)},l.prototype.handleCallAccept=function(t){var i=this,e=this.container,n=e.dataHandler,a=e.commonImpl,o=e.constants,s=e.mediaUIHandler,r=e.detailsHandler,c=a.getWmsPushData(t),d=c.chatid,l=c.type,u=c.processType,p=c.perfectReNegotiation,h=c.connection_type;if(u&&u==o.negotiation)return a.clearConnectingTimer(t),a.clearMissedCallTimeout(t),s.deleteScreenShareState(d),void a.deleteSwapRequestCallbackState();e=d+"_peer",u=n.get(e)||{};c.isUpStream=!0,c.iceRestart=!1,l==o.screen_share&&(u[t]=new S(c,this.container),n.set(e,u)),clearTimeout(n.get(t+"_waiting_timer")),n.remove(t+"_waiting_timer");var m={};r.isOldUI()&&(m.is_old_ui=r.isOldUI());r={chid:d,media_id:t,muteCbk:function(){},rejectCbk:function(){var e={action:o.cancel,success_cbk:null,failure_cbk:null,extraData:m};a.setApiData(t,e),a.makeApiCall(t),s.updateCallInvitationState(l,{chid:d,media_id:t},o.cancelled),i.clearData(t)}};try{var _={type:l,acceptedTime:Date.now(),callerType:0,reconnectCount:0,mediaid:t};a.setMediaStatsDetail(_)}catch(e){}_=a.getCallStatusData(t);_?(_.callStatus=o.connecting,_.isPerfectRenegotiation=p,_.connection_type=h):_={callStatus:o.connecting,isPerfectRenegotiation:p,connection_type:h},a.setCallStatusData(t,_),s.updateCallInvitationState(o.screen_share,r,o.connecting)},l.prototype.handleCallReject=function(e){var t=this.container,i=t.detailsHandler,n=t.mediaUIHandler,a=t.constants,o=t.commonImpl,s=o.getWmsPushData(e),r=s.chatid,t=s.type,s=s.processType;if(s&&s==a.negotiation)return o.getSwapRequestCallbackState()?this.handlingRequestStateOnSwap(r,e,a.requestRejected):n.getUIState().states[r][a.screen_share].status==a.requested&&n.updateCallInvitationState(a.screen_share,{chid:r,media_id:e},a.rejected),o.clearMissedCallTimeout(e),void o.clearConnectingTimer(e);n.updateCallInvitationState(a.screen_share,{chid:r,media_id:e},a.rejected),this.clearData(e),o.removeMediaCache(w.siq_unifiedMedia),i.handleCallRejected({type:t,chid:r})},l.prototype.handleCandidates=function(e){var t=this.container,i=t.dataHandler,n=t.commonImpl,a=n.getWmsPushData(e),o=a.chatid,t=i.get(o+"_peer")[e];t||((t={})[e]=new S(a,this.container),i.set(o+"_peer",t),t=t[e],n.setRemotePerfectReNegotiation(t,e,o)),t.setIceCandidates(a)},l.prototype.handleCallAnswer=function(e){var t=this.container,i=t.commonImpl,n=t.dataHandler,a=i.getWmsPushData(e),o=a.chatid,t=a.session,i=a.tracksId,a=a.negotiationType,e=n.get(o+"_peer")[e];e.remoteTracksId=i?JSON.parse(i):null,e.negotiationType=a||null,e.setAnswerRemoteDesription(t)},l.prototype.handleCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.audioImpl,o=t.commonImpl,s=t.constants,r=o.getWmsPushData(e),c=r.type,d=r.chatid,t=r.negotiationType,r=r.processType;e==o.getActiveMediaID(d)&&(t!=w.screen_share||r!=w.negotiation?(i.updateCallInvitationState(c,{chid:d,media_id:e},s.ended),i.deleteScreenShareState(d),n.clearChatWindow(),i.deletePlayer(d),n.clearPlayer()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),n.clearPopup()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),a.handleAudioCallEnd(e),this.clearData(e),o.removeMediaCache(w.siq_unifiedMedia),n.handleCallEnded({type:c,chid:d})):this.handleStopScreenShare(e))},l.prototype.handleCallOffer=function(e){var t=this.container,i=t.dataHandler,n=t.constants,a=t.MediaPermission,o=t.commonImpl,s=o.getWmsPushData(e),r=s.chatid,c=s.session,d=s.tracksId,l=s.negotiationType,t=i.get(r+"_peer")||{};a.getStreamByType(n.screen_share)&&l==n.screen_share&&!this.reinit&&i.set(n.isAlreadySharing,!0),s.isUpStream=!1,s.iceRestart=!1;n=t[e];t[e]||(t[e]=new S(s,this.container),i.set(r+"_peer",t),n=t[e]),n.remoteTracksId=d?JSON.parse(d):null,n.negotiationType=l||null,o.setRemotePerfectReNegotiation(n,e,r);try{this.reinit?(n.handleScreenShareRenegotiation(c,this.removeTrackOnReNegotiation),this.removeTrackOnReNegotiation=!1):n.setOfferRemoteDescription(c),this.reinit=!1}catch(e){}},l.prototype.handleCallCancel=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),r=s.chatid,c=s.type,t=s.processType,s={chid:r,media_id:e};i.deleteScreenShareRequestData(r),a.isEmbed()&&a.clearConformBox()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e}),clearTimeout(this.timeout[e]),t&&t==o.negotiation||(n.updateCallInvitationState(o.screen_share,s,o.cancelled),i.removeCredential(e),this.clearData(e),e="siqMedia: call cancel request received  | chid :"+r+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId(),this.callBackAction(this.implConstants.postDebugLog,e),i.removeMediaCache(w.siq_unifiedMedia),a.handleCallCancelled({type:c,chid:r}))},l.prototype.handleCallFailed=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),r=s.chatid,t=s.type,i=s.processType,s={chid:r,media_id:e};clearTimeout(this.timeout[e]),i&&i==o.negotiation||(n.updateCallInvitationState(o.screen_share,s,o.failed),this.clearData(e),a.handleCallFailed({type:t,chid:r}))},l.prototype.handleUIReject=function(e){var t=this.container,i=t.mediaUIHandler,n=t.commonImpl,a=t.detailsHandler,o=t.constants,s=n.getWmsPushData(e),r=s.chatid,t=s.type,s={};a.isOldUI()&&(s.is_old_ui=a.isOldUI()),i.updateCallInvitationState(t,{chid:r,mid:e},o.rejected);s={action:o.reject,success_cbk:null,failure_cbk:null,extraData:s};n.setApiData(e,s),n.makeApiCall(e),this.clearData(e),n.removeMediaCache(w.siq_unifiedMedia);e=" reject trigger from UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,e),a.handleCallRejected({type:t,chid:r})},l.prototype.__handleUIAccept=function(t){var i=this,e=this.container,n=e.commonImpl,a=e.mediaUIHandler,o=e.MediaPermission,s=e.constants,r=e.MediaDetails,c=e.detailsHandler,d=n.getWmsPushData(t),l=d.chatid,u=d.type,p=(d.mediaInvitation,n.getActiveCallData()),h=n.getMediaIdByChid(p),e=h?n.getCallStatusData(h):{},m=n.getCallStatusData(t);p&&p!=l&&(d=e.callStatus,e=e.host,c.isOldUI()&&c.isOldUI(),d==s.connected?this.endOngoingCall(p,h):d==s.ringing?(p={action:e==s.upstream?s.cancel:s.reject,success_cbk:null,failure_cbk:null,extraData:{}},n.setApiData(h,p),s.upstream,n.makeApiCall(h),n.removeActiveCallData()):d==s.connecting&&(e={action:e==s.upstream?s.cancel:s.reject,success_cbk:null,failure_cbk:null,extraData:{}},n.setApiData(h,e),s.upstream,n.makeApiCall(h),n.removeActiveCallData()));var _={perfect_renegotiation:r.getClientSupport().perfect_renegotiation,session_id:getSid()};n.getCallStatusData(t).mediarequest?u==w.screen_share_smart||u==w.screen_view_smart?(n.setActiveCallData(l),n.deleteScreenShareRequestData(l),this.__makeCallAccept(t),this.addScreenTrackInConference({type:u,isInvite:!0})):o.getScreenShareStream(function(){var e;n.getCallStatusData(t)&&n.isScreenRequestPending(l)?(n.deleteScreenShareRequestData(l),(e=n.getCallStatusData(t))?e.callStatus=s.connecting:e={callStatus:s.connecting},n.setCallStatusData(t,e),n.setActiveCallData(l),e={action:s.accept,success_cbk:function(){i.handleAcceptSuccessCbk(t)},failure_cbk:null,extraData:_},n.setApiData(t,e),n.makeApiCall(t),e={},c.isOldUI()&&(e.is_old_ui=c.isOldUI()),e={action:m.host==s.upstream?s.cancel:s.reject,success_cbk:null,failure_cbk:null,extraData:e},n.setApiData(t,e),a.updateCallInvitationState(u,{chid:l,media_id:t,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return m.host,s.upstream,n.makeApiCall(t)}},s.connecting),o.screenEndFromBrowserUI(function(){return i.handleUIEnd(t)}),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:t})):o.closeStreamByType(s.screen_share)},this.onMediaPermissionFailure(l,t)):(r={action:s.accept,success_cbk:null,failure_cbk:null,extraData:_},n.setApiData(t,r),n.makeApiCall(t)),n.removeIncomingRequestData({id:t,chatid:l}),n.setActiveTab()},l.prototype.handleUIAccept=function(e){var t=this,i=this.container,n=i.mediaUIHandler,a=i.commonImpl,o=i.detailsHandler,i=a.getWmsPushData(e).chatid,a=a.getActiveCallData();a&&a!=i?n.handleCallClash(function(){return t.__handleUIAccept(e)},function(){return t.handleUIReject(e)}):this.__handleUIAccept(e),o.triggerIconCheck(i)},l.prototype.startScreenShare=function(e){try{var t,i=this.container,n=i.detailsHandler,a=i.MediaPermission,o=i.commonImpl,s=i.MediaDetails,r=i.constants,c=e.mediarequest,d=e.chatid,l=e.mode,u=e.id,p=!0,h=c?w.screen_view:w.screen_share;if(e.perfect_renegotiation=s.getClientSupport().perfect_renegotiation,l==r.visitor){if(n.checkIsSSOnGoing(d,h))return;p=this.isScreenShareAllowed(e,h)}p?c?this.initRequest(this.onMediaPermissionSuccess(e)):a.getScreenShareStream(this.onMediaPermissionSuccess(e),this.onMediaPermissionFailure(d,u,!0)):(t="To start Siq Screen Share  - permission checks failed | chid - "+d+" ",this.callBackAction(this.implConstants.postDebugLog,t)),o.setActiveTab()}catch(e){}},l.prototype.initRequest=function(e){e()},l.prototype.onMediaPermissionSuccess=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.ajaxHandler,o=i.MediaPermission,s=i.constants,r=(e.mediarequest,e.chatid),i=e.mode,i=(e.id,e.type,i||s.visitor),c=this.constructResponeObj(e),d=n.constructURL(null,null);return n.setActiveCallData(r),function(){if(!t.checkOngoingCall(r))return o.closeStreamByType(s.screen_share),delete t.iconClicked[r],function(){};n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED}}),a.post(d,c,t.onstarted.bind(t),t.startCallFailure.bind(t),!0,!1,"v3")}},l.prototype.onMediaPermissionFailure=function(d,l,u){var p=this;return void 0===u&&(u=!1),function(e,t){try{var i,n=p.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.detailsHandler,r=n.constants,c={closed_reason:r.screen_permission_blocked};s.isOldUI()&&(c.is_old_ui=s.isOldUI()),u||(i={action:r.reject,success_cbk:null,failure_cbk:null,extraData:c},a.setApiData(l,i),a.makeApiCall(l),o.updateCallInvitationState(r.screen_share,{chid:d,media_id:l},r.rejected),p.clearData(l),s.triggerIconCheck(d)),a.getActiveCallData()&&a.getActiveCallData()==d&&!a.getCallStatusData(l)&&(a.removeActiveCallData(),a.removeActiveTab()),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED}})}catch(e){}}},l.prototype.constructResponeObj=function(e){return Object.assign({},{type:"screen_share"},e)},l.prototype.onstarted=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.mediaUIHandler,o=i.dataHandler,s=i.MediaPermission,r=i.detailsHandler,c=i.constants,d=R(e.msg||e.data.msg).media?R(R(e.msg||e.data.msg).media):R(e.msg||e.data.msg),l=d.chatid,u=d.id,p=d.type,h=d.mediaRequest,i=d.chid,m=d.connection_type,e=d.recordingType;l||(l=l||i,d.chatid=l),n.setWmsPushData(u,d);o.set(u+"_waiting_timer",setTimeout(function(){var e={};r.isOldUI()&&(e.is_old_ui=r.isOldUI());e={action:c.miss,success_cbk:null,failure_cbk:null,extraData:e};n.setApiData(u,e),n.makeApiCall(u),a.updateCallInvitationState(p,{chid:l,media_id:u},c.missed),t.clearData(u),n.removeMediaCache(w.siq_unifiedMedia),r.handleCallMissed({type:p,chid:l})},6e4));o={chid:l,type:p,media_id:u,status:w.outgoing};n.setMediaCache(w.siq_unifiedMedia,o);e={callType:c.outgoing,callStatus:c.ringing,mediarequest:h,host:c.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:p,connection_type:m,recording_type:e};n.setCallStatusData(u,e);e=function(){return t.handleUICancel(u)},e={chid:l,media_id:u,rejectCbk:e,cancelCbk:e,muteCbk:function(){},initiated:!0};p==c.screen_share||p==c.screen_share_smart?a.makeScreenShareConnecting(p,e):a.showScreenShareMaking(p,e),h||s.screenEndFromBrowserUI(function(){return m==w.connectionType.PEER2PEER?t.handleUIEnd(u):t.handleUiunifiedEnd(u)}),r.triggerIconCheck(l),r.handleCallInitiate({type:p,chid:l})},l.prototype.startCallFailure=function(){},l.prototype.addRemoteStream=function(e,t){var i=this;try{t.type;var n=t.mid,a=t.chid,o=t.negotiationType,s=this.container,r=s.constants,c=s.mediaUIHandler,d=s.dataHandler,l=(s.MediaPermission,e.stream);if(e.streams&&(l=e.streams[0]),o==r.audio)return;function u(){i.handleUIEnd(n)}if(d.get(r.isAlreadySharing)&&(d.set(r.isAlreadySharing,!1),setTimeout(function(){i.handleStopScreenShare(n)},2e3)),c.getUIState().states&&c.getUIState().states[a]&&c.getUIState().states[a].screen_share&&c.getUIState().states[a].screen_share.type==r.sharing)return;c.updateCallInvitationState(r.screen_share,{chid:a,media_id:n,id:n,callEndCbk:u},r.connected),c.playScreenShareStream({stream:l,chid:a,mid:n,endCbk:u})}catch(e){}},l.prototype.clearData=function(e){try{var t=this.container,i=t.commonImpl,n=t.dataHandler,a=t.constants,o=t.detailsHandler,s=(t.mediaUIHandler,i.getWmsPushData(e));if(!s)return;s.type;var r=s.chatid;this.closePeerConn(e),this.closeAllPeerConn(e),i.removeCredential(e),i.checkAVIcon(r),i.clearCallDetails(r,e),i.clearConnectingTimer(e),i.clearMissedCallTimeout(e),clearTimeout(this.timeout[e]),n.remove(a.isAlreadySharing),i.getActiveCallData()&&i.getActiveCallData()==r&&i.removeActiveCallData(),i.removeIncomingRequestData({id:e,chatid:r}),o.isEmbed()&&o.checkIsChatEndTimerAlive(r)||i.stopNotificationSound(),i.checkAndPlayNotification(),i.deleteScreenShareRequestData(r),i.clearConnectedStatsDetail(e),i.removeMediaCallDetails(e),i.removeMediaCache(w.siq_unifiedMedia),i.getCallStatusData(e)||i.removeActiveTab()}catch(e){}},l.prototype.closePeerConn=function(e){var t=this.container,i=t.commonImpl,n=t.dataHandler,a=i.getWmsPushData(e),t=a.chatid,a=a.type;try{var o=n.get(t+"_peer");if(!o)return void this.clearMediaPermision(a);var s=o[e];i.clearNetworkTimer(s),s.closeConnection(),delete o[e],this.clearMediaPermision(a)}catch(e){}},l.prototype.clearMediaPermision=function(e){"audio_unified_mix"==e?e="audio":"screen_share_smart"!=e&&"screen_view_smart"!=e||(e="screen_share"),this.container.MediaPermission.closeStreamByType(e)},l.prototype.handleUIEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl,o=t.constants,s=a.getWmsPushData(e),r=s.type,t=s.chatid,s=a.getPeerObject(e);s.curr_connection.audio&&s.audioRtpSenders||i.getUIState().states[t].audio?i.getUIState().states[t].screen_share.type==w.viewing?this.endViewingScreenShare(e):this.handleStopScreenShare(e):(s={action:o.end,success_cbk:null,failure_cbk:null,extraData:{}},a.setApiData(e,s),a.makeApiCall(e),i.updateCallInvitationState(r,{chid:t,media_id:e},o.ended),n.clearChatWindow(),n.clearPlayer()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),this.clearData(e),a.removeMediaCache(w.siq_unifiedMedia),n.handleCallEnded({type:r,chid:t}))},l.prototype.callConnected=function(e){this.screenShareConnectedUI(e)},l.prototype.screenShareConnectedUI=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.mediaUIHandler,o=i.constants,s=e.chid,r=(e.type,e.mid),c=e.isUpStream,i=e.isReconnecting,e=n.getCallStatusData(r).mediarequest,e={chid:s,isViewing:c&&e||!c&&!e,media_id:r,ss_type:a.getCurrentScreenshareType(s),muteCbk:function(){return function(){}},callEndCbk:function(){return t.handleUIEnd(r)}};n.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected);s=n.getCallStatusData(r);s?s.callStatus=o.connected:s={callStatus:o.connected},n.setCallStatusData(r,s),a.updateCallInvitationState(o.screen_share,e,o.connected),n.updateMediaStatsDetail({connectedTime:Date.now(),isreconnected:i,mediaid:r}),n.getConnectedStatsDetail(r),n.makeApiCall(r)},l.prototype.callBackAction=function(e,t){({postDebugLog:this.postDebugLog.bind(this)})[e](t)},l.prototype.init=function(){this.implConstants={postDebugLog:"postDebugLog"}},l.prototype.postDebugLog=function(e){this.container.detailsHandler.sendDebugLogger(e,null,null,!0)},l.prototype.handleUICancel=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=i.getWmsPushData(e),t=s.type,s=s.chatid;n.updateCallInvitationState(o.screen_share,{type:t,chid:s,media_id:e},o.cancelled);n={};a.isOldUI()&&(n.is_old_ui=a.isOldUI());n={action:o.cancel,success_cbk:null,failure_cbk:null,extraData:n};i.setApiData(e,n),i.makeApiCall(e),this.clearData(e),i.removeMediaCache(w.siq_unifiedMedia),a.handleCallCancelled({type:t,chid:s})},l.prototype.handleUIRequestCancel=function(e,t,i){var n=this.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.detailsHandler,r=n.constants,n=(n.dataHandler,{type:e,chid:t,media_id:i});a.getSwapRequestCallbackState()?this.handlingRequestStateOnSwap(t,i,r.requestCancelled):o.updateCallInvitationState(r.screen_share,n,r.cancelled);n={process_type:r.negotiation,negotiation_type:e};s.isOldUI()&&(n.is_old_ui=s.isOldUI());n={action:r.cancel,success_cbk:null,failure_cbk:null,extraData:n};a.setApiData(i,n),a.makeApiCall(i),a.clearConnectingTimer(i),a.clearMissedCallTimeout(i),s.handleCallCancelled({type:e,chid:t})},l.prototype.handlingRequestStateOnSwap=function(e,t,i){var n=this.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.constants,n={chid:e,id:t};o.updateCallInvitationState(s.screen_share,{chid:e,status:i,media_id:t},i),this.setSharingState(n),a.deleteSwapRequestCallbackState()},l.prototype.swapScreenShare=function(e,t){var i=this,n=this.container,a=n.audioImpl,o=n.MediaPermission,s=n.constants,r=n.mediaUIHandler,n=n.commonImpl,c=e.id,d=e.chatid||e.chid;n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SWAP},mid:c}),o.getStreamByType(s.screen_share)?((r=r.getUIState().states[d])&&r.screen_share&&r.screen_share.type==s.sharing&&(n.setSwapRequestCallbackState(),r.screen_share.type=s.viewing,r.screen_share.status=s.requested,r.screen_share.reject_cbk=function(){return i.handleUIRequestCancel(s.screen_share,d,c)}),a.initCallRequest({chid:d,mid:c,negotiationType:s.screen_share})):a.addScreenShareTrack({id:c,chid:d})},l.prototype.getScreenShareType=function(e,t){try{var i=this.container,n=i.commonImpl,a=i.constants,o=n.getCallStatusData(t),s=n.getPeerObject(t);if(!o)return-1;if(s&&s.curr_connection&&s.curr_connection.audio)return-1;var r=o.mediarequest,c=o.host==a.upstream;if(c&&r)return 1;if(c&&!r)return 0;if(!c&&r)return 0;if(!c&&!r)return 1}catch(e){}},l.prototype.endOngoingCall=function(e,t,i){var n=this.container,a=n.dataHandler,o=n.mediaUIHandler,s=n.commonImpl,r=n.audioImpl,c=n.constants,d=a.get(e+"_peer");if(r.handleAudioCallEnd(t),d)for(var l in d){var u=d[l],p=u.mid,u=u.type;o.updateCallInvitationState(u,{chid:e,media_id:p},c.ended);u={action:c.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(p,u),s.makeApiCall(p),this.clearData(l),delete d[l]}else{r={action:c.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(t,r),s.makeApiCall(t),this.clearData(t)}s.stopNotificationSound(),s.removeActiveCallData(e)},l.prototype.endFailedCall=function(e){try{var t=this.container,i=t.dataHandler,n=t.mediaUIHandler,a=t.commonImpl,o=t.constants,s=(t.detailsHandler,a.getWmsPushData(e)),r=s.chatid,c=s.type,d=i.get(r+"_peer");a.updateFailedTimeForMediaStats({failedTime:Date.now(),isreconnected:!1,mediaid:e}),a.getFailedStatsDetail(e),a.makeApiCall(e),n.updateCallInvitationState(c,{chid:r,media_id:e},o.failed),this.clearData(e),delete d[e]}catch(e){}},l.prototype.isScreenShareSupported=function(){},l.prototype.handleCallRequest=function(t){var i=this,e=this.container,n=e.mediaUIHandler,a=e.constants,o=e.MediaPermission,s=e.commonImpl,r=e.dataHandler,c=e.detailsHandler,d=s.getWmsPushData(t),l=d.chatid,e=(d.type,d.processType);d.negotiationType;if(e&&e==a.reinit)return o.getStreamByType(a.screen_share)&&r.set(a.isAlreadySharing,!0),void s.getPeerObject(t).screenShareRenegotiation();a={chid:l,media_id:t,acceptCbk:function(){s.isSmartFlow(t)&&c.isScreenRecordingEnabled()&&c.isScreenRecordAllowed()&&!i.isConsentBannerAccepted()&&i.setConsentBannerAccepted(),i.container.MediaPermission.getScreenShareStream(function(){i.handleUiRequestAccept(t),i.setSharingState({id:t,chid:l});var e=n.getUIState().states[l];e&&e.screen_share&&e.screen_share.stream&&delete e.screen_share.stream,o.screenEndFromBrowserUI(function(){return i.handleUIEnd(t)}),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:t})},function(){i.handleUiRequestReject(t),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED},mid:t})})},rejectCbk:function(){i.handleUiRequestReject(t)}};n.showScreenShareInvitation(a)},l.prototype.setSharingState=function(e){var t=this,i=e.chid,n=e.id,a=this.container,o=a.constants,e=a.mediaUIHandler,a=(a.screenShareImpl,a.commonImpl.getWmsPushData(n)),s=a.negotiationType,r=a.type,i=e.getUIState().states[i];i.screen_share=i.screen_share||{},i.screen_share.type=o.sharing,i.screen_share.status=o.connected;i.screen_share.reject_cbk=function(){s==w.screen_share_smart||r==w.screen_share_smart?t.handleUiunifiedEnd(n):t.handleUIEnd(n)}},l.prototype.handleUiRequestAccept=function(e){var t=this.container,i=t.commonImpl,n=t.constants,a=i.getWmsPushData(e).negotiationType,t={process_type:n.negotiation,negotiation_type:a},t={action:n.accept,success_cbk:a==w.screen_share_smart?this.handleUiSmartRequestAcceptSuccessCBK(e):this.handleUiRequestAcceptSuccessCbk(e),failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.handleUiRequestAcceptSuccessCbk=function(e){var t=this.container,i=t.dataHandler,n=t.commonImpl,t=n.getWmsPushData(e).chatid;i.get(t+"_peer")[e].addScreenTrackInConnection()||this.handleInitReNegotiation(e),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED}})},l.prototype.handleUiRequestReject=function(e){var t=this.container,i=t.commonImpl,n=t.constants,t=i.getWmsPushData(e).negotiationType,t={process_type:n.negotiation,negotiation_type:t},t={action:n.reject,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.handleStopScreenShare=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,t=(t.constants,i.getWmsPushData(e).chatid);i.getPeerObject(e).removeScreenTrackInConnection()||(this.removeTrackOnReNegotiation=!0,this.handleInitReNegotiation(e)),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKREMOVED},mid:e}),n.deleteScreenShareState(t),n.deletePlayer(t),a.clearChatWindow(),a.clearPlayer()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e})},l.prototype.handleCallMissed=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl,o=t.constants,s=a.getWmsPushData(e),r=s.type,c=s.processType,t=s.chatid,s=i.getUIState().states[t];s&&s.screen_share&&s.screen_share.type!=o.viewing&&uiHandler.deleteScreenShareState(t),n.isEmbed()&&n.clearConformBox()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()}}),a.deleteScreenShareRequestData(t),c&&c==o.negotiation||(i.clearAllStates(t),this.clearData(e),a.removeMediaCache(w.siq_unifiedMedia),n.handleCallMissed({type:r,chid:t}))},l.prototype.handleAudioCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.MediaPermission,a=t.detailsHandler,o=t.commonImpl,t=t.constants;n.closeStreamByType(t.screen_share),a.isEmbed()&&a.clearConformBox()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()}}),i.deleteScreenShareState(e),i.deletePlayer(e),a.clearChatWindow(),a.clearPlayer()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()}}),a.clearPopup()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:a.getMediaActivityAddInfo()}})},l.prototype.checkOngoingCall=function(e){for(var t=this.container,i=t.dataHandler,n=t.detailsHandler,t=t.constants,a=i.get(t.media_inv),o=0;a&&a.length>o;o++)if(a[o][e=n.isembed?n.getChatWinObjById(e,!0).RCHID:e])return!1;return!0},l.prototype.handleInitReNegotiation=function(e){var t=this.container,i=t.commonImpl,n=t.constants;this.reinit=!0;t={process_type:n.reinit,negotiation_type:n.screen_share},t={action:n.request,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.endViewingScreenShare=function(e){var t=this.container,i=t.commonImpl,n=t.constants,t={process_type:n.negotiation,negotiation_type:n.screen_share},t={action:n.end,success_cbk:null,failure_cbk:null,extraData:t};i.setApiData(e,t),i.makeApiCall(e)},l.prototype.showConsentUI=function(e,t){var i=this;void 0===t&&(t=!1);var n=this.container,a=n.mediaUIHandler,o=n.commonImpl.getWmsPushData(e).chatid;t&&(a.getUIState().states[o].screen_share.type=w.sharing,a.getUIState().states[o].screen_share.status=w.connecting);n={acceptCbk:function(){t&&(a.getUIState().states[o].screen_share.type=w.viewing,a.getUIState().states[o].screen_share.status=w.connected),i.hideConsentUI(e),i.setConsentBannerAccepted(),i.addScreenTrackInConference()},rejectCbk:function(){t?(a.getUIState().states[o].screen_share.type=w.viewing,a.getUIState().states[o].screen_share.status=w.connected,i.hideConsentUI(e)):i.handleUIConsentReject(e)},chid:o};a.updateCallInvitationState(w.screen_share,n,w.showConstent)},l.prototype.handleUIConsentReject=function(e){this.hideConsentUI(e),this.handleUiunifiedEnd(e)},l.prototype.hideConsentUI=function(e){var t=this.container,i=t.mediaUIHandler,t=t.commonImpl.getWmsPushData(e),e=t.chatid,t=t.chid;i.clearConsentUIState(e||t)},l.prototype.isConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();return!!e.getValueInSession(t)},l.prototype.setConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();e.setValueInSession(t,!0)},l.prototype.getConsentCookieKey=function(){var e=this.container.detailsHandler,t=e.getAppName(),i=e.getApiVisitorId(),e=e.getAVUID();return i?i+"_"+t+"_screen_consent":e+"_"+t+"_screen_consent"};var u=function(e){((this.container=e).commonImpl=this).reloadCheck=!1};u.prototype.setCredential=function(e){var t=this.getWmsPushData(e),i=t.id,n=t.type,e=t.credentials,t=t.chatid;this.container.dataHandler.set(i+"_credential",{mid:i,credential:e,chid:t,type:n}),this.container.dataHandler.set(i+"_nextTurnServer",w.TURN_URL[0])},u.prototype.removeCredential=function(e){this.container.dataHandler.remove(e+"_credential"),this.container.dataHandler.remove(e+"_nextTurnServer")},u.prototype.constructURL=function(e,t){var i="media",n=this.getVersion(t);return"v2"==n&&e?i+="/"+t+"/"+e:"v3"==n&&(i=t?i+"/"+t:i),i},u.prototype.setActiveCallData=function(e){this.container.dataHandler.set("active_call",e,!0)},u.prototype.getActiveCallData=function(){return this.container.dataHandler.get("active_call",!0)},u.prototype.removeActiveCallData=function(){this.container.dataHandler.remove("active_call",!0)},u.prototype.getAcitveMediaTypes=function(){var e=this.container.dataHandler.get("active_call",!0),e=this.getCallStatusData(this.getMediaIdByChid(e));return v(e)?e.type:[]},u.prototype.checkAVIcon=function(e){var t=this.container,i=t.dataHandler,t=t.mediaUIHandler;i.get("active_call",!0)==e&&t.enableOutingCallUI()},u.prototype.callFailed=function(e,t){var i=this.container.dataHandler.get(e+"_peer")[t].type;this.setWmsPushData(t,{type:i,chatid:e,id:t}),this.container[i+"Impl"].endFailedCall(t)},u.prototype.checkNetwork=function(t,i,e){var n=this;void 0===e&&(e=!1);var a=this.container,o=a.dataHandler,a=a.mediaUIHandler,s=o.get(t+"_peer")[i],r=s.type,c="undefined"==typeof _MEDIASERVERURL?_MEDIASTATICURL:_MEDIASERVERURL;s.reconnectInterval=setTimeout(function(){var e=document.createElement("IMG");e.src=c+"/salesiq/images/spacer_592ebefc7104d681d57852665e9ad514_.gif?nocache="+(new Date).getTime(),e.onload=function(){s.iceRestart=!0,s.isUpStream&&s.createOffer(),n.updateAcceptedTimeForMediaStats(Date.now(),i)},e.onerror=function(){return n.checkNetwork(t,i,!0)}},5e3),s.reconnectEndTimer||(s.reconnectEndTimer=setTimeout(function(){n.container[r+"Impl"].endOngoingCall(t,i),clearTimeout(s.reconnectInterval),s.reconnectEndTimer=null},3e4)),e||a.updateCallInvitationState(r,{chid:t,media_id:i},"reconnecting")},u.prototype.clearNetworkTimer=function(e){clearTimeout(e.reconnectEndTimer),clearTimeout(e.reconnectInterval)},u.prototype.clearCallDetails=function(e,t){this.container.dataHandler.remove(t+"_credential")},u.prototype.updateCommonData=function(){},u.prototype.getCommonData=function(){},u.prototype.makeApiCall=function(e){var t=this.getApiData(e),i=t.action,n=t.success_cbk,a=(t.failure_cbk,t.extraData),o=Object.assign({},a),s=this.container,t=(s.detailsHandler,s.ajaxHandler),a=s.constants,s=this.constructURL(i,e);"v3"==this.getVersion(e)&&-1!=[a.cancel,a.restart,a.miss,a.reject,a.request,a.end,a.accept,a.invite,a.offer,a.answer,a.candidates,a.connected].indexOf(i)?(o.action=i,t.put(s,o,n,null,!0,"v3")):t.post(s,o,n)},u.prototype.updateIncomingRequestData=function(e){var t=this.container,i=t.dataHandler,n=t.constants,a={},o=this.getWmsPushData(e),s=o.chatid,r=o.type,t=o.negotiationType,o=i.get(n.media_inv)||[];a[s]={id:e,type:t||r},o.push(a),i.set(n.media_inv,o,!0)},u.prototype.removeIncomingRequestData=function(e){var t,i=e.id,n=e.chatid,a=this.container,e=a.dataHandler,a=a.constants,o=e.get(a.media_inv,!0);for(t in o){var s=o[t],r=Object.keys(s)[0],s=s[r].id;r==n&&s==i&&o.splice(t,1)}o&&(0==o.length?this.deleteIncomingRequestKey():e.set(a.media_inv,o,!0))},u.prototype.getIncomingRequest=function(){var e=this.container,t=e.dataHandler,e=e.constants;return t.get(e.media_inv,!0)},u.prototype.deleteIncomingRequestKey=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.remove(e.media_inv,!0)},u.prototype.getMediaDataByChidAndType=function(e){var t=e.chatid,e=e.type,t=this.getMediaIdByChid(t),t=t?this.getCallStatusData(t):{};return v(t)&&t.type==e?t:null},u.prototype.endCallByChid=function(e,t){try{var i,n,a,o,s,r,c,d,l,u=this.container,p=u.detailsHandler,h=u.mediaUIHandler,m=u.dataHandler,_=u.constants,f=this.getMediaIdByChid(e),g=f?this.getCallStatusData(f):{};v(g)&&(i=g.type,n=g.callStatus,a=g.isdirectcall,o=g.callType,s=this.container[i+"Impl"],r={type:i,chid:e,media_id:f},c={},p.isOldUI()&&(c.is_old_ui=p.isOldUI()),n==_.connected?(i==_.audio_unified_mix?this.endOngoingUnifiedCall(f,e,t):s.endOngoingCall(e,f,t||function(){return a&&p.endSession(e)}),h.updateCallInvitationState(i,r,_.ended)):n!=_.connected&&o==_.incoming?(this.clearConnectingTimer(f),d={action:_.reject,success_cbk:t,failure_cbk:null,extraData:c},this.setApiData(f,d),a||this.makeApiCall(f),h.updateCallInvitationState(i,r,_.rejected),a&&s.handleUIApiReject(f)):n!=_.connected&&o==_.outgoing&&(clearTimeout(m.get(f+"_waiting_timer")),l={action:_.cancel,success_cbk:t,failure_cbk:null,extraData:c},this.setApiData(f,l),this.makeApiCall(f),h.updateCallInvitationState(i,r,_.cancelled)),s.clearData(f))}catch(e){}},u.prototype.checkOnGoingCall=function(){try{this.checkAndClearDataOnRefresh()}catch(e){}},u.prototype.checkAndClearDataOnRefresh=function(){var t=this;Object.keys(localStorage).forEach(function(e){return e.match(/SiqMedia_/g)&&t.container.dataHandler.remove(e.replace("SiqMedia_",""),!0)})},u.prototype.setActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.set(e.media_active,!0)},u.prototype.getActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;return t.get(e.media_active)||!1},u.prototype.removeActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.remove(e.media_active)},u.prototype.currentUserBrowserSupportSS=function(){var e=this.container.MediaDetails,t=e.getPlatform();return!!/linux|Microsoft Windows|Mac OS|MacIntel|Win32|Win64/i.test(t)&&e.checkBrowserSupported(w.screen_share)},u.prototype.checkIncomingCallAllowed=function(e){var t=this.container,i=t.constants,n=t.dataHandler,t=this.getWmsPushData(e),a=t.chatid,e=t.type,t=t.negotiationType;if(this.getMediaDataByChidAndType({chatid:a,type:t||e}))for(var o=n.get(a+"_peer"),s=o&&Object.keys(o).length||0,r=0;r<s;r++)return o[Object.keys(o)[r]].connectionStatus!=i.connected?(this.endCallByChid(a),!1):!0;return!1},u.prototype.setMediaStatsDetail=function(e){var t=e.acceptedTime,i=e.type,n=e.mediaid,a=e.reconnectCount,e=e.callerType;this.container.dataHandler.set(n+"_connectionstats",{acceptedTime:t,type:i,mediaid:n,reconnectCount:a,callerType:e})},u.prototype.updateMediaStatsDetail=function(e){var t=e.connectedTime,i=e.isreconnected,n=e.mediaid,a=this.container.dataHandler,e=a.get(n+"_connectionstats");e.connectedTime=t,e.reconnectCount=i?e.reconnectCount+1:e.reconnectCount,a.set(n+"_connectionstats",e)},u.prototype.updateAcceptedTimeForMediaStats=function(e,t){var i=this.container.dataHandler,n=i.get(t+"_connectionstats");n&&(n.acceptedTime=e,i.set(t+"_connectionstats",n))},u.prototype.updateFailedTimeForMediaStats=function(e){var t=e.failedTime,i=e.isreconnected,n=e.mediaid,a=this.container.dataHandler,e=a.get(n+"_connectionstats");e.failedTime=t,e.reconnectCount=i?e.reconnectCount+1:e.reconnectCount,a.set(n+"_connectionstats",e)},u.prototype.getConnectedStatsDetail=function(e){var t=this.container,i=t.dataHandler,t=(t.detailsHandler,t.constants),i=i.get(e+"_connectionstats"),i={latency:i.connectedTime-i.acceptedTime,reconcount:i.reconnectCount,callerType:i.callerType},i={action:t.connected,success_cbk:null,failure_cbk:null,extraData:i};this.setApiData(e,i)},u.prototype.getFailedStatsDetail=function(e){var t=this.container,i=t.dataHandler,t=(t.detailsHandler,t.constants),i=i.get(e+"_connectionstats"),i={latency:i.failedTime-i.acceptedTime,reconcount:i.reconnectCount,callerType:i.callerType},i={action:t.failed,success_cbk:null,failure_cbk:null,extraData:i};this.setApiData(e,i)},u.prototype.clearConnectedStatsDetail=function(e){this.container.dataHandler.remove(e+"_connectionstats")},u.prototype.getPeerObject=function(e){var t=this.container.dataHandler,i=this.getWmsPushData(e).chatid;try{return t.get(i+"_peer")[e]||null}catch(e){return null}},u.prototype.handleScreenTrackEnd=function(){var e=this.container,t=e.detailsHandler,i=e.mediaUIHandler,n=e.MediaPermission,a=e.screenShareImpl,o=e.constants,e=this.getActiveCallData(),s=this.getActiveMediaID(e);i.deleteScreenShareState(e),i.deletePlayer(e),t.clearChatWindow(),t.clearPlayer()&&this.sendMediaActivity({param:{action_type:o.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:t.getMediaActivityAddInfo()},mid:s}),n.getStreamByType(o.screen_share)&&i.updateCallInvitationState(o.screen_share,{chid:e,id:s,callEndCbk:function(){a.handleUIEnd(s)},ss_type:o.sharing},o.connected)},u.prototype.getActiveMediaID=function(e){e=this.getMediaIdByChid(e);return e||""},u.prototype.setScreenShareRequestData=function(e){this.container.dataHandler.set(e+"_screenRequest",!0)},u.prototype.deleteScreenShareRequestData=function(e){this.container.dataHandler.remove(e+"_screenRequest")},u.prototype.isScreenRequestPending=function(e){return!!this.container.dataHandler.get(e+"_screenRequest")},u.prototype.setCallUIPosition=function(e,t){this.container.dataHandler.set("callUIposition",{top:e,left:t})},u.prototype.getCallUIPosition=function(){return this.container.dataHandler.get("callUIposition")},u.prototype.removeCallUIPosition=function(){this.container.dataHandler.remove("callUIposition")},u.prototype.clearMissedCallTimeout=function(e){var t=this.container.dataHandler;clearTimeout(t.get(e+"_waiting_timer")),t.remove(e+"_waiting_timer")},u.prototype.setSwapRequestCallbackState=function(){this.container.dataHandler.set("isScreenShareOngoing",!0)},u.prototype.getSwapRequestCallbackState=function(){return this.container.dataHandler.get("isScreenShareOngoing")},u.prototype.deleteSwapRequestCallbackState=function(){this.container.dataHandler.remove("isScreenShareOngoing")},u.prototype.clearConnectingTimer=function(e){var t=this.container.dataHandler;clearTimeout(t.get(e+"_connecting_timer")),t.remove(e+"_connecting_timer")},u.prototype.onGoingMediaType=function(e){var t={audio:!1,screenshare:!1},e=this.container.mediaUIHandler.getUIState().states[e];return e&&e.audio?t.audio=!0:t.audio,e&&e.screen_share?t.screenshare=!0:t.screenshare,t},u.prototype.setRemotePerfectReNegotiation=function(e,t,i){t=this.getCallStatusData(t);t&&null!=t.isPerfectRenegotiation&&(e.remotePerfectRenegotiation=t.isPerfectRenegotiation)},u.prototype.endCallFromSameChat=function(e){var t,i=this.container.constants,n=this.getWmsPushData(e).chatid,a=this.getCallStatusData(e);a&&a.id!=e&&(e=(t=a[mid]).type+"Impl",(t=t.callStatus)==i.connected?this.container[e].endOngoingCall(n,mid):t!=i.ringing&&t!=i.connecting||(a.host==i.upstream?this.container[e].handleUICancel(mid):this.container[e].handleUIReject(mid),this.removeActiveCallData()))},u.prototype.sendMediaActivity=function(e){var t=e.param,i=e.mid,n=this.container,a=n.ajaxHandler,e=n.detailsHandler,n=this.getActiveCallData(),n=this.getActiveMediaID(n)||i,i="stats/"+n+"/media/activity";e.isEmbed()&&(t.vwmsid=e.getVisitorWMSID()),n&&a.post(i,t,function(){},function(){},!0,!1,"v2")},u.prototype.checkCallHostType=function(e){e.chid;var t=e.mid,e=e.hostType,t=this.getCallStatusData(t);return!(!t||t.host!=e)},u.prototype.isInvitationPending=function(){var e=this.getIncomingRequest();return!!(e&&0<e.length)},u.prototype.sendRTCNetworkStats=function(e,t){var i=this.container,n=i.ajaxHandler,a=i.detailsHandler,i="stats/"+e+"/media/nrs",e={};a.isEmbed()&&(e.vwmsid=a.getVisitorWMSID()),e.networkstats=t,n.post(i,e,function(){},function(){},!0,!1)},u.prototype.sendRTCConnectionStats=function(e,t){var i=this.container,n=i.ajaxHandler,a=i.detailsHandler,i="stats/"+e+"/media/nrs",e={};a.isEmbed()&&(e.vwmsid=a.getVisitorWMSID()),e.stats=t,n.post(i,e,function(){},function(){},!0,!1)},u.prototype.pushVoiceMessage=function(e){var t=this.container,i=t.ajaxHandler,t=t.detailsHandler,t={action:w.voicemessage,wmsid:t.getVisitorWMSID()},e=this.constructURL(w.voicemessage,e);i.put(e,t,function(){},function(){},!0,"v3")},u.prototype.setMediaCallDetails=function(e){var t=this.container,i=t.constants,t=t.dataHandler;e&&t.set(i.mediaCallDetails,e)},u.prototype.updateMediaCallDetails=function(e,t,i){var n=this.getMediaCallDetails();n&&0<Object.keys(n).length?n[e]||(n[e]={}):(n={})[e]={},n[e][t]=i,this.setMediaCallDetails(n)},u.prototype.updateChidMapList=function(e,t){var i=this.getChidMapList();i&&0<Object.keys(i).length?i[t.chid]=e:(i={})[t.chid]=e,this.setChidMapList(i)},u.prototype.setWmsPushData=function(e,t){this.updateMediaCallDetails(e,w.mediaDetailsKeys.wmsPushData,t),this.updateChidMapList(e,t)},u.prototype.setApiData=function(e,t){this.updateMediaCallDetails(e,w.mediaDetailsKeys.apiData,t)},u.prototype.setCallStatusData=function(e,t){this.updateMediaCallDetails(e,w.mediaDetailsKeys.callStatus,t)},u.prototype.setChidMapList=function(e){var t=this.container,i=t.constants,t=t.dataHandler;e&&t.set(i.chidMapList,e)},u.prototype.getMediaCallDetails=function(){var e=this.container,t=e.constants;return e.dataHandler.get(t.mediaCallDetails)},u.prototype.getWmsPushData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].wmsPushData},u.prototype.getApiData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].apiData},u.prototype.getCallStatusData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].callStatus},u.prototype.getChidMapList=function(){var e=this.container,t=e.constants;return e.dataHandler.get(t.chidMapList)},u.prototype.getMediaIdByChid=function(e){var t=this.getChidMapList();return v(t)&&t[e]},u.prototype.removeMediaCallDetails=function(e){var t=this.container,i=t.constants,n=t.dataHandler,t=this.getMediaCallDetails();t&&1<Object.keys(t).length&&t[e]?(delete t[e],this.setMediaCallDetails(t)):n.remove(i.mediaCallDetails)},u.prototype.removeChidMapList=function(e){var t=this.container,i=t.constants,n=t.dataHandler,t=this.getChidMapList();t&&1<Object.keys(t).length?(delete t[e],this.setChidMapList(t)):n.remove(i.chidMapList)},u.prototype.setIsCallInitiatedFromOldUI=function(e,t){this.updateMediaCallDetails(t,w.mediaDetailsKeys.isCallInitiatedFromOldUI,e)},u.prototype.getIsCallInitiatedFromOldUI=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].isCallInitiatedFromOldUI},u.prototype.setIsMobileOperator=function(e,t){this.updateMediaCallDetails(t,w.mediaDetailsKeys.isMobileOperator,e)},u.prototype.getIsMobileOperator=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].isMobileOperator},u.prototype.stopNotificationSound=function(){this.container.detailsHandler.stopNotifSound()},u.prototype.playMediaNotificationSound=function(e){this.container.detailsHandler.playNotifSound(e)},u.prototype.getVersion=function(e){return"v3"},u.prototype.getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},u.prototype.setMediaCache=function(e,t){sessionStorage.setItem(e,D(t))},u.prototype.getMediaCache=function(e){e=sessionStorage.getItem(e);return e=e&&JSON.parse(e)},u.prototype.updateMediaCache=function(e,t,i){var n=this.getMediaCache(e);n&&(n[t]=i,sessionStorage.setItem(e,JSON.stringify(n)))},u.prototype.removeMediaCache=function(e){sessionStorage.removeItem(e)},u.prototype.handleMediaOnRefresh=function(e){var t=e.media_id,i=e.status,n=this.container.detailsHandler,e={};n.isOldUI()&&(e.is_old_ui=n.isOldUI());e={success_cbk:function(){},failure_cbk:function(){},extraData:e};i==w.connected?e.action=w.end:i==w.accept||i==w.outgoing?e.action=w.cancel:i==w.incoming&&(e.action=w.reject),this.setApiData(t,e),this.makeApiCall(t)},u.prototype.getImplType=function(e){return e?-1!=e.indexOf("audio")?"audio":-1!=e.indexOf("screen_share")?"screen_share":"":""};var e=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setUnifiedCredential=function(e){this.container.commonImpl.setCredential(e)},t.prototype.__initUnifiedConnection=function(e){var t=this.container.commonImpl,i=new r(e,this.container);return t.setUnifiedPeerObj({peerObj:i,data:e}),i},t.prototype.handleUnifiedCallCredentail=function(e){var t=this.container,i=t.commonImpl,t=t.detailsHandler,i=i.getWmsPushData(e);t.isEmbed()&&t.isScreenRecordingEnabled()?this.__handleunifiedcallcredentail(e):(this.setUnifiedCredential(e),i.isUpStream=!0,this.__initUnifiedConnection(i),i.audio_offer&&this.handleUnifiedCallOffer(e),this.__createDataChannelCon(e))},t.prototype.__handleunifiedcallcredentail=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.dataHandler,i=i.constants,n=n.getWmsPushData(e);this.isConsentBannerAccepted()?(clearTimeout(a.get(e+"_consent_connecting_timer")),this.__handleUnifiedCallAccept(e),this.setUnifiedCredential(e),n.isUpStream=!0,this.__initUnifiedConnection(n),n.audio_offer&&this.handleUnifiedCallOffer(e),this.__createDataChannelCon(e)):(this.showConsentUI(e,!1),a.set(e+"_consent_connecting_timer",setTimeout(function(){t.handleUICancel(e)},i.WAITING_TIME_30)))},t.prototype.__createDataChannelCon=function(e){e=this.container.commonImpl.getWmsPushData(e);e.type=w.data_channel,e.isDataChannel=!0,e.isUpStream=!0,e.datatype=w.data_channel,this.__initUnifiedConnection(e)},t.prototype.handleUnifiedCallAnswer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=i.getWmsPushData(e),a=(n.chid,n.session),o=n.tracksId,s=n.negotiationType,r=(n.candidates,n.type),t=n.datatype,r=i.getUnifiedPeerObjByStreamType({id:e,type:t||r,streamType:w.upstream});r.remoteTracksId=o?R(o):null,r.negotiationType=s||null,r.setAnswerRemoteDesription(a),r.setIceCandidatesArray(n),r.sendCandidates()},t.prototype.handleUnifiedCallOffer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=i.getWmsPushData(e),a=(n.chid,n.session),o=n.tracksId,s=n.negotiationType,r=(n.candidates,n.type),c=n.credentials,d=n.datatype,t=n.audio_offer;c&&this.setUnifiedCredential(e),t&&(a=n.audio_offer,n.candidates=n.audio_candidate,n.type=w.audio_smart);r=i.getUnifiedPeerObjByStreamType({id:e,type:d||r,streamType:w.downstream});r||(n.isUpStream=!1,r=this.__initUnifiedConnection(n),this.__initUpStreamUnifiedConnection(n)),r.remoteTracksId=o?R(o):null,r.negotiationType=s||null,r.setOfferRemoteDescription(a),r.setIceCandidatesArray(n),i.setUserTrackDetails(n)},t.prototype.__initUpStreamUnifiedConnection=function(e){var t=this.container.commonImpl,i=(e.chid,e.id),n=e.type;t.getUnifiedPeerObjByStreamType({id:i,type:n,streamType:w.upstream})||(e.isUpStream=!0,this.__initUnifiedConnection(e),this.__createDataChannelCon(i))},t.prototype.addAudioCallInConnection=function(){var i=this;this.container.MediaPermission.getAudioStream(function(){var e=i.container.commonImpl,t=e.getActiveCallData(),e=e.getActiveMediaID(t);i.__initUnifiedConnection({id:e,chid:t,isUpStream:!0,type:w.audio_smart,mediaRequest:!0})},function(){})},t.prototype.handleUnifiedInvitation=function(e){var t=this.container,i=t.commonImpl,n=t.MediaPermission,a=i.getWmsPushData(e),t=(a.chatid,a.chid);a.mode,a.type,a.mediaRequest,a.isOldUI,a.perfectReNegotiation;n.getAudioStream(null,null);n={action:"accept"};n.session_id=getSid(),this.container.commonImpl.makeUnifiedCallAccept({dataval:n,id:e}),i.setActiveCallData(t),i.setActiveTab()},t.prototype.unifiedcallConnected=function(e){e.chid;var t=e.type,i=e.mid,n=(e.isReconnecting,e.isUpStream),a=this.container,o=a.commonImpl,s=a.constants,e=a.dataHandler,a=o.getCallStatusData(i);a.host==s.downstream&&(a?a.callStatus=w.connected:a={callStatus:w.connected},o.setCallStatusData(i,a),o.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected),this.__updatecallConnectedUi(i)),a.type==w.screen_share_smart&&t==w.audio_smart&&this.__updatecallConnectedUi(i),o.sendUnifiedConnected({mid:i,isUpStream:n,type:t}),clearTimeout(e.get(i+"_connecting_timer")),e.remove(i+"_connecting_timer")},t.prototype.sendUnifiedCandidates=function(e){this.container.commonImpl.sendUnifiedCandidates(e)},t.prototype.sendUnifiedOffer=function(e){this.container.commonImpl.sendUnifiedOffer(e)},t.prototype.sendUnifiedAnswer=function(e){this.container.commonImpl.sendUnifiedAnswer(e)},t.prototype.notifyUser=function(e){var t=e.mid,i=e.type,n=this.container.commonImpl,a=n.getCallStatusData(t),o=n.getTypeFromConnectionType(a.connection_type,a.type);a.host==w.upstream&&o==i&&(n.inviteUser({dataval:{action:w.invite,mediainvitation:!0},id:t}),e.isNotified=!0)},t.prototype.handleCallAnswerReceived=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=(i.getWmsPushData(e),i.getWmsPushData(e)),t=(n.chid,n.session,n.tracksId,n.negotiationType,n.candidates,n.type),n=n.datatype;i.getUnifiedPeerObjByStreamType({id:e,type:n||t,streamType:w.downstream}).sendCandidates()},t.prototype.handleUnifiedCallAccept=function(e){this.container.detailsHandler;this.__handleUnifiedCallAccept(e)},t.prototype.__handleUnifiedCallAccept=function(e){var t,i=this,n=this.container,a=n.dataHandler,o=n.constants,s=n.commonImpl,r=n.mediaUIHandler,c=n.detailsHandler,d=s.getWmsPushData(e),l=d.chatid,u=d.type,p=d.processType,n=d.negotiationType,d=d.connection_type;clearTimeout(a.get(e+"_waiting_timer")),a.remove(e+"_waiting_timer"),c.isEmbed()&&!c.isScreenRecordingEnabled()&&c.showEmbedBanner("av.info.recording.disclaimer",5e3,l),c.handleOutgoingAccept({type:u,chid:l}),p&&p==w.negotiation&&n==w.audio?this.addAudioCallInConnection():((t=s.getCallStatusData(e))?(t.callStatus=o.connecting,t.type=u,t.connection_type=d):t={callStatus:o.connecting,connection_type:d,type:u},s.setCallStatusData(e,t),l={chid:l,media_id:e,isDirectCall:t.isdirectcall,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return t.host==o.upstream?i.handleUICancel(e):i.handleUIReject(e)}},s.updateMediaCache(w.siq_directcall,w.status,w.accept),r.updateCallInvitationState(o.audio_unified_mix,l,o.connecting),s.stopNotificationSound())},t.prototype.handleUnifiedCallConnected=function(e){var t=this.container,i=t.dataHandler,n=t.commonImpl,t=n.getCallStatusData(e);t?t.callStatus=w.connected:t={callStatus:w.connected},n.setCallStatusData(e,t),n.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected),this.__updatecallConnectedUi(e),clearTimeout(i.get(e+"_waiting_timer")),clearTimeout(i.get(e+"_connecting_timer")),i.remove(e+"_waiting_timer")},t.prototype.__updatecallConnectedUi=function(e){var t=this,i=this.container,n=(i.dataHandler,i.commonImpl),a=i.mediaUIHandler,o=i.constants,s=n.getWmsPushData(e),i=(s.chatid,s.chid),n=(s.mode,s.type,s.mediaRequest,s.isOldUI,s.perfectReNegotiation,n.getCallStatusData(e).isdirectcall);a.updateCallInvitationState(o.audio,{chid:i,id:e,media_id:e,callEndCbk:n?function(){t.handleUIApiCallEnd(e)}:function(){t.closeAllPeerConn(e),t.handleUIEnd(e)},isDirectCall:n},o.connected)},t.prototype.closeAllPeerConn=function(t){var i=this;[w.screen_view_smart,w.screen_share_smart,w.audio_unified_mix,w.audio_smart,w.data_channel].forEach(function(e){i.container.commonImpl.closeUnifiedPeerConnByType({id:t,type:e})})},t.prototype.handleUnifiedCallEnd=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=t.mediaUIHandler,a=t.screen_shareImpl,o=t.detailsHandler,s=i.getWmsPushData(e),r=(s.chatid,s.chid),t=(s.mode,s.type,s.mediaRequest,s.isOldUI,s.perfectReNegotiation,i.getCallStatusData(e)),s={chid:r,media_id:e,isDirectCall:t.isdirectcall};n.updateCallInvitationState(w.audio,s,w.ended),t.isdirectcall&&i.removeMediaCache(w.siq_directcall),i.removeMediaCache(w.siq_unifiedMedia),a.handleUnifiedCallEnd(e),this.clearData(e),o.handleCallEnded({type:w.audio,chid:r})},t.prototype.updateMuteState=function(e){var t=e.id,i=e.state,n=this.container.commonImpl,e=n.getActiveCallData(),t=n.getActiveMediaID(e)||t;n.sendUnifiedState({id:t,dataval:{action:"state",audio:{mute:i}}})},t.prototype.addUnifiedRemoteStream=function(e,t){var i=this.container,n=i.detailsHandler,a=i.commonImpl,o=(i.mediaUIHandler,i.constants),s=t.chid,r=t.mid,i=t.type,t=t.negotiationType;try{var c,d="",l=e.stream;i!=this.audio&&t!=this.audio&&i!=o.audio_unified_mix&&i!=o.audio_smart||(d=this.addUnifiedAudioPlayer()),e.streams&&(l=e.streams[0]);try{d.srcObject=l,this.getAudioOutputDevice()&&!n.isOldUI()&&(c=this.getAudioOutputDevice(),this.changeAudioPlayer(c,s))}catch(e){d.src=window.URL.createObjectURL(l)}a.checkAndUpdateUIForApi()}catch(e){n="siqMedia: adding remote stream  | chid :"+s+" | mediaid : "+r+" | lsuid : "+n.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,n)}},t.prototype.addUnifiedAudioPlayer=function(){try{document.querySelector("#remoteaudio");var e=document.createElement("audio");return e.id="remoteaudio",e.className="siqmediaaudioplayer",e.autoplay=!0,document.querySelector("body").appendChild(e),e}catch(e){}},t.prototype.changeUnifiedAudioInputDevice=function(e,t,i){var n=this,a=this.container,o=a.MediaPermission,s=a.commonImpl,a=s.getCallStatusData(t).connection_type==w.connectionType.SMART?w.audio_smart:w.audio_unified_mix,r=s.getUnifiedPeerObjByStreamType({id:t,type:a,streamType:w.upstream});r&&r.removeAudioTrackInConnection(),o.updatePreferredDeviceByDeviceId(e,"audioInput"),o.getAudioStream(function(){r.audioRenegotiation(),i&&n.toggleMute(),n.setAudioIputDevice(e),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INPUT_DEVICE_CHANGED}})},function(){})},t.prototype.changeUnifiedAudioPlayer=function(e,t){var i=document.getElementsByClassName("siqmediaaudioplayer"),n=i.length;if(0<n){this.setAudioOutputDevice(e);for(var a=0;a<n;a++)void 0!==i[a].sinkId&&i[a].setSinkId(e);this.container.commonImpl.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED}})}},t}(e),l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.handleUnifiedCallCredentail=function(e){var t=this.container.commonImpl.getWmsPushData(e);this.setUnifiedCredential(e),t.isUpStream=!0,t.type==w.screen_share_smart?this.__initUnifiedConnection(t):this.notifyUser({mid:t.id,type:w.screen_view_smart}),t.audio_offer&&this.handleUnifiedCallOffer(e)},t.prototype.__makeCallAccept=function(e){var t={action:"accept"};t.session_id=getSid(),this.container.commonImpl.makeUnifiedCallAccept({dataval:t,id:e})},t.prototype.setUnifiedCredential=function(e){this.container.commonImpl.getWmsPushData(e);this.container.commonImpl.setCredential(e)},t.prototype.__initUnifiedConnection=function(e){var t=this.container.commonImpl,i=new r(e,this.container);return e.type==w.screen_view_smart&&(e.type=w.screen_share_smart),t.setUnifiedPeerObj({peerObj:i,data:e}),i},t.prototype.addScreenTrackInConference=function(e){var i=this,t=this.container,n=t.MediaPermission,a=t.mediaUIHandler,o=t.detailsHandler,t=this.container.commonImpl,e=(e=void 0===e?{}:e).isInvite,s=t.getActiveCallData(),r=t.getActiveMediaID(s);n.getScreenShareStream(function(){function e(){return i.handleUiunifiedEnd(r)}var t=a.getUIState().states[s];t&&t.screen_share?(i.__endUnifiedSreenShare(r),a.deletePlayer(s),o.clearPlayer(),o.clearConformBox()&&clearTimeout(i.timeout[r])):(t=null,t=o.isEmbed()?o.getVisitorWMSID():o.getCurrentUserId(),i.__initUnifiedConnection({id:r,chid:s,isUpStream:!0,type:w.screen_share_smart,mediaRequest:!1,creatorid:t}),a.makeScreenShareConnected(w.screen_share,{chid:s,media_id:r,callEndCbk:e,ss_type:w.sharing}),n.screenEndFromBrowserUI(e))},e?this.onMediaPermissionFailure(s,r):function(){})},t.prototype.sendUnifiedOffer=function(e){this.container.commonImpl.sendUnifiedOffer(e)},t.prototype.sendUnifiedAnswer=function(e){this.container.commonImpl.sendUnifiedAnswer(e)},t.prototype.sendUnifiedCandidates=function(e){this.container.commonImpl.sendUnifiedCandidates(e)},t.prototype.handleUnifiedCallOffer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=i.getWmsPushData(e),a=(n.chid,n.session),o=n.tracksId,s=n.negotiationType,r=(n.candidates,n.type),c=n.credentials,t=n.datatype;n.audio_offer&&(a=n.audio_offer,n.candidates=n.audio_candidate,n.type=w.audio_smart),c&&this.setUnifiedCredential(e);r=i.getUnifiedPeerObjByStreamType({id:e,type:t||r,streamType:w.downstream});r||(n.isUpStream=!1,r=this.__initUnifiedConnection(n)),r.remoteTracksId=o?R(o):null,r.negotiationType=s||null,r.setOfferRemoteDescription(a),r.setIceCandidatesArray(n),i.setUserTrackDetails(n)},t.prototype.handleUnifiedCallAnswer=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=i.getWmsPushData(e),a=(n.chid,n.session),o=n.tracksId,s=n.negotiationType,r=(n.candidates,n.type),t=n.datatype,r=i.getUnifiedPeerObjByStreamType({id:e,type:t||r,streamType:w.upstream});r.remoteTracksId=o?R(o):null,r.negotiationType=s||null,r.setAnswerRemoteDesription(a),r.setIceCandidatesArray(n),r.sendCandidates()},t.prototype.notifyUser=function(e){var t=e.mid,i=e.type,n=this.container.commonImpl,a=n.getCallStatusData(t),o=n.getTypeFromConnectionType(a.connection_type,a.type);a.host==w.upstream&&o==i&&(n.inviteUser({dataval:{action:w.invite,mediainvitation:i!=w.screen_share_smart,mediarequest:i!=w.screen_share_smart},id:t}),e.isNotified=!0)},t.prototype.unifiedcallConnected=function(e){e.chid;var t=e.type,i=e.mid,e=(e.isReconnecting,e.isUpStream);this.container.commonImpl.sendUnifiedConnected({mid:i,isUpStream:e,type:t})},t.prototype.handleUnifiedInvitation=function(e){var t=this.container,i=t.commonImpl,n=(t.MediaPermission,i.getWmsPushData(e)),t=(n.chatid,n.chid),n=(n.mode,n.type,n.mediaRequest,n.isOldUI,n.perfectReNegotiation,{});n.action=w.accept,n.session_id=getSid(),this.container.commonImpl.makeUnifiedCallAccept({dataval:n,id:e}),i.setActiveCallData(t),i.setActiveTab()},t.prototype.handleCallAnswerReceived=function(e){var t=this.container,i=(t.dataHandler,t.commonImpl),n=i.getWmsPushData(e),t=(n.chid,n.session,n.tracksId,n.negotiationType,n.candidates,n.type),n=n.datatype;i.getUnifiedPeerObjByStreamType({id:e,type:n||t,streamType:w.downstream}).sendCandidates()},t.prototype.handleUnifiedCallConnected=function(e){var t=this,i=this.container,n=i.audioImpl,a=i.commonImpl,o=i.mediaUIHandler,s=i.MediaPermission,r=a.getWmsPushData(e),c=r.chid,d=r.datatype,i=r.isupstream,r=a.getCallStatusData(e).isdirectcall;d==w.audio_unified_mix||d==w.audio_smart&&1==i?n.handleUnifiedCallConnected(e):d!=w.audio_unified_mix&&d!=w.audio_smart&&((d=a.getCallStatusData(e))?d.callStatus=w.connected:d={callStatus:w.connected},a.setCallStatusData(e,d),o.updateCallInvitationState(w.screen_share_smart,{chid:c,media_id:e,isDirectCall:r,callEndCbk:r?function(){t.handleUIApiCallEnd(e)}:function(){t.handleUiunifiedEnd(e)},ss_type:s.getStreamByType(w.screen_share)?w.sharing:w.viewing},w.connected))},t.prototype.swapUnifiedScreenShare=function(e){var t=e.chid||e.chatid,i=e.id,n=this.container,a=n.audioImpl,o=n.mediaUIHandler,s=n.uiHandler,r=n.commonImpl,e=n.detailsHandler,n=o.getUIState().states[t];n&&n.screen_share&&(n.screen_share.type==w.viewing?(e.clearChatWindow(),!e.isEmbed()||!e.isScreenRecordingEnabled()||!e.isScreenRecordAllowed()||this.isConsentBannerAccepted()?this.addScreenTrackInConference():this.showConsentUI(i,!0)):n.screen_share.type==w.sharing&&(r.setSwapRequestCallbackState(),s.showScreenShareMaking(w.screen_share,{chid:t,media_id:i,cancelCbk:function(){return o.handleUIRequestCancel(w.screen_share,t,i)},ss_type:w.viewing}),a.initCallRequest({chid:t,mid:i,negotiationType:w.screen_share_smart})))},t.prototype.__endUnifiedSreenShare=function(i){var e,t,n=this,a=this.container,o=a.commonImpl,s=a.detailsHandler,r=a.mediaUIHandler,c=a.MediaPermission,d=o.getWmsPushData(i),l=(d.type,d.chid),u=[w.upstream,w.downstream];for(t in u){var p=o.getUnifiedPeerObjByStreamType({id:i,type:w.screen_share_smart,streamType:u[t]});p&&(e=p.creatorid)}a={negotiation_type:w.screen_share_smart,process_type:w.negotiation,creator_id:e},d=o.getCallStatusData(i),d.isdirectcall;o.setWmsPushData(i,{id:i,chid:l,type:w.screen_share_smart}),this.closeUnifiedPeerConn(i),succescbk=function(){function e(){return n.handleUiunifiedEnd(i)}var t=null,t=s.isEmbed()?s.getVisitorWMSID():s.getCurrentUserId(),t={id:i,chid:l,isUpStream:!0,type:w.screen_share_smart,mediaRequest:!1,creatorid:t};setTimeout(function(){r.makeScreenShareConnected(w.screen_share,{chid:l,media_id:i,callEndCbk:e,ss_type:w.sharing})},500),c.screenEndFromBrowserUI(e),n.__initUnifiedConnection(t)};a={action:w.end,success_cbk:succescbk,failure_cbk:null,extraData:a};o.setApiData(i,a),o.makeApiCall(i)},t.prototype.handleUnifiedCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.MediaPermission,o=t.detailsHandler,s=i.getWmsPushData(e),r=s.chid,t=s.processType;s.negotiationType;n.deleteScreenShareState(r),n.deletePlayer(r),o.clearPlayer()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e}),o.clearChatWindow(),a.closeStreamByType(w.screen_share),t&&t==w.negotiation?this.closeUnifiedPeerConn(e):(this.closeAllPeerConn(e),n.updateCallInvitationState(w.audio,{chid:r,media_id:e},w.ended),this.clearData(e),o.handleCallEnded({type:w.screen_share,chid:r}),o.clearPopup()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e}),n.clearConformBox()&&n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:media_id}),n.stopTimer(r),n.clearAllStates(r),o.clearAudioUI())},t.prototype.closeUnifiedPeerConn=function(e){var t,i=this.container,n=(i.dataHandler,i.commonImpl),i=(i.mediaUIHandler,i.constants,i.MediaPermission,n.getWmsPushData(e)),a=(i.chatid,i.chid,i.mode,i.type),o=(i.mediaRequest,i.isOldUI,i.perfectReNegotiation,i.negotiationType),o=(i.processType,o&&o==w.screen_view_smart?w.screen_share_smart:o),s=[w.upstream,w.downstream];for(t in s){var r=n.getUnifiedPeerObjByStreamType({id:e,type:o||a,streamType:s[t]});r&&(r.closeConnection(),n.removeUnifiedPeerObjByStreamType({id:e,type:o||a,streamType:s[t]}))}},t.prototype.closeAllPeerConn=function(t){var i=this;[w.screen_view_smart,w.screen_share_smart,w.audio_unified_mix,w.audio_smart,w.data_channel].forEach(function(e){i.container.commonImpl.closeUnifiedPeerConnByType({id:t,type:e})})},t.prototype.handleUiSmartRequestAcceptSuccessCBK=function(e){var t=this.container.detailsHandler;this.__endUnifiedSreenShare(e),t.clearPlayer()},t.prototype.handleUiunifiedEnd=function(e){try{var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl.getWmsPushData(e).chid;i.getUIState().states[a].audio?i.getUIState().states[a].screen_share.type==w.viewing?(this.__makeUnifiedScreenEnd(e,w.screen_view_smart),this.__closeUnifiedPeerConnByType({id:e,type:w.screen_share_smart}),i.deleteScreenShareState(a),i.deletePlayer(a),n.clearPlayer(),n.clearChatWindow()):(this.__makeUnifiedScreenEnd(e,w.screen_share_smart),this.__endUnifiedScreenSharing(e)):(i.updateCallInvitationState(w.screen_share_smart,{chid:a,media_id:e},w.ended),this.__closeUnifiedPeerConnByType({id:e,type:w.data_channel}),this.__makeUnifiedScreenEnd(e),this.__endUnifiedScreenSharing(e),this.clearData(e),n.handleCallEnded({type:w.screen_share,chid:a}))}catch(e){}},t.prototype.__closeUnifiedPeerConnByType=function(e){var t,i=e.id,n=e.type,a=this.container.commonImpl,o=[w.upstream,w.downstream];for(t in o){var s=a.getUnifiedPeerObjByStreamType({id:i,type:n,streamType:o[t]});s&&(s.closeConnection(),a.removeUnifiedPeerObjByStreamType({id:i,type:n,streamType:o[t]}))}},t.prototype.__endUnifiedScreenSharing=function(e){var t=this.container,i=t.MediaPermission,n=t.commonImpl,a=t.detailsHandler,t=t.mediaUIHandler,n=n.getWmsPushData(e).chid;i.closeStreamByType(w.screen_share),t.deleteScreenShareState(n),t.deletePlayer(n),a.clearPlayer(),a.clearChatWindow(),this.__closeUnifiedPeerConnByType({id:e,type:w.screen_share_smart})},t.prototype.__makeUnifiedScreenEnd=function(e,t){var i,n=this.container,a=n.commonImpl,o=n.constants,n=a.getWmsPushData(e),s=(n.type,n.chid,null),r=[w.upstream,w.downstream];for(i in r){var c=a.getUnifiedPeerObjByStreamType({id:e,type:w.screen_share_smart,streamType:r[i]});c&&(s=c.creatorid)}n={creator_id:s};t&&(n.process_type=o.negotiation,n.negotiation_type=t);n={action:o.end,success_cbk:null,failure_cbk:null,extraData:n};a.setApiData(e,n),a.makeApiCall(e)},t.prototype.handleUnifiedCallAccept=function(t){var i=this,e=this.container,n=(e.dataHandler,e.constants),a=e.commonImpl,o=e.mediaUIHandler,e=(e.detailsHandler,a.getWmsPushData(t)),s=e.chid,r=e.type,e=(e.processType,e.isOldUI,e.isMobileOperator,a.getCallStatusData(t));e?(e.type=r,e.callStatus=n.connecting):e={callStatus:n.connecting},a.setCallStatusData(t,e),a.clearMissedCallTimeout(t),a.clearConnectingTimer(t),a.deleteSwapRequestCallbackState();e={chid:s,media_id:t,muteCbk:function(){},rejectCbk:function(){var e={action:n.cancel,success_cbk:null,failure_cbk:null};a.setApiData(t,e),a.makeApiCall(t),o.updateCallInvitationState(r,{chid:s,media_id:t},n.cancelled),i.clearData(t)}};o.updateCallInvitationState(n.screen_share,e,n.connecting)},t.prototype.addUnifiedRemoteStream=function(e,t){var i=this;try{t.type;var n=t.mid,a=t.chid,o=t.negotiationType,s=this.container,r=s.constants,c=s.mediaUIHandler,d=s.dataHandler,l=s.commonImpl,u=e.stream;if(e.streams&&(u=e.streams[0]),o==r.audio)return;function p(){i.handleUiunifiedEnd(n)}d.get(r.isAlreadySharing)&&(d.set(r.isAlreadySharing,!1),setTimeout(function(){i.handleStopScreenShare(n)},2e3));var h=this.container.uiHandler.states[a];l.getUnifiedPeerObjByStreamType({id:n,type:r.screen_share_smart,streamType:r.downstream})&&h&&h.screen_share&&h.screen_share.type&&(this.container.uiHandler.states[a].screen_share.type=r.viewing);var m=c.getUIState().states&&c.getUIState().states[a]&&c.getUIState().states[a].screen_share;if(m&&m.type==r.sharing)return;c.updateCallInvitationState(r.screen_share,{chid:a,id:n,media_id:n,callEndCbk:p},r.connected),c.playScreenShareStream({stream:u,chid:a,mid:n,endCbk:p})}catch(e){}},t}(l),u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setUnifiedCredential=function(e){},t.prototype.setUnifiedPeerObj=function(e){var t=e.peerObj,i=e.data,n=this.container.dataHandler,a=i.id,o=i.isUpStream,s=i.type,r=i.datatype,e=o?w.upstream:w.downstream,i={};i[e]=t;o=this.getUnifiedPeerObj({id:a});(o=o||{})[r||s]?o[r||s][e]=t:o[r||s]=i,n.set(a+"_unifiedconnection",o)},t.prototype.getUnifiedPeerObjByStreamType=function(e){var t=e.id,i=e.type,e=e.streamType,t=this.container.dataHandler.get(t+"_unifiedconnection");if(!t)return null;i=t[i];return i?i[e]:null},t.prototype.removeUnifiedPeerObjByStreamType=function(e){var t=e.id,i=e.type,e=e.streamType,t=this.container.dataHandler.get(t+"_unifiedconnection");if(!t)return null;i=t[i];if(!i)return null;delete i[e]},t.prototype.getUnifiedPeerObj=function(e){e=e.id,e=this.container.dataHandler.get(e+"_unifiedconnection");return e||null},t.prototype.setUserTrackDetails=function(e){var t=this.container.dataHandler,i=e.id,n=e.userDetails;(this.getUnifiedTrackDetails(e)||{})[n],t.set(i+"_unifiedtrackdetails",n)},t.prototype.getUnifiedTrackDetails=function(e){e=e.id,e=this.container.dataHandler.get(e+"_unifiedtrackdetails");return e||null},t.prototype.sendUnifiedOffer=function(e){e.chid;var t=e.description,i=e.mid,n=(e.type,e.tracksId),a=e.negotiationType,o=e.processType,s=e.candidate,r=e.dataType,c=this.container,e=(c.detailsHandler,c.ajaxHandler),c=this.constructV3URL(i),i={};i.offer_sdp=t,i.tracks_id=R(n),i.negotiation_type=a,i.process_type=o,i.action="offer",i.candidate=s,i.data_type=r,e.put(c,i,null,null,!0,"v3")},t.prototype.sendUnifiedAnswer=function(e){e.chid;var t=e.description,i=e.mid,n=(e.type,e.tracksId),a=e.negotiationType,o=e.processType,s=e.candidate,r=e.dataType,c=e.creatorid,d=this.container,e=(d.detailsHandler,d.ajaxHandler),d=this.constructV3URL(i),i={};i.tracks_id=R(n),i.negotiation_type=a,i.process_type=o,i.answer_sdp=t,i.data_type=r,i.candidate=s,i.action="answer",i.creator_id=c,e.put(d,i,null,null,!0,"v3")},t.prototype.sendUnifiedCandidates=function(e){var t=e.candidates,i=(e.chid,e.mid),n=(e.type,e.isupstream),a=e.dataType,o=e.creatorid,e=this.constructV3URL(i),i={};i.ice_candidates=t,i.action="candidates",i.isupstream=n,i.data_type=a,i.creator_id=o,this.container.ajaxHandler.put(e,i,null,null,!0,"v3")},t.prototype.inviteUser=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.makeUnifiedCallAccept=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.sendUnifiedConnected=function(e){var t=e.mid,i=e.isUpStream,n=e.type,e=this.constructV3URL(t),t={action:"connected"};t.isupstream=i,t.data_type=n,this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.sendUnifiedState=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.constructV3URL=function(e){var t="media";return e&&(t+="/"+e),t},t.prototype.isSmartFlow=function(e){e=this.getCallStatusData(e);return!(!e||!e.type||!e.type.includes("unified")&&!e.type.includes("smart"))},t.prototype.checkUnifiedNetwork=function(t,e){var i=this;void 0===e&&(e=!1);var n=t.chid,a=t.mid,o=this.container.mediaUIHandler,s=t.type,r="undefined"==typeof _MEDIASERVERURL?_MEDIASTATICURL:_MEDIASERVERURL;t.reconnectInterval=setTimeout(function(){var e=document.createElement("IMG");e.src=r+"/salesiq/images/spacer_592ebefc7104d681d57852665e9ad514_.gif?nocache="+(new Date).getTime(),e.onload=function(){clearTimeout(t.reconnectInterval),t.reconnectEndTimer=null,t.iceRestart=!0,t.isUpStream?t.createOffer():t.isUpStream||i.__initRegenerateOffer(t),t.isReconnecting=!0,t.iceRestart=!0,i.updateAcceptedTimeForMediaStats(Date.now(),a)},e.onerror=function(){return i.checkUnifiedNetwork(t,!0)}},5e3),t.reconnectEndTimer||(t.reconnectEndTimer=setTimeout(function(){i.container[s+"Impl"].endOngoingCall(n,a),clearTimeout(t.reconnectInterval),t.reconnectEndTimer=null},3e4)),e||o.updateCallInvitationState(s,{chid:n,media_id:a},"reconnecting")},t.prototype.__initRegenerateOffer=function(e){var t=this.container.detailsHandler,i=e.mid,n=this.constructV3URL(i),a={};a.action=w.restart,a.data_type=e.type,a.session_id=t.getSessionID(),this.container.ajaxHandler.put(n,a,null,null,!0,"v3"),e.closeConnection(),this.removeUnifiedPeerObjByStreamType({id:i,type:e.type,streamType:w.downstream})},t.prototype.closeUnifiedPeerConnByType=function(e){var t,i=e.id,n=e.type,a=this.container.commonImpl,o=[w.upstream,w.downstream];for(t in o){var s=a.getUnifiedPeerObjByStreamType({id:i,type:n,streamType:o[t]});s&&(s.closeConnection(),a.removeUnifiedPeerObjByStreamType({id:i,type:n,streamType:o[t]}),this.clearMediaPermision(n))}},t.prototype.endOngoingUnifiedCall=function(t,e,i){var n=this.container,a=n.detailsHandler,n=n.mediaUIHandler,o=this;[w.screen_view_smart,w.screen_share_smart,w.audio_unified_mix,w.audio_smart,w.data_channel].forEach(function(e){o.closeUnifiedPeerConnByType({id:t,type:e})}),a.isEmbed()&&a.clearConformBox()&&this.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()}}),n.deleteScreenShareState(e),a.clearChatWindow(),n.deletePlayer(e),a.clearPlayer()&&this.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()}}),a.clearPopup()&&this.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:a.getMediaActivityAddInfo()}}),this.setApiData(t,{action:w.end,success_cbk:i,failure_cbk:function(){},extraData:{}}),this.makeApiCall(t)},t.prototype.getTypeFromConnectionType=function(e,t){if(this.container.detailsHandler.isOldUI())return t;var i={audio:{unified:w.audio_unified_mix,smart:w.audio_smart},screen_share:{unified:w.screen_share_smart,smart:w.screen_share_smart},screen_view:{unified:w.screen_view_smart,smart:w.screen_view_smart}};return i[t]&&null!=i[t][e]?i[t][e]:t},t.prototype.clearMediaPermision=function(e){var t={audio_unified_mix:w.audio,audio_smart:w.audio,screen_share_smart:w.screen_share,screen_view_smart:w.screen_share};this.container.MediaPermission.closeStreamByType(e=null!=t[e]?t[e]:e)},t}(u),p=function(e){function t(){e.apply(this,arguments),this.isDirectCallAllowed=!1}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.audioIconStatus=function(e,t,i){void 0===i&&(i=1);var n=this.container,a=n.detailsHandler,o=n.commonImpl,s=n.dataHandler,r=n.MediaDetails,c=n.constants,d=o.getMediaDataByChidAndType({chatid:e,type:c.audio})||!1,n=s.get(c.media_active);-1==e&&t(e,c.hide);var l={not_group_chat:!a.isGroupConversation(e),not_bot:!a.isAttenderBot(e),ongoing_chat:a.isChatExist(e),audiocall_enabled:a.isAudioCallEnabled(),current_plan_allowed:a.isPlanAllowed(),is_secure:a.isSecureConnection(),is_proactive_chat:!a.isProactiveChat(e),live_chat_window:a.isliveChatWindow(),isFacebookIntegration:!a.isFaceBookIntegration(),isBrandsDisabled:!s.get("isBrandsDisabled")||!1,isBrowserSupported:r.checkBrowserSupported(w.audio)||r.isNotebookDSKApp(),not_queued_chat:!a.isCurrentChatQueued()},u={ongoing_call_current_chat:d,incoming_call_notification:a.hasIncomingCall(e),ongoing_media:a.onGoingCallForChat(e),isMediaActive:n,isInvitationPending:o.isInvitationPending()},o={1:["not_group_chat","not_bot","ongoing_chat","audiocall_enabled","current_plan_allowed","is_secure","is_proactive_chat","live_chat_window","isFacebookIntegration","isBrandsDisabled","isBrowserSupported","not_queued_chat"]}[i].map(function(e){return l[e]}).reduce(function(e,t){return e&&t},!0),i={1:["ongoing_call_current_chat","incoming_call_notification","ongoing_media","isMediaActive","isInvitationPending"]}[i].map(function(e){return u[e]}).reduce(function(e,t){return e||t},!1);t(e,o?i?c.disable:c.show:c.hide)},t.prototype.onstarted=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.MediaPermission,o=i.detailsHandler,s=i.mediaUIHandler,r=i.dataHandler,c=i.constants,d=c.WAITING_TIME_SECS;if(this.iconClicked={},e.data.error&&(e.data.error.code==w.error_code.AUDIO_CALL_NOT_ALLOWED||e.data.error.code==w.error_code.ALREADY_CLOSE_CONVERSATION))return n.removeActiveTab(),n.removeActiveCallData(),a.closeAllStream(),o.hideAudioCall(),o.clearBusyUI(),o.stopNotifSound(),e.data.error.code==w.error_code.AUDIO_CALL_NOT_ALLOWED&&r.set("isBrandsDisabled",!0),!0;if(e.data.error&&e.data.error.code==w.error_code.UNABLE_TO_INTIATE_CALL)return this.clearOngoingCallDataOnFailure(),void o.showAudioCall();var l=R(e.data.msg).media?R(R(e.data.msg).media):R(e.data.msg),u=l.chatid,i=l.chid,p=l.id,h=l.type,a=l.mediaRequest,e=l.connection_type;u||(u=u||i,l.chatid=u),n.setWmsPushData(p,l);r.set(p+"_waiting_timer",setTimeout(function(){var e={};o.isOldUI()&&(e.is_old_ui=o.isOldUI());e={action:c.miss,success_cbk:null,failure_cbk:null,extraData:e};n.setApiData(p,e),n.makeApiCall(p),n.removeMediaCache(w.siq_unifiedMedia),t.clearData(p),t.container.detailsHandler.handleCallMissed({type:h,chid:u}),s.updateCallInvitationState(h,{chid:u,media_id:p},c.missed)},6e4));e={callType:c.outgoing,callStatus:c.ringing,mediarequest:a,host:c.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:h,connection_type:e};n.setCallStatusData(p,e),n.setActiveCallData(u);e={chid:u,type:h,media_id:p,status:w.outgoing};n.setMediaCache(w.siq_unifiedMedia,e),o.handleCallInitiate({type:h,chid:u});d={type:c.audiocall,duration:d,tone:c.outgoingcall,chatid:u,isEncrypted:!1};n.playMediaNotificationSound(d),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_OUTGOING_SOUND_START,add_info:o.getMediaActivityAddInfo()},mid:p});d={cancelCbk:function(){t.handleUICancel(p)},muteCbk:function(){return t.toggleMute()},chid:u,media_id:p};s.handleAudioCallInitiate(h,d),o.triggerIconCheck(u)},t.prototype.clearOngoingCallDataOnFailure=function(){var e=this.container,t=e.commonImpl,i=e.MediaPermission,e=e.detailsHandler;t.removeActiveTab(),t.removeActiveCallData(),i.closeAllStream(),e.stopNotifSound()},t.prototype.onstartedSecondary=function(e){var t=this,i=e.chid,n=e.negotiationType,a=e.id,o=this.container,s=o.mediaUIHandler,r=o.detailsHandler,c=o.commonImpl,d=o.constants,e=o.dataHandler,l={process_type:d.negotiation,negotiation_type:n};r.isOldUI()&&(l.is_old_ui=r.isOldUI()),this.iconClicked[i]&&delete this.iconClicked[i];o=d.WAITING_TIME;e.set(a+"_waiting_timer",setTimeout(function(){var e={action:d.miss,success_cbk:null,failure_cbk:null,extraData:l};c.setApiData(a,e),c.makeApiCall(a),s.updateCallInvitationState(d.audio,{chid:i,media_id:a},d.missed)},o));o={chid:i,media_id:a,cancelCbk:function(){var e={action:d.cancel,success_cbk:null,failure_cbk:null,extraData:l};s.updateCallInvitationState(d.audio,{chid:i,id:a},d.cancelled),c.setApiData(a,e),c.makeApiCall(a),c.clearMissedCallTimeout(a)},muteCbk:function(){return t.toggleMute()}};c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_RENEGOTIATION_INITIATE},mid:a}),s.handleAudioCallInitiate(n,o),r.handleCallInitiate({chid:i,type:n})},t.prototype.startApiDirectCall=function(e){var t=this,i=(e.conversationType,e.successCbk),n=this.container,a=n.mediaUIHandler,e=n.MediaPermission,n=n.commonImpl,o=function(){clearTimeout(s)},s=setTimeout(function(){o=a.mediaPermissionUI()},3e3);return e.getAudioStream(function(){o(),t.directCallMediaPermissionSuccess(i)},function(){return t.directCallMediaPermissionFailure(function(){return o()})}),n.setActiveTab(),this.isDirectCallAllowed=!0},t.prototype.directCallMediaPermissionSuccess=function(e){var t=this;try{var i=this.container,n=i.detailsHandler,a={tone:i.constants.outgoingcall,duration:60};n.playNotifSound(a),this.isDirectCallAllowed=!0;e(function(){return t.toggleMute()})}catch(e){}},t.prototype.directCallMediaPermissionFailure=function(e){var t=this.container.mediaUIHandler;return e(),t.mediaPermissionUnlock(),t.directCallCancelled(),!1},t.prototype.handleUIApiReject=function(e){this.handleUIReject(e),this.container.detailsHandler.initMissedChat(chatid,"CALLENDED","2",!0)},t.prototype.handleUIApiCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.detailsHandler,a=t.constants,o=i.getWmsPushData(e).chatid,t={action:a.end,success_cbk:function(){return n.endSession(o)},failure_cbk:null,extraData:{}};i.setApiData(e,t),i.makeApiCall(e),this.handleCallEnd(e),i.removeMediaCache(a.siq_directcall)},t.prototype.onDirectCallStarted=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.detailsHandler,o=i.mediaUIHandler,s=i.dataHandler,r=i.constants,c=e.type,d=e.id,l=e.chatid,u=e.mediaRequest,i=e.connection_type;n.setWmsPushData(d,e),n.setCredential(d);s.set(d+"_waiting_timer",setTimeout(function(){n.removeMediaCache(r.siq_directcall),n.clearMissedCallTimeout(d),t.clearData(d),a.initMissedChat(l,"CALLENDED","2",!0),o.updateCallInvitationState(c,{chid:l,media_id:d},r.missed)},6e4));i={callType:r.outgoing,callStatus:r.ringing,mediarequest:u,host:r.upstream,isdirectcall:!0,isPerfectRenegotiation:!1,connection_type:i,type:c};n.setCallStatusData(d,i),n.setActiveCallData(l);var p=function(){a.initMissedChat(l,"CALLENDED","2",!0),o.updateCallInvitationState(r.audio,{chid:l,media_id:d},r.cancelled),n.removeMediaCache(r.siq_directcall),n.clearMissedCallTimeout(d),t.clearData(d)},h=function(){return t.toggleMute()};a.triggerIconCheck(l);setTimeout(function(){return o.handleAudioCallInitiate(c,{muteCbk:h,chid:l,cancelCbk:p,media_id:d,isDirectCall:!0})},500),clearTimeout(a.getChatWinObjById(l).waitTimer),n.setMediaCache(r.siq_directcall,{chid:l,type:c,media_id:d,status:w.outgoing})},t.prototype.startAudioCallAgain=function(e){var t=this.container,i=t.detailsHandler,n=t.audioImpl,t=t.constants;i.isRecordingON()||this.hasIncommingCall(e)||(e=i.getChatWinObjById(e),i={type:t.audio,chatid:e.chatID,mode:t.visitor,mediarequest:!0,mediainvitation:!0,wmsid:$Support.EmbedObj.vwmsid,lsuid:e.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,session_id:i.getSessionID()},n.startAudioCall(i))},t}(e),h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.screenshareIconStatus=function(e){var t=e.chid,i=e.callback,n=e.type;void 0===n&&(n=1);var a=this.container,e=a.detailsHandler,a=a.constants,o={not_group_chat:!e.isGroupConversation(t),not_bot:!e.isAttenderBot(t),ongoing_chat:e.isChatExist(),audiocall_enabled:e.isScreenShareAllowed(),current_plan_allowed:e.isPlanAllowed()},s={sharescreenAllowed:!e.isShareScreenAllowed(t)},e={1:["not_group_chat","not_bot","ongoing_chat","audiocall_enabled","current_plan_allowed"]}[n].map(function(e){return o[e]}).reduce(function(e,t){return e&&t},!0),n={1:["sharescreenAllowed"]}[n].map(function(e){return s[e]}).reduce(function(e,t){return e&&t},!0),a=e?n?a.disable:a.show:a.hide;d(i)&&i(t,a)},t.prototype.isScreenShareAllowed=function(e,t){var i=e.chatid,n=this.container,a=n.commonImpl,o=n.constants,s=n.detailsHandler,r=n.mediaUIHandler,c=!0,e="",n="";return!a.getMediaDataByChidAndType({chatid:i,type:o.screen_share})&&(s.isSecureConnection()?s.isShareScreenAllowed(i)||(c=!1,n="siqMedia: screen share Failed screen share not allowed | chid - "+i):(c=!1,e=s.I18N("av.info.insecuredwebsite"),n="siqMedia: screen share Failed Visitor not in secure connection | chid - "+i),!c&&e&&(r.showDialog({desc:e,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),callBackAction(implConstants.postDebugLog,n)),c)},t}(l),m=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(c),_=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.checkAndUpdateUIForApi=function(){},t.prototype.showDesktopNotif=function(){},t.prototype.startApiCall=function(e){},t.prototype.checkAndPlayNotification=function(){},t.prototype.getFailureMessage=function(e){var t=null;switch(e.name){case"NotFoundError":case"DevicesNotFoundError":t=LSResource.getRealValue("av.info.microphone.notavailable");break;default:t=LSResource.getRealValue("av.info.microphone.blocked")}return t},t.prototype.sendMediaStats=function(e,t){var i=e.msg,n=i?i.media:null,n=n&&n.id?n.id:e.id||i.id,i={};e.statcode&&(i.statcode=e.statcode),i.description=t,this.container.ajaxHandler.post("stats/"+n+"/media",i,null,null)},t}(u);function I(e,t){for(var i=[],n=arguments.length-2;0<n--;)i[n]=arguments[n+2];return{tag:e,props:t||{},children:i}}function f(e,t){if(void 0===t&&(t={}),-1!=["number","string","undefined"].indexOf(typeof e))return document.createTextNode(e);var i=document.createElement(e.tag);g(i,e.props,t);for(var n=0;n<e.children.length;n++)i.appendChild(f(e.children[n],t));return i}function g(e,t,i){if(!e.skipattr)for(var n in t)"skipattr"==n?e.skipattr=!0:"on"==n.slice(0,2)?function(e,t,i){t=t.slice(2).toLowerCase(),e._listeners&&e._listeners[t]||e.addEventListener(t,function(e){return this._listeners[e.type](e)},!1);(e._listeners||(e._listeners={}))[t]=i}(e,n,t[n]):"ref"===n.slice(0,3)?i.refs[t[n]]=e:"html"===n.slice(0,4)?e.innerHTML=t[n]:"video"!=e.tagName.toLowerCase()||e[n]?n&&void 0!==t[n]&&$(e).attr(n)!=t[n]&&e.setAttribute(n,t[n]):e[n]=t[n]}function y(e,t,i,n){var a,o,s,r=e;if(e)if(a=e,(s=-1!=["string","number"].indexOf(typeof(o=t)))||3==a.nodeType?s&&3==a.nodeType&&a.textContent==o:a.tagName.toLowerCase()==o.tag.toLowerCase()){if("object"==typeof t&&1==e.nodeType){var c=Math.max(e.childNodes.length,t.children.length),d=Array.from(e.childNodes);g(e,t.props||{},n);for(var l=0;l<c;l++)y(d[l],t.children[l]||"",e,n)}}else r=f(t,n),$(e).replaceWith(r);else t&&i.append(f(t,n));return r}function C(e,o){var s=0,r=0,c=e,d=!1;function l(e){u(e);var t=getComputedStyle(c),i=parseInt(t.getPropertyValue("left"))||0,n=parseInt(t.getPropertyValue("top"))||0;if(i<0||n<0)return i<0&&(c.style.left="0px"),n<0&&(c.style.top="0px"),d=!1,void(o?window.parent:window).removeEventListener("mousemove",l);var a=parseInt(t.getPropertyValue("right"))||0,t=parseInt(t.getPropertyValue("bottom"))||0;if(a<0||t<0)return a<0&&(c.style.left=i+a+"px"),t<0&&(c.style.top=n+t+"px"),d=!1,void(o?window.parent:window).removeEventListener("mousemove",l);c.style.left=e.pageX-s+"px",c.style.top=e.pageY-r+"px"}function u(e){e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}e.addEventListener("mousedown",function(e){u(e),d=!0;var t=getComputedStyle(c),i=parseInt(t.getPropertyValue("left"))||0,t=parseInt(t.getPropertyValue("top"))||0;s=e.pageX-i,r=e.pageY-t,(o?window.parent:window).addEventListener("mousemove",l)}),e.addEventListener("mouseup",function(e){u(e),!0===d&&(d=!1,(o?window.parent:window).removeEventListener("mousemove",l))})}u=function(){this.embed=SiqAVRouter.container.mediaUIHandler.isEmbed(),this.reRender()};u.prototype.updateState=function(e){e&&(this.state=e);try{this.reRender()}catch(e){}},u.prototype.reRender=function(){var e;this.dom&&1==this.dom.nodeType?this.dom=y(this.dom,this.render(),this.placeholder,this):(e=f(this.render(),this),this.dom&&$(this.dom).replaceWith(e),this.dom=e,this.embed?e&&e.className&&e.className.includes("zsiq_media_videomain")?e&&n(e,this.frameout):this.disableDrag||C(e,this.frameout):this.disableDrag||1!=e.nodeType||$(e).draggable({containment:"window",scroll:!1})),this.dom&&!this.dom.parentNode&&(this.placeholder_prepend?$(this.placeholder).prepend(this.dom):$(this.placeholder).append(this.dom))},u.prototype.destroy=function(){$(this.dom).remove()};var A=function(a){function e(e,t,i,n){void 0===n&&(n=!1),this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.frameout=!0,this.screenShareAllowed=i.mediaUIHandler.isScreenShareAllowed(),this.isInviteOnly=n,this.isDummyImage=!0,a.call(this)}return a&&(e.__proto__=a),((e.prototype=Object.create(a&&a.prototype)).constructor=e).prototype.destroy=function(){this.ssTimer&&clearInterval(this.ssTimer),this.audioTimer&&clearInterval(this.audioTimer),$(this.dom).remove()},e.prototype.canStartSS=function(){return!this.state.screen_share},e.prototype.__callCbk=function(){b(this.container,this.state.chid,this.embed)},e.prototype.getUI=function(){var e=this.state,t=e.audio,e=e.screen_share;return e&&this.isSharing(e.type)&&!this.isInviteOnly?this.getScreenShareUI():!t||e&&this.isViewing(e.type)&&(!this.isViewing(e.type)||this.isConnected(t.status))?"":this.getAudioCallUI()},e.prototype.getAudioCallBtns=function(){var e=this,t=this.state,i=t.handler,n=(t.name,t.url,t.screen_share),a=t.audio,o=t.chid,s=a.mute,r=a.status,c=a.media_id,d=this.container.mediaUIHandler,l=this.isInvited(r),u=this.isConnected(r),p=this.isRequested(r),h=this.isConnecting(r),m=[this.constants.rejected,this.constants.cancelled,this.constants.missed].includes(r),_=d.isScreenShareAllowed(),f=n&&this.isConnected(n.status),g=n&&(this.isConnected(n.status)?this.constants.stopsharing:this.constants.cancel),t=u?this.constants.end:this.constants.cancel,a=!d.isCallInitiatedFromOldUI(c)&&!d.isMobileOperator(c),c=!d.isMobileVisitor(o),d=d.isSecure();return r!=this.constants.ended?I("div",{class:"siq_media_btns siq_media_flexM"},_&&!n&&u&&a&&c&&d?I("div",{class:"zsiqmico-screenshare zsiq_media_gbtn",title:M("screenshare"),onclick:function(){return e.container.uiHandler.shareScreen(o)}}):"",n&&this.isSharing(n.type)&&!l&&!this.isInviteOnly?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn",title:M(g),onclick:function(){return i(o,"screen_share","reject")}}):"",u||p||h?I("div",{class:(s?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn "+(_||f?"zsiq_media_mL13":""),title:M(s?"unmute":"mute"),onClick:function(){return i(o,"audio","mute")}}):"",l?I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn "+(n?"zsiq_media_mL13":""),title:M("accept"),onclick:function(){return i(o,"audio","accept")}}):"",m?"":I("div",{class:"zsiqmico-endcall zsiq_media_rbtn "+(u||p||l||h||f?"zsiq_media_mL13":""),title:M(t),onclick:function(){return i(o,"audio","reject")}})):""},e.prototype.getScreenShareBtns=function(){var e,t,i=this.state,n=i.handler,a=i.screen_share,o=i.audio,s=i.chid,r=a.status;o&&(e=o.mute,t=o.status);var c=this.isConnected(t),d=this.isConnecting(t),l=this.isEnded(t),u=this.isConnected(r),p=a&&(this.isConnected(a.status)?this.constants.stopsharing:this.constants.cancel),i=o&&(c?this.constants.end:this.constants.cancel),r=this.container.mediaUIHandler.isAudioCallEnabled();return o&&o.status==this.constants.ended?"":I("div",{class:"siq_media_btns siq_media_flexM"},a&&this.isSharing(a.type)&&!this.isRequested(t)&&!this.isInvited(t)?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn",title:M(p),onclick:function(){return n(s,"screen_share","reject")}}):"",a&&(this.isRequested(t)||this.isInvited(t))?I("div",{title:M(p),class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_disable"}):"",o&&(c||d)?I("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn "+(c||d?"zsiq_media_mL13":""),title:M(e?"unmute":"mute"),onClick:function(){return n(s,"audio","mute")}}):"",c?I("div",{class:"zsiqmico-endcall zsiq_media_rbtn "+(c||isRequested||isInvited||d||l&&u?"zsiq_media_mL13":""),title:M(i),onclick:function(){return n(s,"audio","reject")}}):"",u&&!o&&r?I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn "+(a?"zsiq_media_mL13":""),title:M("call"),onclick:this.__callCbk.bind(this)}):"")},e.prototype.getAudioCallUI=function(){var e=this.state,t=(e.handler,e.name),i=e.url,n=(e.screen_share,e.audio),a=e.chid,o=e.timer,s=e.consent,r=(n.mute,n.status),c=n.media_id,d=this.isInvited(r),l=this.isRequested(r),e=i&&i(c)?I("img",{src:i(c,a),alt:t?t(a):"Operator",draggable:"false"}):I("em",{class:"sqico-person"}),i=t(a),i=i&&i[0].toLowerCase(),c=this.container.commonImpl.isSmartFlow(c);return I("div",{class:"zsiq_media_headshot_main"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},d||l?I("div",{class:"zsiq-media-anim"}):"",I("div",{class:this.isDummyImage?"zsiq_media_userimg":"zsiq_media_imgdummy-"+i},e),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},t(a)),I("div",{class:"zsiq_media_info zsiq_media_elips"},o&&c&&n&&this.isConnected(r)?I("em",{title:M("recording"),class:"zsiqmico-record",style:"cursor: pointer;"}):"",H(this.state,this.__getAudioCallStatusPriorityInSS())),I("div",{class:"zsiq_media_dept zsiq_media_flexC",style:"display:none;"},I("span",{class:"zsiqmico-dept"}),I("span",{class:"zsiq_media_elips"})),this.getAudioCallBtns()))),s&&s.show?this.getConsentUI():"")},e.prototype.getConsentUI=function(){var e=this.state,t=e.handler,i=e.chid,e=e.consent;return I("div",{class:"const-div"},I("div",{class:"const-title"},e.title),I("p",{class:"const-desc"},e.desc),I("div",{class:"zsiq_center zsiq_popup_btn  const-btn"},I("span",{class:"zsiq_center",onclick:function(){return t(i,"consent","accept")}},e.type==this.constants.screen?LSResource.getRealValue("common.share"):LSResource.getRealValue("common.gdpr.agent.accept")),I("span",{class:"zsiq_center zsiq_cancelbtn",onclick:function(){return t(i,"consent","reject")}},LSResource.getRealValue("common.decline"))))},e.prototype.getScreenShareUI=function(){var e=this.state,t=e.timer,i=e.name,n=e.url,a=e.screen_share,o=(e.audio,e.chid),s=e.consent,e=i(o),e=e&&e[0].toLowerCase(),n=n&&n(a.media_id)?I("img",{src:n(a.media_id,o),alt:i?i(o):"Operator",draggable:"false"}):I("em",{class:"sqico-person"}),a=this.container.mediaUIHandler.isScreenRecordAllowed()&&this.container.mediaUIHandler.isScreenRecordingEnabled()&&this.container.commonImpl.isSmartFlow(a.media_id);return I("div",{class:"zsiq_media_headshot_main"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},I("div",{class:this.isDummyImage?"zsiq_media_userimg":"zsiq_media_imgdummy-"+e},n),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},t&&a?I("em",{title:M("recording"),class:"zsiqmico-record zsiq_media_mR10",style:"cursor: pointer;"}):"",i(o)),I("div",{class:"zsiq_media_info zsiq_media_elips"},P(this.state,!1)),I("div",{class:"zsiq_media_dept zsiq_media_flexC",style:"display:none;"},I("span",{class:"zsiqmico-dept"}),I("span",{class:"zsiq_media_elips"})),this.getScreenShareBtns()))),s&&s.show&&s.type==this.constants.screen?this.getConsentUI():"")},e.prototype.inviteCheck=function(){var e=this.state,t=e.screen_share,e=e.audio;return!this.isInviteOnly||t&&e&&this.isSharing(t.type)&&!this.isConnected(e.status)&&!this.isEnded(e.status)},e.prototype.render=function(){return!this.inviteCheck()||this.state.isDirectCall||document.querySelector("#call_Busy")?"":this.getUI()},e.prototype.__getAudioCallStatusPriorityInSS=function(){var e=this.state,t=e.screen_share,i=e.audio,e=e.timer,i=i.status;return!(e&&!t&&this.__isStatusNotConnected(i))&&!!(e&&!t||e&&!this.__isStatusNotConnected(i))},e.prototype.__isStatusNotConnected=function(e){return e!=this.constants.connected},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(u);function b(e,t,i){void 0===i&&(i=!0);var n={type:e.constants.audio,mode:e.constants.visitor,mediarequest:!0,mediainvitation:!0},a=e.mediaUIHandler.getChatWinObjById(t);i?$.extend(n,{chatid:a.chatID,wmsid:$Support.EmbedObj.vwmsid,lsuid:a.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,normalchid:t,session_id:e.detailsHandler.getSessionID()}):$.extend(n,{chatid:t}),e.mediaUIHandler.startAudioCall(n)}var E=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.showSSList=!1,this.showMoreOptions=!1,this.showSettings=!1,this.placeholder_prepend=!0,this.moreOptionsUIPosition={right:"0"},this.init(),n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.init=function(){this.fullscreen=!1,this.showcntrl=!1,this.frameout=!0,this.switchCbk=this.switchFullscreen.bind(this)},e.prototype.switchFullscreen=function(e){"keyup"==e.type&&"Escape"!=e.key||(this.fullscreen=!this.fullscreen,this.fullscreen?$Support.getParent().document.addEventListener(this.constants.keyup,this.switchCbk):$Support.getParent().document.removeEventListener(this.constants.keyup,this.switchCbk),this.reRender())},e.prototype.getAudioCallBox=function(){var e=this.state,t=e.audio,i=e.handler,n=e.chid,a=e.name,o=e.url,s=this.embed?"siqico":"sqico",e=t&&(this.isConnected(t.status)?this.constants.end:this.constants.cancel);return I("div",{class:"zsiq_calldtl"},I("span",null,o&&o(t.media_id)?I("img",{src:o(t.media_id,n),alt:a?a(n):"Operator",class:"siquserimg"}):I("em",{class:s+"-user"}),I("em",{class:"zsiq_caller txtelips"},a(n))),I("span",null,H(this.state),t&&this.isConnected(t.status)?I("em",{title:M(t.mute?"unmute":"mute"),class:s+"-"+(t.mute?"unmute":"mute")+" zsiq_ctrlico",onClick:function(){return i(n,"audio","mute")},"data-type":"mic"}):"",t&&this.isInvited(t.status)?I("em",{title:M("accept"),class:s+"-end zsiq_vend zsiq_ctrlico zsiq_callin",onclick:function(){return i(n,"audio","accept")}}):"",I("em",{title:M(e),class:s+"-end zsiq_vend zsiq_ctrlico",onclick:function(){return i(n,"audio","reject")}}),I("em",null)))},e.prototype.showCntrl=function(){var e=this;this.showcntrl=!0,clearTimeout(this.showCntrlTimer),this.showCntrlTimer=setTimeout(function(){e.showcntrl=!1,e.reRender()},1500),this.__swapHandlerClickCbk(),this.reRender()},e.prototype.__swapHandlerClickCbk=function(){this.swapOptions&&($(this.swapOptions).remove(),this.swapOptions=null)},e.prototype.__swapHandler=function(e,n,t){function i(e,t,i){n(e,t,i),o()}var a=this,o=function(){return a.__swapHandlerClickCbk.call(a)};if(this.swapOptions)return o();this.swapOptions=f(I("div",{class:"zsiqcalloptions",id:"calloptions",style:"left:"+(e.clientX-220)+";top:"+(e.clientY-65)+";height:65px;z-index:11111111111;",onMouseLeave:this.__swapHandlerClickCbk.bind(this)},I("div",{onClick:function(){return i(t,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")),I("div",{onClick:function(){return i(t,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")))),this.placeholder.append(this.swapOptions)},e.prototype._SwapList=function(e,t,i){this.embed&&this.state.audio&&!this.fullscreen?this.__swapHandler(e,t,i):t(i,"screen_share","swap")},e.prototype.__showMoreOptions=function(){var e,t=this;this.showMoreOptions||(e=function(){t.showMoreOptions=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showMoreOptions=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showSettings=function(){var e,t=this;this.showSettings||(e=function(){t.showSettings=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSettings=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showDropDownList=function(){var e,t=this;this.getCallBarUIPosition(),this.showSSList||(e=function(){t.showSSList=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSSList=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.getCallBarUIPosition=function(){var e=this.container.uiHandler.getUIPosition(".zsiq_media_videomain");e.width<570&&e.left<100?this.moreOptionsUIPosition.right="auto":this.moreOptionsUIPosition.right="0"},e.prototype.__callCbk=function(){b(this.container,this.state.chid,this.embed)},e.prototype.getScreenShareButtons=function(){var e,t,i=this.state,n=i.screen_share,a=i.audio,o=i.handler,s=i.chid,r=i.chatWinFocused;a&&(e=a.mute,t=a.status);var c=this.isConnected(t),d=n.status,l=n.type,u=this.isConnected(d),p=n&&(u?this.constants.stopsharing:this.constants.cancel),h=a&&(c?this.constants.end:this.constants.cancel),m=this.container.mediaUIHandler.isAudioCallEnabled(),i=a&&[this.constants.invited,this.constants.requested,this.constants.connecting,this.constants.cancelled,this.constants.rejected,this.constants.missed].includes(t),d=this.container.mediaUIHandler.isScreenShareAllowed();return I("div",{class:"zsiq_media_videofoot"},a||d?I("div",{class:"zsiq_media_posrel"},u&&!i?I("div",{class:"zsiqmico-more zsiq_media_wbtn",title:M("options"),onMouseUp:this.__showDropDownList.bind(this)}):"",I("div",{class:"zsiq_media_options",style:(this.showSSList?"display:block;":"display:none;")+" right : "+this.moreOptionsUIPosition.right+";"},d?I("div",{class:"zsiq_media_option_li",onclick:function(){return o(s,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")):"",a&&n&&this.isViewing(l)?I("div",{class:"zsiq_media_option_li zsiq_media_red",onclick:function(){return o(s,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")):"")):"",u&&i?I("div",{class:"zsiqmico-more zsiq_media_wbtn zsiq_media_disable"}):"",I("span",{class:"zsiqmico-chat zsiq_media_wbtn",style:"display:none;"}),this.embed&&a&&(c||this.isConnecting(t)||this.isRequested(t))&&!i?I("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn zsiq_media_mL13",title:M(e?"unmute":"mute"),onClick:function(){return o(s,"audio","mute")}}):"",(this.embed||this.fullscreen||!r)&&!a&&u&&m?I("span",{title:M("call"),class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",onclick:this.__callCbk.bind(this)}):"",this.embed&&a&&i?I("span",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13 zsiq_media_disable"}):"",this.embed&&a&&c?I("span",{title:M(h),class:"zsiqmico-endcall zsiq_media_rbtn zsiq_media_mL13",onclick:function(){return o(s,"audio","reject")}}):"",this.embed&&!a&&n&&this.isViewing(l)?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_mL13",title:M(p),onclick:function(){return o(s,"screen_share","reject")}}):"")},e.prototype.getUI=function(){var e=this,t=this.state,i=t.screen_share,n=t.timer,a=(t.chid,i?i.stream:""),t=this.container.mediaUIHandler.isScreenRecordAllowed()&&this.container.mediaUIHandler.isScreenRecordingEnabled()&&this.container.commonImpl.isSmartFlow(i.media_id);return a?I("div",{class:"zsiq_media_videomain "+(this.fullscreen?"zsiq-media-maxscreen":"zsiq-media-minscreen")+" "+(this.showcntrl||!n?"zsiq_showcntl":"")+" ",onMouseMove:this.showCntrl.bind(this),onMouseOver:this.showCntrl.bind(this),onMouseDown:this.__swapHandlerClickCbk.bind(this)},this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_left_corner",position:"top_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_border",position:"top_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_right_corner",position:"top_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_right_border",position:"right_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_right_corner",position:"bottom_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_border",position:"bottom_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_left_corner",position:"bottom_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_left_border",position:"left_border"}),I("div",{class:"zsiq_media_videohdr"},I("div",{class:"zsiq_media_videotime"},n&&t?I("em",{title:M("recording"),class:"zsiqmico-record zsiq_media_mR10",style:"cursor: pointer;"}):"",P(this.state)),I("div",{class:"zsiq_media_videohdrico"},I("span",{class:"zsiqmico-settings",style:"display:none;"}),I("span",{class:this.fullscreen?"zsiqmico-minscreen":"zsiqmico-maxscreen",onclick:this.switchFullscreen.bind(this)}))),this.getScreenShareButtons(),I("div",null,I("video",{autoplay:!0,name:"media",srcObject:a,class:this.isReconnecting(i.status)?"zsiq_media_blur":"",onloadedmetadata:function(){return e.metadata=!0}})),"reconnecting"!=i.status&&this.metadata?"":I("div",{class:"zsiq_media_vloader"})):""},e.prototype.render=function(){var e=this.state,t=e.screen_share,e=e.audio;return t&&this.isViewing(t.type)&&!this.isRequested(t.status)||e&&this.isConnected(e.status)?this.getUI():""},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(u);function k(){var e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],t={Chrome:"https://support.google.com/chrome/answer/2693767?hl=en",Firefox:"https://support.mozilla.org/en-US/questions/1168156",Opera:"https://help.opera.com/en/latest/web-preferences/#microphone",Safari:"https://support.apple.com/en-in/guide/safari/websites-ibrwe2159f50/mac"};t[e]&&window.open(t[e],"_blank")}function T(i,n,a,o,s,r,c){function d(){$(t).remove()}function e(){var e=$(parent.document.body).find(".siq_media");window.currentRecorder&&window.currentRecorder.destroy();var t=Recorder();i.uiHandler.setCallUIposition("#user_busy"),s||(d(),e.append($Temp.getAudioRecordedUI(a(0,n),i.mediaUIHandler.getEscapedText(o(n)),r().top,r().left)),i.mediaUIHandler.removeCallUIPosition()),(window.currentRecorder=t).init(s,n,c)}var t,l=o(n);l&&l[0].toLowerCase();t=s?f(I("div",{class:"cal-wrap",id:"audiorec"},I("div",{class:"posrel dib-mid"},I("div",{class:"cal-widgt theme1 outcal"},I("div",{class:"posrel usr-imginfo"},I("div",{class:"cal-visimg "+((l=$Support.EmbedObj.clogo)?"":"sqico-user")},l?I("img",{src:l,alt:o?o(n):"Operator",draggable:"false"}):"")),I("div",{class:"cal-vstrdetl"},I("nav",{class:"cal-actvevstr elips font18"},LSResource.getRealValue("av.info.oprbusy")),I("p",{class:"cal-usrdesc elips"},LSResource.getRealValue("av.info.voicemsg"))),I("div",{class:"cal-optns posrel textR"},I("span",{onclick:e,class:"sqico-record bg-aaa"})))))):f(I("div",{class:"zsiq_media_headshot_main",id:"user_busy",style:"top:"+r().top+"px; left:"+r().left+"px;"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},I("span",{class:"zsiqmico-close",onclick:d,onMouseUp:function(){i.mediaUIHandler.removeCallUIPosition()}}),I("div",{class:"zsiq_media_userimg"},I("img",{src:a&&a(0,n),alt:o?o(n):"Operator",draggable:"false"})),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},o(n)),I("div",{class:"zsiq_media_elips"},LSResource.getRealValue("av.info.userbusy")),I("div",{class:"siq_media_btns siq_media_flexM"},I("div",{class:"zsiqmico-record zsiq_media_wbtn",title:LSResource.getRealValue("av.info.voicemessage"),onclick:e}),I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){i.mediaUIHandler.isRecordingON()||(d(),b(i,n))}}))))))),s?(CallImpl.isCallWithChat=!0,$("body").prepend(t)):(C(t,!0),$(parent.document.body).find(".siq_media").append(t))}var U=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=this.container.constants,this.disableDrag=!0,this.placeholder_prepend=!0,n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.getAudioCallStatusText=function(){var e=this.state.audio.status,t=this.state.timer;return{timer:t,connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),initiated:LSResource.getRealValue("audiovideo.ringing"),mediapermission:LSResource.getRealValue("av.info.waitingformediapermission")}[t?"timer":e]||""},e.prototype.getUI=function(){var e=this,t=this.state,i=t.url,n=t.handler,a=t.name,o=t.chid,s=t.audio,r=t.screen_share,c=s&&s.status,d=(r&&r.status,-1==["initiated","requested"].indexOf(c)&&i&&i(s.media_id,o)||$Support.EmbedObj.clogo),l="initiated"==c,u="mediapermission"==c,p=this.container.mediaUIHandler.isScreenShareAllowed(),t=this.container.mediaUIHandler.isCallInitiatedFromOldUI(s.media_id),i=r&&r.type==this.constants.viewing;return $Support.getParent().$zoho.salesiq.floatwindow.visible("show"),i&&($Support.getParent().$zoho.salesiq.floatwindow.visible("hide"),$Support.getParent().$zoho.salesiq.floatbutton.visible("hide")),I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"posrel dib-mid"},I("div",{class:"cal-widgt theme1 outcal"},I("div",{class:"posrel usr-imginfo"},I("div",{class:"cal-visimg "},I("img",{src:d,alt:a?a(o):"Operator"}))),I("div",{class:"cal-vstrdetl "+(p?"cal-mw180":"")},I("nav",{class:"cal-actvevstr elips font18"},a&&a(o)||""),I("p",{class:"cal-usrdesc elips"},this.getAudioCallStatusText())),I("div",{class:"cal-optns posrel textR"},!t&&s&&c==this.constants.connected&&p&&!r?I("span",{class:"sqico-screenshare bg-grn",title:M("screenshare"),onclick:function(){return e.container.uiHandler.shareScreen(o)}}):"",!t&&r&&r.type==this.constants.sharing?I("span",{class:"sqico-ssend bg-red",title:M("stopsharing"),onclick:function(){return n(o,"screen_share","reject")}}):"",I("span",{title:s&&M(s.mute?"unmute":"mute"),id:"audiocall_mute",class:"sqico-"+(s.mute?"muteaudio":"microphone")+" bg-aaa "+(u?"cmn_disable":"")+" "+(p?"mL20":""),onclick:function(){return u?"":n(o,"audio","mute")}}),I("span",{title:s&&M(c==this.constants.connected?"end":"cancel"),class:"sqico-call cal-rjct "+(l||u?"cmn_disable":""),id:"audiocall_outgoingend",onclick:function(){return l||u?"":n(o,"audio","reject")}})))))},e.prototype.render=function(){var e=this.state,t=e.isDirectCall,i=e.audio;e.status;return t&&i?this.getUI():""},e}(u);function M(e){var t={mute:LSResource.getRealValue("av.info.mute"),unmute:LSResource.getRealValue("av.info.unmute"),end:LSResource.getRealValue("common.end"),reject:LSResource.getRealValue("common.reject"),screenshare:LSResource.getRealValue("common.screenshare"),swap:LSResource.getRealValue("av.info.swap"),call:LSResource.getRealValue("av.info.call"),cancel:LSResource.getRealValue("common.cancel"),accept:LSResource.getRealValue("common.accept"),stopsharing:LSResource.getRealValue("av.info.endscreen"),options:LSResource.getRealValue("av.info.options"),recording:LSResource.getRealValue("av.info.recording")};return t[e]||""}function O(e,t){return"theme4"!=q()?"":I("div",{class:"thme-bgimg",style:"background-image:url("+("Comp"==e?$Support.EmbedObj.clogo:_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t.attenderimagefkey+"/photo.ls?nps=404")+")"})}function q(){return window.parent.$ZSIQWidget.getWidgetObject().calltheme||"theme1"}function H(e,t){void 0===t&&(t=!0);var i=e.audio.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("av.info.failed")}[e&&t?"timer":i]||""}function P(e,t){void 0===t&&(t=!0);var i=e.screen_share.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue(t?"common.connected":"ss.info.viewing"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("screenshare.info.failed")}[e&&t?"timer":i]||""}function N(e){return SiqAVRouter.container.mediaUIHandler.getChatWinObjById(e)}function L(e,t){void 0===e&&(e=0);var i=SiqAVRouter.container.mediaUIHandler,t=N(t).attenderimagefkey,e=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t+"/photo.ls?mid="+e,i=i.canShowOperatorImage();return JSON.parse(i)&&t?e:$Support.EmbedObj.clogo}function j(e){return SiqAVRouter.container.mediaUIHandler.getDecodedText(z[e])||""}function x(){return SiqAVRouter.container.mediaUIHandler.getCallUIPosition()}function V(e){var t=this;this.container=e,this.invitations=null,this.ss_invitation={},this.states={},window.onbeforeunload=function(){if(e.commonImpl.updateMediaCache(w.siq_directcall,w.is_refreshed,!0),e.commonImpl.updateMediaCache(w.siq_unifiedMedia,w.is_refreshed,!0),Object.keys(t.states).length)return""},this.siqdom=document.createElement("div"),this.siqdom.setAttribute("class","siq_media"),this.siqdom.setAttribute("data-id","zsalesiq"),this.container.mediaUIHandler.getBody()[0].appendChild(this.siqdom)}var z={};function B(){return SiqAVRouter.container.mediaUIHandler.isEmbed()?$(parent.document.body):$("body")}V.prototype.initiateHeadshot=function(e,t){this.states[e]||(this.states[e]={chid:e,isDirectCall:t},this.states[e].headshot=new A(this.states[e],t?$("body"):this.siqdom,this.container),this.states[e].headshotInvite=new A(this.states[e],t?$("body"):this.siqdom,this.container,!0),this.states[e].directCallUI=new U(this.states[e],$("body"),this.container))},V.prototype.__getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},V.prototype.updateCallInvitationState=function(e,t,i){e=this.__getType(e);var n={audio:{connecting:this.makeAudioCallConnecting,connected:this.makeAudioCallConnected,ended:this.makeAudioCallEnded,cancelled:this.makeAudioCallCancelled,rejected:this.makeAudioCallRejected,missed:this.makeAudioCallMissed,reconnecting:this.makeAudioReconnecting,failed:this.makeAudioCallFailed,showConsent:this.showAudioConsent},screen_share:{connecting:this.makeScreenShareConnecting,connected:this.makeScreenShareConnected,ended:this.makeScreenShareEnded,cancelled:this.makeScreenShareCancelled,rejected:this.makeScreenShareRejected,missed:this.makeScreenShareMissed,reconnecting:this.makeScreenShareReconnecting,failed:this.MakeScreenShareFailed,showConsent:this.showScreenConsent}},i=n[e]&&n[e][i];try{i&&i.call(this,e,t)}catch(e){}},V.prototype.playScreenShareStream=function(e){var t=e.stream,i=e.mid,n=(e.endCbk,e.chid),e=this.container.mediaUIHandler;this.initiateHeadshot(n);n=this.states[n];n.screen_share=n.screen_share||{},$.extend(!0,n,{screen_share:{stream:t,type:"viewing",status:"connected",media_id:i}});try{n.player||(n.player=new E(n,this.siqdom,this.container),e.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_SHOWN,add_info:e.getMediaActivityAddInfo()},mid:i}))}catch(e){}},V.prototype.handleAudioCallInvite=function(e,t){var i=this.container.mediaUIHandler;z[t.chid]=N(t.chid)&&N(t.chid).attendername,"audio"==(e=this.__getType(e))?(this.showAudioCallInvitation(t),this.invitations=!0,i.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INVITATION_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t.media_id||t.id})):"screen_share"==e&&this.showScreenShareInvitation(t);t=parent.document.querySelector(".zsiqmico-close");t&&t.click()},V.prototype.clearAudioCallInvite=function(e,t,i){var n=this.container.mediaUIHandler;try{n.isEmbed()&&n.clearConformBox()&&n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:t}),"audio"==e&&i&&this.__callTerminate(e,{chid:i,media_id:t,isDirectCall:!1},"rejected")}catch(e){}},V.prototype.showAudioCallInvitation=function(e){var t=e.chid,i=e.rejectCbk,n=e.acceptCbk,a=e.media_id;this.initiateHeadshot(t);e=this.states[t];$.extend(!0,e,{handler:this.handleActionHandler.bind(this),name:j,url:L,chid:t,audio:{mute:!1,media_id:a,reject_cbk:i,accept_cbk:n,is_invited:!0,status:"invited"}}),this.__updateState(t)},V.prototype.handleAudioCallInitiate=function(e,t){var i=this,n=t.chid,a=t.cancelCbk,o=t.muteCbk,s=t.media_id,r=t.isDirectCall,c=this.container.mediaUIHandler;r?(this.states[n]=this.states.directcall,delete this.states.directcall):this.initiateHeadshot(n,r),z[n]=N(n)&&N(n).attendername;var d=this.states[n],t=parent.document.querySelector(".zsiqmico-close");t&&t.click(),$.extend(!0,d,{handler:this.handleActionHandler.bind(this),name:j,url:L,chid:n,audio:{mute:!!r&&d.audio.mute,media_id:s,reject_cbk:a,mute_cbk:function(){o(),$.extend(!0,d,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},is_invited:!1,status:"requested"}}),this.__updateState(n),c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s})},V.prototype.initiateDirectCallUI=function(e){function t(){e(),$.extend(!0,o,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)}var i=this,n="directcall";if(e=void 0===e?null:e){var a=this.states[n];return $.extend(!0,a,{audio:{mute:!1,mute_cbk:t,status:"initiated"}}),void this.__updateState(n)}$("#audiorec,#audiocal").remove(),this.initiateHeadshot(n,!0);var o=this.states[n];$.extend(!0,o,{audio:{mute:!1,mute_cbk:t,status:"mediapermission"}}),this.__updateState(n)},V.prototype.makeAudioCallConnecting=function(e,t){var i=this,n=t.chid,a=t.muteCbk,o=t.rejectCbk,s=t.media_id,r=(t.name,t.isDirectCall),c=this.container.mediaUIHandler,d=this.states[n];EmbedSound.stop(),z[t.chid]=N(t.chid).attendername,$.extend(!0,d,{isDirectCall:r,audio:{mute_cbk:function(){a(),$.extend(!0,d,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},reject_cbk:o,status:"connecting"}}),this.__updateState(n),c.checkCallHostType({chid:n,mid:s,hostType:"downstream"})&&c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s}),r&&this.stopSoundNotification()},V.prototype.makeAudioCallConnected=function(e,t){t.media_id;var i=t.chid,n=t.callEndCbk,a=t.isDirectCall,o=this.container.constants.connected;EmbedSound.stop(),this.initiateHeadshot(i),this.ss_invitation[i]&&delete this.ss_invitation[i];var s=this.states[i],t=s.audio.status==o?s.audio.connected_time:(new Date).getTime();$.extend(!0,s,{isDirectCall:a,audio:{reject_cbk:n,status:o,connected_time:t}}),setTimeout(this.startTimer.bind(this,i,e),500),this.__updateState(i)},V.prototype.makeAudioReconnecting=function(e,t){this.__makeReconnecting(e,t)},V.prototype.makeAudioCallEnded=function(e,t){this.__callTerminate(e,t,"ended")},V.prototype.makeAudioCallCancelled=function(e,t){this.__callTerminate(e,t,"cancelled")},V.prototype.makeAudioCallRejected=function(e,t){this.states[t.chid].isDirectCall&&this.container.mediaUIHandler.initMissedChat(t.chid,"CALLENDED","2",!0),this.__callTerminate(e,t,"rejected")},V.prototype.makeAudioCallMissed=function(e,t){this.__callTerminate(e,t,"missed")},V.prototype.makeAudioCallFailed=function(e,t){this.__callTerminate(e,t,"failed")},V.prototype.__recordSound=function(e,t,i,n,a){var o=this,s=this.container.mediaUIHandler,r=s.isChatExist(e),c=s.getAttenderId(e),d=this.states&&this.states[e]&&this.states[e].screen_share&&"connected"==this.states[e].screen_share.status;(s.getSupportRepCount(e)<2&&r&&!d&&("rejected"==n&&c==i||"missed"==n)||t)&&(T(this.container,e,L,j,t,x,a),this.__updateState(e),$(".zsiq_media_headshot_main .zsiqmico-close").on("click",function(){return o.__updateState(e)}))},V.prototype.__callTerminate=function(e,t,i){var n=this,a=t.chid,o=t.media_id,s=t.isDirectCall,r=t.lsuid,c=this.container.mediaUIHandler,d=this.states[a],l=d.audio.is_invited;c.checkIsChatEndTimerAlive(a)||c.stopNotifSound(),d&&d.audio?(this.invitations=l?null:this.invitations,$.extend(!0,d,{audio:{status:i}}),"rejected"!=i&&"missed"!=i||s||this.setCallUIposition(".zsiq_media_headshot_main"),setTimeout(function(){var e=d.isDirectCall;delete d.audio,n.__updateState(a),n.__checkAndDestroyInstance(a),l||-1==["rejected","missed"].indexOf(i)||n.__recordSound(a,e,r,i,o),e&&"ended"==i&&n.implementRatingUI(a),e&&"cancelled"==i&&n.directCallCancelled()},500),this.__updateState(a),t=c.checkCallHostType({chid:a,mid:o,hostType:"downstream"})&&["cancelled","rejected","missed"].includes(i)?w.activity.MEDIA_AUDIO_INVITATION_CLEARED:w.activity.MEDIA_AUDIO_UI_CLEARED,c.getActiveTab()&&c.sendMediaActivity({param:{action_type:t,add_info:c.getMediaActivityAddInfo()},mid:o}),s&&(this.stopSoundNotification(),clearTimeout(c.getChatWinObjById(a).waitTimer))):d&&this.__checkAndDestroyInstance(a)},V.prototype.__checkAndDestroyInstance=function(e){try{var t=Object.keys(this.states[e]);0==["audio","screen_share"].filter(function(e){return-1!=t.indexOf(e)}).length&&(this.stopTimer(e),delete this.states[e])}catch(e){}},V.prototype.setCallUIposition=function(e){var t=this.container.mediaUIHandler,i=$(B()).find(e);i[0]&&(e=getComputedStyle(i[0]),i=parseInt(e.getPropertyValue("left"))||0,e=parseInt(e.getPropertyValue("top"))||0,t.setCallUIPosition(e,i))},V.prototype.showScreenShareInvitation=function(e){var t=e.chid,i=e.rejectCbk,n=e.acceptCbk,a=e.media_id,o=this.container.mediaUIHandler;this.initiateHeadshot(t);function s(){o.clearConformBox()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:a}),n()}function r(e){void 0===e&&(e=!0),o.clearConformBox()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:a}),e&&i()}var c,d,l,u,p,h;d=(c={name:j,acceptHandler:s,rejectHandler:r,chid:t}).name,l=c.acceptHandler,u=c.rejectHandler,p=c.chid,e=(h=SiqAVRouter.container).mediaUIHandler,c=h.uiHandler,h=e.getMediaIdByChid(p),h=e.getCallStatusData(h),c=c.__getConsentContent("screen"),c=f(I("div",{class:"zsiq_popup",id:"zsiqssconfirmbox"},I("div",{class:"zsiq_popupsub"},I("div",{class:"zsiq_popup_child"},I("em",{class:"siqico-close zsiq_center",onClick:u}),I("em",{class:"siqico-screenshare zsiq_popuplogo"}),I("div",{class:"zsiq_popup_hdr"},LSResource.getRealValue("common.screensharerequest")),I("div",{class:"zsiq_popup_desc"},LSResource.getRealValue("screenshare.request.desc",d(p))),I("div",{class:"zsiq_popup_btn zsiq_center"},I("span",{class:"zsiq_center",id:"zsiqconfirmss",onClick:l},LSResource.getRealValue("common.share")),I("span",{class:"zsiq_center zsiq_cancelbtn",id:"zsiqdecliness",onClick:u},LSResource.getRealValue("common.decline")))),e.isScreenRecordingEnabled()&&e.isScreenRecordAllowed()&&!e.isScreenConsentAllowed()&&"smart"==h.connection_type?I("div",{class:"siq-note-cont"},I("div",{class:"siq-note-title"},LSResource.getRealValue("common.disclaimer")," "),I("p",{class:"siq-note-desc"},c," ")):""))),$(B()).append(c),o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN,add_info:o.getMediaActivityAddInfo()},mid:a}),this.ss_invitation[t]={rejectHandler:r,acceptHandler:s,media_id:a,template:c}},V.prototype.showScreenShareMaking=function(e,t){var i=t.chid,n=t.cancelCbk,a=t.media_id,o=t.ss_type;this.initiateHeadshot(i);t=this.states[i],o=o||(0==this.container.mediaUIHandler.getScreenShareType(i,a)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:j,url:L,chid:i,screen_share:{media_id:a,reject_cbk:n,status:"requested",type:o}}),this.__updateState(i)},V.prototype.makeScreenShareConnecting=function(e,t){var i=t.chid,n=t.muteCbk,a=t.rejectCbk,o=t.media_id,s=(t.name,t.ss_type);z[i]=N(i).attendername,this.initiateHeadshot(i);t=this.states[i],s=s||(0==this.container.mediaUIHandler.getScreenShareType(i,o)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:j,url:L,chid:i,screen_share:{media_id:o,mute_cbk:n,reject_cbk:a,status:"connecting",type:s}}),this.__updateState(i)},V.prototype.makeScreenShareConnected=function(e,t){var i=this,n=this.container.mediaUIHandler,a=t.media_id,o=t.chid,s=t.callEndCbk,r=t.ss_type;z[o]=N(o).attendername,this.initiateHeadshot(o);t=this.states[o],r=r||(0==n.getScreenShareType(o,a)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:j,url:L,screen_share:{reject_cbk:s,status:"connected",connected_time:(new Date).getTime(),type:r,media_id:a,swap_cbk:function(){return i.__swapScreen(n.getActiveMediaID(o),o)}}}),setTimeout(this.startTimer.bind(this,o,e),500),this.__updateState(o)},V.prototype.makeScreenShareReconnecting=function(e,t){this.__makeReconnecting(e,t)},V.prototype.makeScreenShareEnded=function(e,t){this.__ssTerminate(e,t,"ended")},V.prototype.makeScreenShareCancelled=function(e,t){this.__ssTerminate(e,t,"cancelled")},V.prototype.makeScreenShareRejected=function(e,t){this.__ssTerminate(e,t,"rejected")},V.prototype.makeScreenShareMissed=function(e,t){this.__ssTerminate(e,t,"missed")},V.prototype.MakeScreenShareFailed=function(e,t){this.__ssTerminate(e,t,"failed")},V.prototype.__ssTerminate=function(e,t,i){var n=this,a=t.chid,o=(t.media_id,this.states[a]);this.ss_invitation[a]&&(this.ss_invitation[a].rejectHandler(!1),delete this.ss_invitation[a]),o&&o.screen_share?(o&&o.screen_share&&!o.audio&&this.stopTimer(a,e),$.extend(!0,o,{screen_share:{status:i}}),setTimeout(function(){delete o.screen_share,n.__updateState(a),n.__checkAndDestroyInstance(a),n.deletePlayer(a)},500),this.__updateState(a)):o&&this.__checkAndDestroyInstance(a)},V.prototype.showDialog=function(){},V.prototype.enableOutingCallUI=function(){},V.prototype.handleActionHandler=function(e,t,i){i=this.states[e]&&this.states[e][t]&&this.states[e][t][i+"_cbk"];i&&i.call(this)},V.prototype.getTimeDiff=function(e){var t=(new Date).getTime()-e,e=(e=Math.floor(t%36e5/6e4))<10?"0"+e:e,t=(t=Math.floor(t%6e4/1e3))<10?"0"+t:t;return isFinite(e)&&isFinite(t)?e+":"+t:""},V.prototype.startTimer=function(t,e){var i,n=this;this.states[t].timer_ref||(i=this.states[t][e].connected_time,this.states[t].timer_ref=setInterval(function(){var e=n.states[t];$.extend(!0,e,{timer:n.getTimeDiff(i)}),n.__updateState(t)},1e3))},V.prototype.stopTimer=function(e){e=this.states[e];clearInterval(e.timer_ref),delete e.timer,this.__updateState(e.chid)},V.prototype.playSoundNotification=function(e,t){var i=this.container.constants.WAITING_TIME_SECS;this.container.mediaUIHandler.playNotifSound({type:t=void 0===t?"audiocall":t,duration:i,tone:e=void 0===e?"incomingcall":e})},V.prototype.stopSoundNotification=function(){this.container.mediaUIHandler.stopNotifSound()},V.prototype.__updateState=function(e){e=this.states[e];e&&[e.headshot,e.headshotInvite,e.player,e.directCallUI].forEach(function(e){e&&e.updateState()}),this.handleMinimizeState()},V.prototype.__swapScreen=function(t,e){var i=this.container.mediaUIHandler,n=(i.getEncryChid(e),N(e),function(e){"Escape"===e.key&&($(B()).find(".zsiq_media_popup").remove(),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t}))}),a=f(I("div",{class:"zsiq_media_popup"},I("span",null,LSResource.getRealValue("screenshare.swap.sharing")),I("div",{class:"zsiq_media_btn"},I("span",{onClick:function(){$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SWAP},mid:t}),i.swapScreenShare({chid:e,id:t}),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.continue")),I("span",{class:"zsiq_media_cancelbtn",onClick:function(){window.parent.removeEventListener("keydown",n),$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.cancel")))));$(B()).append(a),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t}),window.parent.addEventListener("keydown",n),window.parent.focus()},V.prototype.__makeReconnecting=function(e,t){var i=t.chid,t=t.media_id;this.states[i][e="viewing"==this.getCurrentScreenshareType(i)?"screen_share":e].status="reconnecting",this.__updateState(i);e="audio"==e?w.activity.MEDIA_AUDIO_RECONNECT_STATE:w.activity.MEDIA_SCREENSHARE_RECONNECT_STATE;this.container.mediaUIHandler.sendMediaActivity({param:{action_type:e},mid:t})},V.prototype.shareScreen=function(e,t,i){var n=this.container.mediaUIHandler,a=n.getMediaIdByChid(e),o=n.getCallStatusData(a);n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SHARESCREEN},mid:a}),o.connection_type==w.connectionType.PEER2PEER||n.isScreenConsentAllowed()||!n.isScreenRecordingEnabled()||"audio_call"==n.getMediaRecordingConsentDetails().type?n.addScreenShareTrack({chid:e,id:a}):n.showScreenShareConsentUI(a)},V.prototype.mediaPermissionUI=function(e){var t,i,n=(t=e,e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],i=f(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",id:"allowmicbannerui",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(i).remove()}},I("div",{class:"zsiq-cal-hnt-cont "+("Chrome"==e?"":"zsiq-"+e)},I("div",{class:"zsiq-trtp-anim"}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("span",{class:"zsiq-alw-mic siqico-mic"}),I("div",{class:"zsiq-alw-mic-desc",html:t?LSResource.getRealValue("voicenotes.info.pleaseallowmicrophone"):LSResource.getRealValue("av.info.pleaseallowmicrophone")})))));return $(B()).append(n),function(){return $(n).remove()}},V.prototype.mediaPermissionUnlock=function(e){var t,i,n,a=(t=e,i=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],n=f(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(n).remove()}},I("div",{class:"zsiq-cal-hnt-cont zsiq-isblk "+("Chrome"==i?"":"zsiq-"+i)},I("div",{class:"zsiq-trtp-anim "}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("div",{html:t?LSResource.getRealValue("voicenotes.info.pleasetaponlock","<em class='siqico-lock'></em>"):LSResource.getRealValue("av.info.pleasetaponlock","<em class='siqico-lock'></em>")}),I("p",null,"(",LSResource.getRealValue("common.or"),")"),I("div",null,LSResource.getRealValue("av.info.enablemicrophonesetting")),I("div",{class:"calndr-sedulbtn",style:"",onclick:k}," ",LSResource.getRealValue("chatwindow.mailcopy.clickhere")," ")))));$(B()).append(a),$(B()).find("#allowmicbannerui").remove();e=e?LSResource.getRealValue("voicenotes.info.microphone.blocked"):LSResource.getRealValue("av.info.microphone.blocked");return $UI.showBanner(e,!0,null,8e3),function(){return $(a).remove()}},V.prototype.handleCallClash=function(e,t){e()},V.prototype.handleMinimizeState=function(){var e=this.invitations,t=this.container.mediaUIHandler.getActiveCallData();e||t?($Support.getParent().$ZSIQWidgetUI.updateCallUI(),e?$Support.getParent().$ZSIQWidgetUI.updateIncomingCallUI():$Support.getParent().$ZSIQWidgetUI.removeIncomingCallUI()):$Support.getParent().$ZSIQWidgetUI.removeCallUI()},V.prototype.forceEndCall=function(){var e,t=this.container.mediaUIHandler;for(e in this.states)t.endCallByChid(e),t.triggerIconCheck(e)},V.prototype.implementRatingUI=function(e){var t,i,n=this.container.mediaUIHandler,i=(i=e,f(I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"posrel dib-mid"},I("div",{class:"cal-widgt theme1 outcal"},I("div",{class:"posrel usr-imginfo"},I("div",{class:"cal-visimg "},I("img",{src:(t=L)&&t(0,i),alt:"Operator"}))),I("div",{class:"cal-vstrdetl textC"},I("nav",{class:"cal-actvevstr elips font16"},LSResource.getRealValue("av.info.rating")),I("div",{class:"rating font18"},I("span",{class:"reaction_ico sad_icon","data-reaction":"sad",documentclick:"sendCallRating",title:LSResource.getRealValue("common.sad")}),I("span",{class:"reaction_ico neutral_icon","data-reaction":"neutral",documentclick:"sendCallRating",title:LSResource.getRealValue("common.neutral")}),I("span",{class:"reaction_ico happy_icon","data-reaction":"happy",documentclick:"sendCallRating",title:LSResource.getRealValue("common.happy")})),I("p",{class:"c777 font14"},LSResource.getRealValue("ne.rating.byline"))))))));CallImpl.isCallWithChat=n.getEncryChid(e),SiqAVRouter.chatwinobj=n.getChatWinObjById(e),n.getChatWinObjById(e).hideMaskDiv(),JSON.parse($Support.EmbedObj.eprops.reaction[0])?($("#audiorec,#audiocal").remove(),$("body").prepend(i)):this.implementRatingFdbkUI(SiqAVRouter.chatwinobj)},V.prototype.implementRatingFdbkUI=function(e){var t,i,n,a,t=(t=e,i=L,n=j,a=ZSIQConversationManager.getChatWinObjById(t.chatID).RCHID,e=$Support.isSignature($Support.EmbedObj),f(I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"adocal-cont dtfix "+q()+" cal-oflne",style:"height:354px;"},O(null,t),I("div",{class:"header"},e?"":I("div",{class:"actbtn"},I("em",{class:"sqico-min siq-minimize-icon",title:LSResource.getRealValue("ne.title.minimize"),documentclick:"min_iframe"})),I("div",{class:"posrel dib-mid"},I("div",{class:"cal-visimg sqico-user"},I("img",{src:i&&i(0,a),alt:n?n(a):"Operator"})),t.rating?I("em",{class:"reaction_ico "+t.rating+"_icon usr-rtng"}):""),I("div",null,I("div",{class:"cal-cmpname font20 fontB"},n(a)))),I("div",{class:"cal-bodycont posrel"},t.rating?I("div",{class:"ofln-msg mT5"}," ",$Support.getReactionIndex(t.rating)," "):""),I("div",{class:"cal-footer",style:"height:70px;"},I("textarea",{class:"bg-f6 font13 c333 lH20",dockeyup:"feedback",dockeydown:"textarea",id:"fdbkarea","data-validate":"required",placeholder:LSResource.getRealValue("av.info.fdkbckmsg"),autofocus:"",style:"overflow: hidden;"}),I("div",{class:"sqico-calsend fdbak-send msg-send",documentclick:"sendCallFb",title:LSResource.getRealValue("embed.submit")}))))));JSON.parse($Support.EmbedObj.eprops.feedback[0])?($($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handlefbCall(),$("#audiorec,#audiocal").remove(),$("body").prepend(t)):this.directCallCancelled()},V.prototype.implementFdbkSuccessUI=function(e){var t,i,n,a,t=(t=e,i=L,n=j,a=ZSIQConversationManager.getChatWinObjById(t.chatID).RCHID,e=$Support.isSignature($Support.EmbedObj),f(I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"adocal-cont dtfix "+q()+" cal-oflne"},O(null,t),I("div",{class:"header"},e?"":I("div",{class:"actbtn"},I("em",{class:"sqico-min siq-minimize-icon",title:LSResource.getRealValue("ne.title.minimize"),documentclick:"min_iframe"})),I("div",{class:"posrel dib-mid"},I("div",{class:"cal-visimg sqico-user"},I("img",{src:i&&i(0,a),alt:n?n(a):"Operator"})),t.rating?I("em",{class:"reaction_ico "+t.rating+"_icon usr-rtng",title:t.rating}):""),I("div",null,I("div",{class:"cal-cmpname font20 fontB"},n(a)))),I("div",{class:"cal-bodycont posrel"},I("div",{class:"ofln-msg mT5"},LSResource.getRealValue(t.rating?"av.info.ratingandfbk":"faq.feedback")),I("div",{class:"sqico-call bg-grn mT25 mA",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){return parent.$zohosq.call.start()}}))))));$Support.getParent().$ZSIQWidgetUI.handleMinCall(),$("#audiorec,#audiocal").remove(),$("body").prepend(t)},V.prototype.directCallCancelled=function(){$("#audiorec,#audiocal").remove(),$("body").prepend(CallUIHandler.getCallCancelledHtml()),$Support.isSignature($Support.EmbedObj)&&$("div.actbtn").remove(),$($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handleMinCall()},V.prototype.deleteScreenShareState=function(e){this.states[e]&&this.states[e].screen_share&&delete this.states[e].screen_share},V.prototype.deletePlayer=function(e){this.states[e]&&this.states[e].player&&(clearTimeout(this.states[e].player.showCntrlTimer),delete this.states[e].player)},V.prototype.clearAllStates=function(e){this.states[e]&&delete this.states[e]},V.prototype.getCurrentScreenshareType=function(e){e=this.states[e];return e&&e.screen_share&&e.screen_share.type?e.screen_share.type:null},V.prototype.getUIPosition=function(e){e=getComputedStyle(this.siqdom.querySelector(e));if(e)return{left:parseInt(e.getPropertyValue("left"))||0,top:parseInt(e.getPropertyValue("top"))||0,bottom:parseInt(e.getPropertyValue("bottom"))||0,right:parseInt(e.getPropertyValue("right"))||0,width:parseInt(e.getPropertyValue("width"))||0,height:parseInt(e.getPropertyValue("height"))||0}},V.prototype.showAudioConsent=function(e,t){var i=t.chid,n=t.rejectCbk,a=t.acceptCbk,t=this.states[i];$.extend(!0,t,{consent:{desc:this.__getConsentContent("audio"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:n,accept_cbk:a,type:w.audio}}),this.__updateState(i)},V.prototype.showScreenConsent=function(e,t){var i=t.chid,n=t.rejectCbk,a=t.acceptCbk,t=this.states[i];$.extend(!0,t,{consent:{desc:this.__getConsentContent("screen"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:n,accept_cbk:a,type:w.screen}}),this.__updateState(i)},V.prototype.__getConsentContent=function(e){var t=this.container.mediaUIHandler.getMediaRecordingConsentDetails(),t={audio_default:LSResource.getRealValue("av.info.audiorecordingconsent.defaultvalue"),screen_default:LSResource.getRealValue("av.info.screenrecordingconsent.defaultvalue"),audio:t&&t.call_consent_message,screen:t&&t.screenshare_consent_message};return t[e]||t[e+"_default"]},V.prototype.clearConsentState=function(e){delete this.states[e].consent,this.__updateState(e)};function W(e){this.container=e,this.ajax=new t}W.prototype.post=function(e,t,i,n,a,o,s){void 0===s&&(s="v2"),(a=void 0===a?!1:a)?this._postRequest(e,t,i,n,!0,s):this.request("POST",e,t,i,n)},W.prototype.get=function(e,t,i){this.request("GET",url,e,t,i)},W.prototype.request=function(e,t,i,n,a){t=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/v2/"+_SCREENNAME+"/"+t;try{$.ajax({url:t,type:e,data:i,success:n||function(){},error:a||function(){}})}catch(e){}},W.prototype._postRequest=function(e,t,i,n,a,o){e=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/"+o+"/"+_SCREENNAME+"/"+e;this.ajax.request({url:e,type:"POST",data:t,rest:a,success:i,error:n})},W.prototype.put=function(e,t,i,n,a,o){void 0===o&&(o="v2");e=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/"+o+"/"+_SCREENNAME+"/"+e;this.ajax.request({url:e,type:"PUT",data:t,rest:a,success:i,error:n})};function F(e){this.container=e,this.uiutil=$Support,this.isembed=!0,this.isoldUI=!1}F.prototype.isOldUI=function(){return this.isoldUI},F.prototype.handleEndSession=function(e,t){this.onGoingCallForChat(e)?this.container.commonImpl.endCallByChid(e,t):t()},F.prototype.onGoingCallForChat=function(e){var t=this.container.commonImpl,e=t.getMediaIdByChid(e);return!!v(e?t.getCallStatusData(e):{})},F.prototype.getEncryChid=function(e){return $Support.chidmappinglist[e]},F.prototype.isEmbed=function(){return this.isembed},F.prototype.getChatWinObjById=function(e,t){e=(t=void 0===t?!1:t)?e:this.getEncryChid(e);return ZSIQConversationManager.getChatWinObjById(e)},F.prototype.getSupportReps=function(e,t){e=(t=void 0===t?!1:t)?e:this.getEncryChid(e);return SUPPORT_REPS[e]||null},F.prototype.getSupportRepCount=function(e,t){t=this.getSupportReps(e,t=void 0===t?!1:t);return t&&Object.keys(t).length},F.prototype.isGroupConversation=function(e,t){void 0===t&&(t=!1);try{return 1<this.getSupportRepCount(e,t)}catch(e){return!1}},F.prototype.isAttenderBot=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).isBotChat},F.prototype.isChatExist=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).isAudioCallAllowed()},F.prototype.getAttenderId=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).attender},F.prototype.isProactiveChat=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).proactive},F.prototype.getCurrentUserId=function(){return null},F.prototype.playNotifSound=function(e){var t=e.tone,i=e.duration,n=e.chatid,e=e.isEncrypted,e=!n||this.getChatWinObjById(n,e);n&&e.isSoundOff()||EmbedSound.play(t,i)},F.prototype.stopNotifSound=function(){EmbedSound.stop()},F.prototype.initMissedChat=function(e,t,i,n){e=e?this.getChatWinObjById(e):ZSIQConversationManager.getcurrchatwinobj();delete $Support.requestRunning_missedvisitor,this.uiutil.handleMissed(t,i,n,e),this.uiutil.removeWtimeCookie(e.chatID),delete e.reopenwaiting,$Support.removeBroadCast()},F.prototype.clearChatWindow=function(){},F.prototype.clearPlayer=function(){var e=this.getBody().find(".zsiq_media_videomain");return 0<e.length&&(e.remove(),!0)},F.prototype.clearAudioUI=function(){var e=this.getBody().find(".zsiq_media_headshot_main");e&&e[0]&&"user_busy"!=e[0].id&&e.remove()},F.prototype.clearConformBox=function(){var e=this.getBody().find("#zsiqssconfirmbox");return 0<e.length&&(e.remove(),!0)},F.prototype.clearPopup=function(){var e=this.getBody().find(".zsiq_media_popup");return 0<e.length&&(e.remove(),!0)},F.prototype.clearBusyUI=function(){var e=this.getBody().find("#user_busy");return 0<e.length&&(e.remove(),!0)},F.prototype.getBody=function(){return $(parent.document.body)},F.prototype.triggerAudioCallIcon=function(e,t){var i=$("#audiocall");"show"==t?(this.showAudioCall(),i.removeClass("cmn_disable").show(),i.show().parent().addClass("rgt_ico")):"hide"==t?(this.hideAudioCall(),i.hide().parent().removeClass("rgt_ico")):"disable"==t&&(this.showAudioCall(),i.addClass("cmn_disable"))},F.prototype.showAudioCall=function(){$("#audiocall").show(),$(".callagain-txt").show()},F.prototype.hideAudioCall=function(){$("#audiocall").hide(),$(".callagain-txt").hide()},F.prototype.isAudioCallEnabled=function(){var e="true"==$Support.getParent().$ZSIQChat.getWidgetData().embedobj.isaudiocallallowed,t="true"==$Support.EmbedObj.eprops.isaudiocall;return e&&t&&!this.container.dataHandler.get("isBrandsDisabled")},F.prototype.isPlanAllowed=function(){return Licence.verify("audiocall")},F.prototype.isScreenShareAllowed=function(){return CommonUtil.isScreenshareEnabledFromPortal()&&$Support.EmbedObj.eprops.ischannelscreenshare&&Licence.verify("issiqscreenshare")},F.prototype.hasIncomingCall=function(e){var t=this.container,i=t.commonImpl,t=t.constants,e=i.getMediaIdByChid(e),e=e?i.getCallStatusData(e):{};return!(!v(e)||e.type!=t.audio||e.callType!=t.incoming||e.callStatus!=t.ringing)},F.prototype.isActiveBySSType=function(e){var t=this.container,i=t.commonImpl,n=t.constants,a={isActive:!1,id:null},t=i.getActiveCallData();if(!t)return a;if(t==e){t=i.getMediaIdByChid(t),i=t?i.getCallStatusData(t):{};if(v(i)&&i.type==n.screen_share)return a.isActive=!0,a.id=t,a}return a},F.prototype.isShareScreenAllowed=function(e){if(!this.container.commonImpl.currentUserBrowserSupportSS())return!1;var t=this.isActiveBySSType(e),i=t.isActive,t=t.id;return 0!=this.container.screen_shareImpl.getScreenShareType(e,t)||!i},F.prototype.checkIsSSOnGoing=function(e,t){var i=this.container.commonImpl.getActiveCallData();return!!i&&(i!=e||(t==w.screen_share?this.isShareScreenAllowed(e):t==w.screen_view?this.isRequestScreenShareAllowed(e):void 0))},F.prototype.isSecureConnection=function(){return-1<window.location.protocol.indexOf("https")||-1<window.location.protocol.indexOf("file:")},F.prototype.isAudioRecordingSupported=function(){return window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=this.container.MediaPermission.getUserMediaDetail(),window.AudioContext&&navigator.getUserMedia&&window.URL&&window.Worker||(support=!1),!0},F.prototype.closeViewMediaPermission=function(){$(window.parent.document).find("body").find(".zsiq_prv_main").remove()},F.prototype.isliveChatWindow=function(){return"msgarea"==$Support.container.attr("cwview")},F.prototype.isFaceBookIntegration=function(){return-1<window.location.href.lastIndexOf("facebook.ext")},F.prototype.getVisitorWMSID=function(){return this.uiutil.EmbedObj.vwmsid},F.prototype.getDecodedText=function(e){return"function"==typeof getDecodedText?getDecodedText(e):e},F.prototype.getEscapedText=function(e){return"function"==typeof getEscapedText?getEscapedText(e):e},F.prototype.getVisitorID=function(e){},F.prototype.getVisitorBrowser=function(e){},F.prototype.getVisitorPage=function(e){},F.prototype.isMobileVisitor=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent)},F.prototype.isIOSSDKVisitor=function(e){},F.prototype.isChatMonitor=function(e){return!1},F.prototype.getCurretUserLSUID=function(){},F.prototype.I18N=function(e){},F.prototype.getChatAttender=function(e){},F.prototype.isVisitorOnline=function(e){},F.prototype.isOngoingChat=function(e){return!1},F.prototype.checkBrowserSupported=function(e,t){},F.prototype.addVisitorDetail=function(e){},F.prototype.pickupsupport=function(e){},F.prototype.endSession=function(e){e=e?this.getChatWinObjById(e):ZSIQConversationManager.getcurrchatwinobj();$Support.quitChat(e)},F.prototype.getChatIdByVisitorId=function(e){},F.prototype.isScreenShareEnabled=function(){},F.prototype.sendDebugLogger=function(e){},F.prototype.removeAudioCallIcon=function(e){},F.prototype.isAllowedForCurrTab=function(e,t){},F.prototype.isVisitorBrowserSupported=function(e){},F.prototype.getVisitorOS=function(e){},F.prototype.triggerIconCheck=function(e){try{this.container.audioImpl.audioIconStatus(e,this.triggerAudioCallIcon.bind(this))}catch(e){}},F.prototype.focusChatWindow=function(e){},F.prototype.joinChat=function(e){},F.prototype.canShowAudioCallInvitation=function(e){return!0},F.prototype.endCall=function(e,t){this.container.commonImpl.endCallByChid(e,t)},F.prototype.isAudioCallDisabled=function(){return!1},F.prototype.handleCallInitiate=function(e){this.clearChatEndTimer(e),this.triggerRecorderIcon("disable")},F.prototype.handleCallEnded=function(e){this.triggerRecorderIcon("show")},F.prototype.handleCallCancelled=function(e){this.triggerRecorderIcon("show")},F.prototype.handleCallRejected=function(e){this.triggerRecorderIcon("show")},F.prototype.handleCallMissed=function(e){this.triggerRecorderIcon("show")},F.prototype.handleCallFailed=function(e){this.triggerRecorderIcon("show")},F.prototype.handleIncomingCall=function(e){this.clearChatEndTimer(e),this.triggerRecorderIcon("disable")},F.prototype.handleIncomingAccept=function(e){this.clearChatEndTimer(e)},F.prototype.handleOutgoingAccept=function(e){this.clearChatEndTimer(e)},F.prototype.isCallInitiatedFromOldUI=function(e){return this.container.commonImpl.getIsCallInitiatedFromOldUI(e)},F.prototype.isMobileOperator=function(e){return this.container.commonImpl.getIsMobileOperator(e)},F.prototype.checkIsChatEndTimerAlive=function(e){e=this.getChatWinObjById(e);return e&&e.endtimer},F.prototype.clearChatEndTimer=function(e){var t=this.getChatWinObjById(e.chid);this.checkIsChatEndTimerAlive(e.chid)&&($Support.clearEndTimer(t),this.stopNotifSound())},F.prototype.isTabFocused=function(){return parent.document.hasFocus()},F.prototype.getSessionID=function(){return LSMessanger.getSid()},F.prototype.getMediaActivityAddInfo=function(){return+this.isTabFocused()+" | "+this.getSessionID()},F.prototype.isMediaRecordingEnabledForChat=function(e){return $Support.EmbedObj.eprops.call_recording},F.prototype.removeAudioPlayers=function(){$(".siqmediaaudioplayer").remove()},F.prototype.isCurrentChatQueued=function(){var e=ZSIQConversationManager.getcurrchatwinobj();return!(!e||!e.queueTimer)},F.prototype.showEmbedBanner=function(e,t,i){var n=ZSIQConversationManager.getcurrchatwinobj();this.isEmbed()&&n&&n.RCHID==i&&$UI.showBanner(LSResource.getRealValue(e),!0,null,t)},F.prototype.triggerRecorderIcon=function(e){"show"==e?$(document).ready(function(){$('span[id="zsiq-voicenote"').removeClass("cmn_disable").show(),$('span[id="zsiq-voicenote"').removeAttr("disabled")}):"disable"==e&&$(document).ready(function(){$('span[id="zsiq-voicenote"').addClass("cmn_disable"),$('span[id="zsiq-voicenote"').attr("disabled","")})},F.prototype.isRecordingON=function(){return window.currentRecorder&&window.currentRecorder.isRecording()&&window.currentRecorder.isVoiceNote()},F.prototype.hasAudioCallInvitation=function(){var e=this.container.dataHandler;return e.data.media_inv&&e.data.media_inv.length||$Support.getParent().document.getElementById("zsiqssconfirmbox")||e.data.media_active},F.prototype.isChatLive=function(){return this.uiutil.isChatExist()},F.prototype.setValueInSession=function(e,t){this.uiutil.LSDB.storeInSession(e,t)},F.prototype.removeValueInSession=function(e){this.uiutil.LSDB.removeSessionStore(e)},F.prototype.getValueInSession=function(e){return this.uiutil.LSDB.getFromSession(e)},F.prototype.getAppName=function(){return this.uiutil.EmbedObj.embedname},F.prototype.getApiVisitorId=function(){return this.uiutil.getParent().$ZSIQUtil.getAPIVisitorID()},F.prototype.getAVUID=function(){return this.uiutil.getParent().$ZSIQUtil.getAvuid()},F.prototype.getMediaRecordingConsentDetails=function(){return this.uiutil.EmbedObj.call_recording},F.prototype.isScreenRecordingEnabled=function(){return this.uiutil.EmbedObj.screenRecordingEnabled||!1},F.prototype.isScreenRecordAllowed=function(){return this.getMediaRecordingConsentDetails().type==w.consent_audioandscreen},F.prototype.isAudioRecordAllowed=function(){return this.getMediaRecordingConsentDetails().type==w.consent_audioandscreen||this.getMediaRecordingConsentDetails().type==w.consent_onlyaudio},F.prototype.canShowOperatorImage=function(){return this.uiutil.EmbedObj.eprops.icphoto},F.prototype.isOnlyCallEnabled=function(){return this.uiutil.EmbedObj.onlyCallEnabled||!1};function G(e){this.container=e,this.init(e),this.data={}}G.prototype.init=function(e){this.audio_impl=e.audioImpl,this.audio_unified_mix_impl=e.audioImpl,this.video_impl=e.videoImpl,this.screen_share_impl=e.screenShareImpl,this.screen_view_impl=e.screen_viewImpl,this.screen_share_smart_impl=e.screen_viewImpl,this.screen_view_smart_impl=e.screenShareImpl,this.common_impl=e.commonImpl},G.prototype.handle=function(e){this.data=e.param,this.route()},G.prototype.route=function(){var e=this.container,t=e.constants,i=e.commonImpl,n=e.uiHandler,a=this.data.msg.media||this.data.msg,o=a.type,s=a.chatid,r=a.chid,e=a.id,a=(a.negotiationType,a.connection_type);s||(this.data.msg.chatid=s=s||r);r=i.getCallStatusData(e),a=a||r.connection_type,o=o||r.type;a&&(c=i.getTypeFromConnectionType(a,o),this.data.msg.media&&(this.data.msg.media.type=c),this.data.msg&&(this.data.msg.type=c),o=c);var a=this.data.msg,c=a.operation;a.cbtype;i.setWmsPushData(e,this.data.msg.media||this.data.msg),this.checkIsCurrentTab()||-1!=[t.call_initiate,t.call_cancel,t.call_miss,t.call_failed,"invite","initiate",t.cancel,t.reject,t.miss].indexOf(c)||-1!=["offer"].indexOf(c)&&"screen_share_smart"==o?d(c=(t=this.getController())&&t[this.getHandler()])&&(c.call(t,e),i.sendMediaStats(this.data,null)):(n.clearAudioCallInvite(o,e,s),this.container[o+"Impl"].clearData(e),Sound.stop())},G.prototype.checkIsCurrentTab=function(){return this.container.commonImpl.getActiveTab()},G.prototype.getController=function(){var e=this.container.constants,t=this.data.msg.media||this.data.msg,i=t.type,t=(t.chatid,t.id,t.negotiationType);return i==e.audio_unified_mix||i==e.audio_smart?i=e.audio:i!=e.screen_share_smart&&i!=e.screen_view_smart||(i=e.screen_share),this[(t||i)+"_impl"]},G.prototype.getHandler=function(){var e=this.data.msg.media||this.data.msg,t=e.id,i=e.connection_type,e=this.container.commonImpl,i=i;if("unified"==(i=i||e.getCallStatusData(t).connection_type)||"smart"==i){var n=this.getOperations();return this.__getConfOperationKeys()||n}e=this.getStatus(),t=this.getOperations(),i=this.getCBTypes(),n=this.__getP2POperation();return e||t||n||i},G.prototype.__getConfOperationKeys=function(){var e=this.container.constants,t=this.data.msg.operation;return{credential:"handleUnifiedCallCredentail",initiate:"handleInvitation",accept:"handleUnifiedCallAccept",reject:"handleCallReject",candidates:"handleCandidates",answer:"handleUnifiedCallAnswer",offer:"handleUnifiedCallOffer",cancel:"handleCallCancel",miss:"handleCallMissed",invite:e.handleInvitation,request:"handleCallRequest",answer_received:"handleCallAnswerReceived",connected:"handleUnifiedCallConnected",end:"handleUnifiedCallEnd"}[t]},G.prototype.__getP2POperation=function(){var e=this.container.constants,t=this.data.msg,t=(t.cbtype,t.statusType,t.operation);return{credential:e.setCredential,initiate:e.handleInvitation,accept:e.handleCallAccept,reject:e.handleCallReject,candidates:e.handleCandidates,answer:e.handleCallAnswer,end:e.handleCallEnd,offer:e.handleCallOffer,cancel:e.handleCallCancel,miss:e.handleCallMissed,invite:e.handleCallInvite,request:e.handleCallRequest,failed:e.handleCallFailed}[t]},G.prototype.getOperations=function(){var e=this.container.constants,t=this.data.msg,t=(t.cbtype,t.statusType,t.operation);return{call_credential:e.setCredential,call_initiate:e.handleInvitation,call_accept:e.handleCallAccept,call_reject:e.handleCallReject,call_candidates:e.handleCandidates,call_answer:e.handleCallAnswer,call_end:e.handleCallEnd,call_offer:e.handleCallOffer,call_cancel:e.handleCallCancel,call_miss:e.handleCallMissed,call_invite:e.handleCallInvite,call_request:e.handleCallRequest,call_failed:e.handleCallFailed}[t]},G.prototype.getCBTypes=function(){var e=this.container.constants,t=this.data.msg;t.cbtype,t.statusType,t.operation;return{credential:e.setCredential,invite:e.handleInvitation,reject:e.handleCallReject,candidate:e.handleCandidates,answer:e.handleCallAnswer,offer:e.handleCallOffer,cancel:e.handleCallCancel,miss:e.handleCallMissed,invite:e.handleCallInvite}},G.prototype.getStatus=function(){var e=this.container.constants,t=this.data.msg,i=(t.cbtype,t.statusType);t.operation;return{accept:e.handleCallAccept,end:e.handleCallEnd}[i]};function K(e){this.container=this.container}K.prototype.getEventsMap=function(){return{mute:"",end_media:"",sharescreen:"",shareaudio:"",stop_audio:"",stop_screenshare:""}};function Q(e){this.container=e,this.init(e)}Q.prototype.handle=function(){},Q.prototype.init=function(e){};function Z(e){this.conatiner=e}Z.prototype.handle=function(){};function X(e){((this.container=e).MediaPermission=this).isSupported=void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia,this.displayMediaSupported=this.isSupported&&navigator.mediaDevices.getDisplayMedia&&void 0!==navigator.mediaDevices.getDisplayMedia,this.init(),this.getmediaDevices(this.updateMediaDevices.bind(this),null)}X.prototype.init=function(){this.type={audio:"audio",video:"video",audio_video:"audio_video",screen:"screen_share"},this.streamType={audio:1,video:2,screen:3,audio_video:4},this.streamTypeInString={1:"audio",2:"video",3:"screen_share",4:"audio_video"},this.devicesType={audioInput:"audioinput",videoInput:"videoinput",audioOutput:"audiooutput"}},X.prototype.isDisplayMediaSupported=function(){return this.displayMediaSupported},X.prototype.updateMediaDevices=function(e){this.devicesArray=e;var t,i=[],n=[],a=[];for(t in this.devicesArray){var o=this.devicesArray[t];o.kind==this.devicesType.audioInput?i.push(o):o.kind==this.devicesType.videoInput?a.push(o):o.kind==this.devicesType.audioOutput&&n.push(o)}this.availableDevices={audioInput:i,videoInput:a,audioOutput:n}},X.prototype.getAvailableDevices=function(){return this.availableDevices},X.prototype.getmediaDevices=function(t,e){void 0!==navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(e){return t(e)})},X.prototype.updatePreferredDevice=function(e){this.preferredDevice||(this.preferredDevice={}),this.preferredDevice[e.kind]=e},X.prototype.updatePreferredDeviceByDeviceId=function(e,t){for(var i={},n=0;n<this.availableDevices[t].length;n++)this.availableDevices[t][n].deviceId==e&&(i=this.availableDevices[t][n]);this.updatePreferredDevice(i)},X.prototype.getPreferredDevice=function(e){return this.preferredDevice?this.preferredDevice[e]:null},X.prototype.getAudioInputDevices=function(){return this.availableDevices.audioInput},X.prototype.getVideoInputDevices=function(){return this.availableDevices.videoInput},X.prototype.getAudioOutputDevices=function(){return this.availableDevices.audioOutput},X.prototype.getMediaConstraints=function(e,t){var i={},n=!0,a=!0,o=this.getPreferredDevice(this.devicesType.audioInput),s=this.getPreferredDevice(this.devicesType.videoInput);return o&&(n={deviceId:{exact:o.deviceId}}),s&&(a={deviceId:{exact:s.deviceId}}),i=Object.assign({},{audio:n,video:a},t),e==this.type.audio?i.video=!1:e!=this.type.video&&e!=this.type.screen||(i.audio=!1),i},X.prototype.getDeskTopScreen=function(i,n,a,e,t,o){var s=this,r=this.container.constants;SalesIQDesktopIPC.getMediaInstance().getSources({types:[r.window,r.screen]}).then(function(e){for(var t in e)if(e[t].name===r.Entire_Screen)try{navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:r.desktop,chromeMediaSourceId:e[t].id}}}).then(function(e){s.streams[i]=e,typeof o!==r.function||(e=e._getPrimaryVideoTrack())&&(e.onended=o),n()})}catch(e){a(e,i)}})},X.prototype.requestStream=function(t,i,n,e,a,o){var s=this,r=null;this.streams?r=this.streams[t]:this.streams=[],r&&t!=this.type.screen?i():this.isDesktopApp()&&t==this.type.screen?this.getDeskTopScreen(t,i,n,e,a,o):(a=a?navigator.mediaDevices.getDisplayMedia:navigator.mediaDevices.getUserMedia,e=this.getMediaConstraints(t,e),a.call(navigator.mediaDevices,e).then(function(e){s.setType(e,t),s.streams[t]=e,"function"!=typeof o||(e=e._getPrimaryVideoTrack())&&(e.onended=o),i()}).catch(function(e){n(e,t)}))},X.prototype.getAudioStream=function(e,t,i,n){this.requestStream(this.type.audio,e,t,i,!1,n)},X.prototype.getVideoStream=function(e,t,i,n){this.requestStream(this.type.video,e,t,i,!1,n)},X.prototype.getScreenShareStream=function(e,t,i,n){this.displayMediaSupported?this.requestStream(this.type.screen,e,t,i,!0,n):(i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId}}},this.requestStream(this.type.screen,e,t,i,!1,n))},X.prototype.getStreamByType=function(e){return this.streams?this.streams[e]:null},X.prototype.getScreenSharePermissionWithAudio=function(){},X.prototype.getAudioPermission=function(e,t){this.getPermission(this.type.audio,e,t)},X.prototype.getVideoPermission=function(e,t){this.getPermission(this.type.video,e,t)},X.prototype.getPermission=function(e,t,i){navigator.permissions.query({name:e}).then(function(e){"function"==typeof t&&t(e.state)}).catch(function(e){"function"==typeof i&&i(e)})},X.prototype.setType=function(e,t){var i="";return(i=!e.salesiq?e.salesiq={}:i)._type=t,i},X.prototype.getTypeFromStream=function(e){return e&&e.salesiq&&e.salesiq._type?e.salesiq._type:null},X.prototype.closeAllStream=function(){for(var e in this.streams)this.closeStream(e)},X.prototype.closeStreamByType=function(e){this.closeStream(e)},X.prototype.closeStream=function(e){var t=this.streams?this.streams[e]:null;if(t){var i,n=t.getTracks();for(i in n)n[i].stop();this.streams[e]=null}},X.prototype.toggleMute=function(){var e=this.streams[this.type.audio];e.getAudioTracks()[0].enabled=!e.getAudioTracks()[0].enabled,this.container.commonImpl.sendMediaActivity({param:{action_type:e.getAudioTracks()[0].enabled?w.activity.MEDIA_AUDIO_UNMUTE:w.activity.MEDIA_AUDIO_MUTE}})},X.prototype.screenEndFromBrowserUI=function(e){this.isDesktopApp()||(this.streams[this.type.screen].getVideoTracks()[0].onended=function(){e()})},X.prototype.getUserMediaDetail=function(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null},X.prototype.getTracksId=function(){var e,t={};for(e in this.streams)t[e]=this.streams[e]&&this.streams[e].id;return t},X.prototype.isDesktopApp=function(){return navigator.userAgent.includes(this.container.constants.Zoho_SalesIQ)};function Y(e){this.container=e,this.userAgent=navigator.userAgent,this.browserName=null,this.browserVersion=null,this.browserSupported=!1,this.browserSupportedForStats=!1,(e.MediaDetails=this).platform=navigator.platform,this.setBrowserName()}Y.prototype.setBrowserName=function(){var e,t,i,n,t=(e=this.userAgent,t="unknown-unknown",-1<(n=(i=e).toLowerCase()).indexOf("msie")?t=(e=i.substring(i.indexOf("MSIE")).split(";")[0]).split(" ")[0].replace("MSIE","IE")+"-"+e.split(" ")[1]:-1<n.indexOf("edge")?t=i.substring(i.indexOf("Edge")).split(" ")[0].replace("/","-"):-1<n.indexOf("edg")?t=i.substring(i.indexOf("Edg")).split(" ")[0].replace("/","-").replace("Edg","Edge"):-1<n.indexOf("safari")&&-1<n.indexOf("version")?t=i.substring(i.indexOf("Safari")).split(" ")[0].split("/")[0]+"-"+i.substring(i.indexOf("Version")).split(" ")[0].split("/")[1]:-1<n.indexOf("opr")||-1<n.indexOf("opera")?-1<n.indexOf("opera")?t=i.substring(i.indexOf("Opera")).split(" ")[0].split("/")[0]+"-"+i.substring(i.indexOf("Version")).split(" ")[0].split("/")[1]:-1<n.indexOf("opr")&&(t=i.substring(i.indexOf("OPR")).split(" ")[0].replace("/","-").replace("OPR","Opera")):-1<n.indexOf("chrome")?t=i.substring(i.indexOf("Chrome")).split(" ")[0].replace("/","-"):-1<n.indexOf("firefox")&&(t=i.substring(i.indexOf("Firefox")).split(" ")[0].replace("/","-")),[t,parseInt(t.split("-")[1])]);this.browserName=t[0],this.browserVersion=t[1]},Y.prototype.getBrowserName=function(){return this.browserName},Y.prototype.getBrowserVersion=function(){return this.browserVersion},Y.prototype.checkBrowserSupported=function(e){var t=this.browserName.split("-")[0].toLowerCase();this.browserSupported=!1;e=!e||e==w.audio?w.audioCallAllowedBrowserVersions:w.screenShareAllowedBrowserVersions;return this.browserSupported=e[t]&&this.browserVersion>=e[t],this.browserSupported},Y.prototype.checkBrowserSupportedForStats=function(){var e=this.browserName.split("-")[0];return this.browserSupportedForStats=!1,"Chrome"!=e&&"Opera"!=e||(this.browserSupportedForStats=!0),this.browserSupportedForStats},Y.prototype.getPlatform=function(){return this.platform},Y.prototype.getClientSupport=function(){var e=this.container.MediaPermission,t={perfect_renegotiation:!0,multi_stream:!0,reconnection_policy:!0};return this.__isChrome()||this.__isSafari()||this.__isOpera()?e.displayMediaSupported||(t={perfect_renegotiation:!1,multi_stream:!1,reconnection_policy:!0}):this.__isFirefox()&&(t.perfect_renegotiation=!1),t},Y.prototype.__isChrome=function(){return"Chrome"==this.browserName.split("-")[0]},Y.prototype.__isFirefox=function(){return"Firefox"==this.browserName.split("-")[0]},Y.prototype.__isSafari=function(){return"Safari"==this.browserName.split("-")[0]},Y.prototype.__isOpera=function(){return"Opera"==this.browserName.split("-")[0]},Y.prototype.isNotebookDSKApp=function(){return this.userAgent.includes("Notebook")},Y.prototype.isSecure=function(){return-1<window.location.protocol.indexOf("https")};function J(e){this.data={},this.container=e,this.unique="SiqMedia_",e.dataHandler=this}J.prototype.get=function(e,t){this.getLocalKey(e);return this.data[e]},J.prototype.set=function(e,t,i){this.getLocalKey(e);this.data[e]=t},J.prototype.remove=function(e,t){this.getLocalKey(e);this.data[e]&&delete this.data[e]},J.prototype.getLocalKey=function(e){return this.unique+e};function ee(e){(e.router=this).container=e,this.init(e)}ee.prototype.init=function(e){this.rtc_router=new G(e),this.event_router=new K,this.media_router=new Q(e),this.action_router=new Z(e),this.MediaPermission=new X(e),this.dataHandler=new J(e),this.MediaDetails=new Y(e),this.container.constants=w},ee.prototype.route=function(e){if(!this.validateRouteObject(e))throw"Media Router Schema Mismatch";this.handle(e)},ee.prototype.handle=function(e){try{var t=this[e.type+"_router"];t&&t.handle&&t.handle(e)}catch(e){}},ee.prototype.validateRouteObject=function(t){var i={type:"string",useCase:"string",param:"object"},n=!0;return Object.keys(i).forEach(function(e){t[e]&&typeof t[e]==i[e]||(n=!1)}),n};function te(e){(e.LSRouter=this).container=e,this.init()}te.prototype.init=function(){var e=this,t=this;this.routes={0:function(){return e.container.checkDirectCallOnload()},2:t.handleCustomMessage(),29:t.handleAVcall.bind(t),13:t.handleUserStatus.bind(t),113:t.chatEnded.bind(t),35:t.chatEnded.bind(this),114:t.handleInfoMessage.bind(this),14:t.checkForCallIcon.bind(this),15:t.checkForCallIcon.bind(this)}},te.prototype.chatEnded=function(e){var t=e.msg.chid;this.container.detailsHandler.getBody().find(".zsiq_media_headshot_main").remove(),this.container.mediaUIHandler.clearAudioCallInvite(t),this.checkForCallIcon(e),this.container.detailsHandler.clearBusyUI(),"content_moderation_end"==e.msg.msg.action&&this.endSupport(e)},te.prototype.handleMessage=function(e){var t,i,n=this.routes,a=typeof n[e.mtype];try{"function"==a?n[e.mtype].call(this,e):"object"==a&&(t=this.getModuleName(e),"function"==typeof(i=n[e.mtype][t])&&i.call(this,e))}catch(e){}},te.prototype.handleCustomMessage=function(e){return{addvisitor:this.showInvitation,acctranschat:this.endCall,closetransfer:this.checkForCallIcon,pickupsupport:this.handlePicksupport,leavesupport:this.endSupport,missedvisitor:this.missedDirectCall,joinsupport:this.joinsupport}},te.prototype.handlePicksupport=function(e){var t=e.msg,i=LSMessanger.getPrd()+"_"+$Support.getParent().$ZSIQWidget.getEmbedObject().pinfo.soid+"_"+t.attender;try{for(var n in SUPPORT_REPS[t.chid])n!=i&&delete SUPPORT_REPS[t.chid][n]}catch(e){}this.checkForCallIcon(e)},te.prototype.handleAVcall=function(e){e.msg.msg=JSON.parse(e.msg.msg),e.msg.msg.media||this.handleCallConfernce(e)},te.prototype.handleCallConfernce=function(e){e.msg.msg;this.container.router.route({type:"rtc",module:e.msg.msg.type,useCase:e.msg.msg.operation,param:e.msg})},te.prototype.getModuleName=function(t){return{2:"msg > module",114:"msg > msg > mode",700:"msg > msg > module"}[t.mtype].trim().split(/\s*\>\s*/g).forEach(function(e){return t=t[e]}),t},te.prototype.showInvitation=function(e){try{var t=e.msg,i=t.media;if(!i)return;var n,a,o="";for(a in i)o=(n=JSON.parse(i[a])).type;this.container.commonImpl.setWmsPushData(n.id,t),this.container[o+"Impl"].handleApiCallInvitation(n.id)}catch(e){}},te.prototype.missedDirectCall=function(e){var t=this.container,i=t.detailsHandler,n=t.commonImpl,a=e.msg,o=a.media;if(o)for(var s in o){var r=JSON.parse(o[s]),c=r.type,s=r.id,r=i.getChatIdByVisitorId(a.visitorid);n.setWmsPushData(s,{chatid:r,id:s,type:c}),this.container[c+"Impl"].handleCallCancel(s)}},te.prototype.checkForCallIcon=function(e){var t=this.container,e=e.msg,e=e.chatid||e.chid;e==ZSIQConversationManager.getcurrchatwinobj().RCHID&&t.detailsHandler.triggerIconCheck(e),t.detailsHandler.isGroupConversation(e)&&this.container.detailsHandler.clearBusyUI()},te.prototype.endSupport=function(e){var t=this.container,i=t.detailsHandler,n=t.commonImpl,a=t.mediaUIHandler,o=t.MediaPermission,s=t.screenShareImpl,r=t.audioImpl,c=t.constants,d=e.msg,l=d.chatid||d.chid,t=n.getMediaIdByChid(l),e=t&&n.getCallStatusData(t);0<Object.keys(e).length&&(e={type:d=e.type,chid:l,media_id:t},n.setWmsPushData(t,{chatid:l,type:d}),a.updateCallInvitationState(d,e,c.ended),a.clearAudioCallInvite(d,t),s.handleAudioCallEnd(l),r.handleAudioCallEnd(t),this.container[d+"Impl"].clearData(t)),o.closeAllStream(),i.removeAudioCallIcon(l),n.stopNotificationSound(),n.checkAndPlayNotification()},te.prototype.disableAvIcons=function(){},te.prototype.endCall=function(e){try{var t=this.container,i=e.msg,n=i.chatid||i.chid;t.commonImpl.endCallByChid(n),this.checkForCallIcon(e)}catch(e){}},te.prototype.handleUserStatus=function(e){this.checkForCallIcon(e)},te.prototype.joinsupport=function(e){this.checkForCallIcon(e),this.container.commonImpl.checkOnGoingCall()},te.prototype.handleInfoMessage=function(e){this.checkForCallIcon(e),"acctranschat"==e.msg.module&&this.container.detailsHandler.clearBusyUI()};function ie(e){this.container=e}ie.prototype.handleAudioCallInvite=function(e,t){this.container.uiHandler.handleAudioCallInvite(e,t)},ie.prototype.handleAudioCallInitiate=function(e,t){this.container.uiHandler.handleAudioCallInitiate(e,t)},ie.prototype.clearAudioCallInvite=function(e,t){this.container.uiHandler.clearAudioCallInvite(e,t)},ie.prototype.updateCallInvitationState=function(e,t,i){this.container.uiHandler.updateCallInvitationState(e,t,i)},ie.prototype.mediaPermissionUI=function(e){return this.container.uiHandler.mediaPermissionUI(e)},ie.prototype.mediaPermissionUnlock=function(e){return this.container.uiHandler.mediaPermissionUnlock(e)},ie.prototype.showDialog=function(e){this.container.uiHandler.showDialog(e)},ie.prototype.handleCallClash=function(e,t){this.container.uiHandler.handleCallClash(e,t)},ie.prototype.deleteScreenShareState=function(e){this.container.uiHandler.deleteScreenShareState(e)},ie.prototype.showScreenShareInvitation=function(e){this.container.uiHandler.showScreenShareInvitation(e)},ie.prototype.makeScreenShareConnected=function(e,t){this.container.uiHandler.makeScreenShareConnected(e,t)},ie.prototype.makeScreenShareConnecting=function(e,t){this.container.uiHandler.makeScreenShareConnecting(e,t)},ie.prototype.showScreenShareMaking=function(e,t){this.container.uiHandler.showScreenShareMaking(e,t)},ie.prototype.playScreenShareStream=function(e){this.container.uiHandler.playScreenShareStream(e)},ie.prototype.getCurrentScreenshareType=function(e){return this.container.uiHandler.getCurrentScreenshareType(e)},ie.prototype.stopTimer=function(e){this.container.uiHandler.stopTimer(e)},ie.prototype.clearAllStates=function(e){this.container.uiHandler.clearAllStates(e)},ie.prototype.getUIState=function(){return this.container.uiHandler},ie.prototype.enableOutingCallUI=function(){this.container.uiHandler.enableOutingCallUI()},ie.prototype.deletePlayer=function(e){this.container.uiHandler.deletePlayer(e)},ie.prototype.directCallCancelled=function(){this.container.uiHandler.directCallCancelled()},ie.prototype.exitFullScreenMode=function(){this.container.uiHandler.exitFullScreenMode()},ie.prototype.getAvailableDevices=function(){return this.container.MediaPermission.getAvailableDevices()},ie.prototype.updateMediaDevices=function(e){this.container.MediaPermission.updateMediaDevices(e)},ie.prototype.startAudioCall=function(e){this.container.audioImpl.startAudioCall(e)},ie.prototype.__isSmartFlow=function(e){var t=this.container,i=t.commonImpl,e=(t.screen_share_smartImpl,t.audioImpl,i.getCallStatusData(e));return!(!e.type.includes("unified")&&!e.type.includes("smart"))},ie.prototype.initCallRequest=function(e){this.__isSmartFlow(e.mid)&&(e.negotiationType==w.screen_share&&(e.negotiationType=w.screen_share_smart),e.negotiationType==w.audio&&(e.negotiationType=w.audio_unified_mix)),this.container.audioImpl.initCallRequest(e)},ie.prototype.addScreenShareTrack=function(e){this.__isSmartFlow(e.id)?this.addScreenTrackInConference():this.container.audioImpl.addScreenShareTrack(e)},ie.prototype.addScreenTrackInConference=function(){this.container.screen_share_smartImpl.addScreenTrackInConference()},ie.prototype.getAudioInputDevice=function(){return this.container.audioImpl.getAudioInputDevice()},ie.prototype.getCurrentStreamDeviceId=function(){return this.container.audioImpl.getCurrentStreamDeviceId()},ie.prototype.getAudioOutputDevice=function(){return this.container.audioImpl.getAudioOutputDevice()},ie.prototype.changeAudioPlayer=function(e,t){var i=this.container.commonImpl.getActiveMediaID(t);this.__isSmartFlow(i)?this.container.audioImpl.changeUnifiedAudioPlayer(e,i):this.container.audioImpl.changeAudioPlayer(e,t)},ie.prototype.changeAudioInputDevice=function(e,t,i){var n=this.container.commonImpl.getActiveMediaID(t);this.__isSmartFlow(n)?this.container.audioImpl.changeUnifiedAudioInputDevice(e,n,i):this.container.audioImpl.changeAudioInputDevice(e,t,i)},ie.prototype.isWaitingForPermission=function(){return this.container.audioImpl.isWaitingForPermission},ie.prototype.getScreenShareType=function(e,t){return this.container.screenShareImpl.getScreenShareType(e,t)},ie.prototype.handleUIRequestCancel=function(e,t,i){this.container.screenShareImpl.handleUIRequestCancel(e,t,i)},ie.prototype.swapScreenShare=function(e){var t=this.container,i=t.commonImpl,t=t.screenShareImpl,i=i.getCallStatusData(e.id);i.type.includes("unified")||i.type.includes("smart")?t.swapUnifiedScreenShare(e):t.swapScreenShare(e)},ie.prototype.startScreenShare=function(e){this.container.screenShareImpl.startScreenShare(e)},ie.prototype.sendMediaActivity=function(e){this.container.commonImpl.sendMediaActivity(e)},ie.prototype.checkCallHostType=function(e){return this.container.commonImpl.checkCallHostType(e)},ie.prototype.getActiveTab=function(){return this.container.commonImpl.getActiveTab()},ie.prototype.getCallUIPosition=function(){return this.container.commonImpl.getCallUIPosition()},ie.prototype.setCallUIPosition=function(e,t){this.container.commonImpl.setCallUIPosition(e,t)},ie.prototype.removeCallUIPosition=function(){this.container.commonImpl.removeCallUIPosition()},ie.prototype.getActiveMediaID=function(e){return this.container.commonImpl.getActiveMediaID(e)},ie.prototype.getActiveCallData=function(){return this.container.commonImpl.getActiveCallData()},ie.prototype.endCallByChid=function(e){this.container.commonImpl.endCallByChid(e)},ie.prototype.isOldUI=function(){return this.container.detailsHandler.isOldUI()},ie.prototype.isEmbed=function(){return this.container.detailsHandler.isEmbed()},ie.prototype.isAudioCallEnabled=function(){return this.container.detailsHandler.isAudioCallEnabled()},ie.prototype.isScreenShareEnabled=function(){return this.container.detailsHandler.isScreenShareEnabled()},ie.prototype.isScreenShareAllowed=function(){return this.container.detailsHandler.isScreenShareAllowed()},ie.prototype.isCallInitiatedFromOldUI=function(e){return this.container.detailsHandler.isCallInitiatedFromOldUI(e)},ie.prototype.isMobileOperator=function(e){return this.container.detailsHandler.isMobileOperator(e)},ie.prototype.isMobileVisitor=function(e){return this.container.detailsHandler.isMobileVisitor(e)},ie.prototype.getChatWinObjById=function(e){return this.container.detailsHandler.getChatWinObjById(e)},ie.prototype.getDecodedText=function(e){return this.container.detailsHandler.getDecodedText(e)},ie.prototype.getEscapedText=function(e){return this.container.detailsHandler.getEscapedText(e)},ie.prototype.getBody=function(){return this.container.detailsHandler.getBody()},ie.prototype.getMediaActivityAddInfo=function(){return this.container.detailsHandler.getMediaActivityAddInfo()},ie.prototype.clearConformBox=function(){this.container.detailsHandler.clearConformBox()},ie.prototype.initMissedChat=function(e,t,i,n){this.container.detailsHandler.initMissedChat(e,t,i,n)},ie.prototype.isChatExist=function(e){return this.container.detailsHandler.isChatExist(e)},ie.prototype.getAttenderId=function(e){return this.container.detailsHandler.getAttenderId(e)},ie.prototype.getSupportRepCount=function(e){return this.container.detailsHandler.getSupportRepCount(e)},ie.prototype.playNotifSound=function(e){this.container.detailsHandler.playNotifSound(e)},ie.prototype.stopNotifSound=function(){this.container.detailsHandler.stopNotifSound()},ie.prototype.getEncryChid=function(e){return this.container.detailsHandler.getEncryChid(e)},ie.prototype.triggerIconCheck=function(e){this.container.detailsHandler.triggerIconCheck(e)},ie.prototype.getCurrentOpenChat=function(){return this.container.detailsHandler.getCurrentOpenChat()},ie.prototype.focusChatWindow=function(e){this.container.detailsHandler.focusChatWindow(e)},ie.prototype.focusCallWindow=function(e){this.container.detailsHandler.focusCallWindow(e)},ie.prototype.canShowAudioCallInvitation=function(e){return this.container.detailsHandler.canShowAudioCallInvitation(e)},ie.prototype.joinChat=function(e){this.container.detailsHandler.joinChat(e)},ie.prototype.getVisitorName=function(e){return this.container.detailsHandler.getVisitorName(e)},ie.prototype.getVisitorID=function(e){return this.container.detailsHandler.getVisitorID(e)},ie.prototype.onGoingMediaDetails=function(){return this.container.detailsHandler.onGoingMediaDetails()},ie.prototype.isMediaRecordingEnabledForChat=function(e){return this.container.detailsHandler.isMediaRecordingEnabledForChat(e)},ie.prototype.checkIsChatEndTimerAlive=function(e){return this.container.detailsHandler.checkIsChatEndTimerAlive(e)},ie.prototype.isRecordingON=function(){return this.container.detailsHandler.isRecordingON()},ie.prototype.isSecure=function(){return this.container.MediaDetails.isSecure()},ie.prototype.isVisitorSecure=function(e){return this.container.detailsHandler.isVisitorFromHttps(e)},ie.prototype.isSwapState=function(){return this.container.commonImpl.getSwapRequestCallbackState()},ie.prototype.getMediaIdByChid=function(e){return this.container.commonImpl.getMediaIdByChid(e)},ie.prototype.getCallStatusData=function(e){return this.container.commonImpl.getCallStatusData(e)},ie.prototype.openChatWindow=function(e,t){this.container.detailsHandler.openChatWindow(e,t)},ie.prototype.clearChatWindow=function(){return this.container.detailsHandler.clearChatWindow()},ie.prototype.isSSChatEnabled=function(){return this.container.detailsHandler.getIsSSChatEnabled()},ie.prototype.addFullScreenClass=function(){this.container.detailsHandler.addFullScreenClass()},ie.prototype.removeFullScreenClass=function(){this.container.detailsHandler.removeFullScreenClass()},ie.prototype.clearConsentUIState=function(e){this.container.uiHandler.clearConsentState(e)},ie.prototype.showScreenShareConsentUI=function(e){this.container.screenShareImpl.showConsentUI(e,!1)},ie.prototype.isScreenConsentAllowed=function(){return this.container.screenShareImpl.isConsentBannerAccepted()},ie.prototype.getMediaRecordingConsentDetails=function(){return this.container.detailsHandler.getMediaRecordingConsentDetails()},ie.prototype.isScreenRecordingEnabled=function(){return this.container.detailsHandler.isScreenRecordingEnabled()},ie.prototype.isScreenRecordAllowed=function(){return this.container.detailsHandler.isScreenRecordAllowed()},ie.prototype.canShowOperatorImage=function(){return this.container.detailsHandler.canShowOperatorImage()},ie.prototype.isOnlyCallConfEnabled=function(){return this.container.detailsHandler.isOnlyCallConfEnabled()},ie.prototype.endSession=function(e){this.container.detailsHandler.endSession(e)};u=function(){this.embed=SiqAVRouter.container.mediaUIHandler.isEmbed(),this.reRender()};u.prototype.updateState=function(e){e&&(this.state=e);try{this.reRender()}catch(e){}},u.prototype.reRender=function(){var e;this.dom&&1==this.dom.nodeType?this.dom=y(this.dom,this.render(),this.placeholder,this):(e=f(this.render(),this),this.dom&&$(this.dom).replaceWith(e),this.dom=e,this.embed?e&&e.className&&e.className.includes("zsiq_media_videomain")?e&&n(e,this.frameout):this.disableDrag||C(e,this.frameout):this.disableDrag||1!=e.nodeType||$(e).draggable({containment:"window",scroll:!1})),this.dom&&!this.dom.parentNode&&(this.placeholder_prepend?$(this.placeholder).prepend(this.dom):$(this.placeholder).append(this.dom))},u.prototype.destroy=function(){$(this.dom).remove()},u.prototype.getMediaCallUI=function(){try{var e,t=this.state,i=t.name,n=t.url,a=t.audio,o=t.chid,s=(t.timer,t.consent,t.screen_share);a&&(e=a.media_id),s&&(e=s.media_id);n&&n(e)?I("img",{src:n(e,o),alt:i?i(o):"Operator",draggable:"false"}):I("em",{class:"sqico-person"});var r=i(o);r&&r[0].toLowerCase(),this.container.commonImpl.isSmartFlow(e);return I("div",{class:"siqdc-home"},I("div",{class:"siqdc-homehdr"},i&&i(o)||""),I("p",{class:"siqdc-homedec"},a?ue(this.state,this.__getAudioCallStatusPriorityInSS()):pe(this.state,!1)),this.__getMediaUIBtns())}catch(e){console.log(e)}},u.prototype.__getMediaUIBtns=function(){var e,t,i=this,n=this.state,a=n.handler,o=(n.name,n.url,n.screen_share),s=n.audio,r=n.chid;s&&(e=s.status,v=s.media_id,t=s.mute),o&&(C=o.status,v=o.media_id);var c=this.container.mediaUIHandler,d=this.isInvited(e),l=this.isConnected(e),u=this.isRequested(e),p=this.isConnecting(e),h=[this.constants.rejected,this.constants.cancelled,this.constants.missed].includes(status),m=c.isScreenShareAllowed(),_=o&&this.isConnected(C),f=o&&(this.isConnected(C)?this.constants.stopsharing:this.constants.cancel),g=l?this.constants.end:this.constants.cancel,y=!c.isCallInitiatedFromOldUI(v)&&!c.isMobileOperator(v),n=!c.isMobileVisitor(r),C=c.isSecure(),c=this.container.mediaUIHandler.isCallInitiatedFromOldUI(v),v=this.container.mediaUIHandler.isAudioCallEnabled();return I("div",{class:"siqdc-icons"},l||u||p?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-"+(t?"sqico-muteaudio":"microphone")+" bg-aaa ",onclick:function(){return a(r,"audio","mute")}}),I("span",null,s&&de(t?"unmute":"mute"))):"",d?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-gbtn ",onclick:function(){return a(r,"audio","accept")}}),I("span",null,s&&de(this.constants.accept))):"",_&&!s&&v?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-gbtn ",onclick:this.__callCbk.bind(this)})," ",I("span",null,s&&de("call"))):"",s&&!h?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-rbtn ",onclick:function(){return a(r,"audio","reject")}}),I("span",null,s&&de(g))):"",!c&&s&&!o&&l&&m&&y&&n&&C?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-screenshare bg-grn",onclick:function(){return i.container.uiHandler.shareScreen(r)}}),I("span",null,de("screenshare"))):"",c||!o||!this.isSharing(o.type)||this.isRequested(e)||this.isInvited(e)?"":I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-ssend bg-red",onclick:function(){return a(r,"screen_share","reject")}}),I("span",null,de(f))))};var ne=function(a){function e(e,t,i,n){void 0===n&&(n=!1),this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.frameout=!0,this.screenShareAllowed=i.mediaUIHandler.isScreenShareAllowed(),this.isInviteOnly=n,this.isDummyImage=!0,a.call(this)}return a&&(e.__proto__=a),((e.prototype=Object.create(a&&a.prototype)).constructor=e).prototype.destroy=function(){this.ssTimer&&clearInterval(this.ssTimer),this.audioTimer&&clearInterval(this.audioTimer),$(this.dom).remove()},e.prototype.canStartSS=function(){return!this.state.screen_share},e.prototype.__callCbk=function(){ae(this.container,this.state.chid,this.embed)},e.prototype.getUI=function(){var e=this.state,t=e.audio,e=e.screen_share;return(!e||!this.isSharing(e.type)||this.isInviteOnly)&&(!t||e&&this.isViewing(e.type)&&(!this.isViewing(e.type)||this.isConnected(t.status)))?"":this.getMediaCallUI()},e.prototype.inviteCheck=function(){var e=this.state,t=e.screen_share,e=e.audio;return!this.isInviteOnly||t&&e&&this.isSharing(t.type)&&!this.isConnected(e.status)&&!this.isEnded(e.status)},e.prototype.render=function(){return!this.inviteCheck()||this.state.isDirectCall||document.querySelector("#call_Busy")?"":this.getUI()},e.prototype.__getAudioCallStatusPriorityInSS=function(){var e,t=this.state,i=t.screen_share,n=t.audio,t=t.timer;return n&&(e=n.status),!(t&&!i&&this.__isStatusNotConnected(e))&&!!(t&&!i||t&&!this.__isStatusNotConnected(e))},e.prototype.__isStatusNotConnected=function(e){return e!=this.constants.connected},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(u);function ae(e,t,i){void 0===i&&(i=!0);var n={type:e.constants.audio,mode:e.constants.visitor,mediarequest:!0,mediainvitation:!0},a=e.mediaUIHandler.getChatWinObjById(t);i?$.extend(n,{chatid:a.chatID,wmsid:$Support.EmbedObj.vwmsid,lsuid:a.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,normalchid:t,session_id:e.detailsHandler.getSessionID()}):$.extend(n,{chatid:t}),e.mediaUIHandler.startAudioCall(n)}var oe=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.showSSList=!1,this.showMoreOptions=!1,this.showSettings=!1,this.placeholder_prepend=!0,this.moreOptionsUIPosition={right:"0"},this.init(),n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.init=function(){this.fullscreen=!1,this.showcntrl=!1,this.frameout=!0,this.switchCbk=this.switchFullscreen.bind(this)},e.prototype.switchFullscreen=function(e){"keyup"==e.type&&"Escape"!=e.key||(this.fullscreen=!this.fullscreen,this.fullscreen?$Support.getParent().document.addEventListener(this.constants.keyup,this.switchCbk):$Support.getParent().document.removeEventListener(this.constants.keyup,this.switchCbk),this.reRender())},e.prototype.getAudioCallBox=function(){var e=this.state,t=e.audio,i=e.handler,n=e.chid,a=e.name,o=e.url,s=this.embed?"siqico":"sqico",e=t&&(this.isConnected(t.status)?this.constants.end:this.constants.cancel);return I("div",{class:"zsiq_calldtl"},I("span",null,o&&o(t.media_id)?I("img",{src:o(t.media_id,n),alt:a?a(n):"Operator",class:"siquserimg"}):I("em",{class:s+"-user"}),I("em",{class:"zsiq_caller txtelips"},a(n))),I("span",null,ue(this.state),t&&this.isConnected(t.status)?I("em",{title:de(t.mute?"unmute":"mute"),class:s+"-"+(t.mute?"unmute":"mute")+" zsiq_ctrlico",onClick:function(){return i(n,"audio","mute")},"data-type":"mic"}):"",t&&this.isInvited(t.status)?I("em",{title:de("accept"),class:s+"-end zsiq_vend zsiq_ctrlico zsiq_callin",onclick:function(){return i(n,"audio","accept")}}):"",I("em",{title:de(e),class:s+"-end zsiq_vend zsiq_ctrlico",onclick:function(){return i(n,"audio","reject")}}),I("em",null)))},e.prototype.showCntrl=function(){var e=this;this.showcntrl=!0,clearTimeout(this.showCntrlTimer),this.showCntrlTimer=setTimeout(function(){e.showcntrl=!1,e.reRender()},1500),this.__swapHandlerClickCbk(),this.reRender()},e.prototype.__swapHandlerClickCbk=function(){this.swapOptions&&($(this.swapOptions).remove(),this.swapOptions=null)},e.prototype.__swapHandler=function(e,n,t){function i(e,t,i){n(e,t,i),o()}var a=this,o=function(){return a.__swapHandlerClickCbk.call(a)};if(this.swapOptions)return o();this.swapOptions=f(I("div",{class:"zsiqcalloptions",id:"calloptions",style:"left:"+(e.clientX-220)+";top:"+(e.clientY-65)+";height:65px;z-index:11111111111;",onMouseLeave:this.__swapHandlerClickCbk.bind(this)},I("div",{onClick:function(){return i(t,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")),I("div",{onClick:function(){return i(t,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")))),this.placeholder.append(this.swapOptions)},e.prototype._SwapList=function(e,t,i){this.embed&&this.state.audio&&!this.fullscreen?this.__swapHandler(e,t,i):t(i,"screen_share","swap")},e.prototype.__showMoreOptions=function(){var e,t=this;this.showMoreOptions||(e=function(){t.showMoreOptions=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showMoreOptions=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showSettings=function(){var e,t=this;this.showSettings||(e=function(){t.showSettings=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSettings=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showDropDownList=function(){var e,t=this;this.getCallBarUIPosition(),this.showSSList||(e=function(){t.showSSList=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSSList=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.getCallBarUIPosition=function(){var e=this.container.uiHandler.getUIPosition(".zsiq_media_videomain");e.width<570&&e.left<100?this.moreOptionsUIPosition.right="auto":this.moreOptionsUIPosition.right="0"},e.prototype.__callCbk=function(){ae(this.container,this.state.chid,this.embed)},e.prototype.getScreenShareButtons=function(){var e,t,i=this.state,n=i.screen_share,a=i.audio,o=i.handler,s=i.chid,r=i.chatWinFocused;a&&(e=a.mute,t=a.status);var c=this.isConnected(t),d=n.status,l=n.type,u=this.isConnected(d),p=n&&(u?this.constants.stopsharing:this.constants.cancel),h=a&&(c?this.constants.end:this.constants.cancel),m=this.container.mediaUIHandler.isAudioCallEnabled(),i=a&&[this.constants.invited,this.constants.requested,this.constants.connecting,this.constants.cancelled,this.constants.rejected,this.constants.missed].includes(t),d=this.container.mediaUIHandler.isScreenShareAllowed();return I("div",{class:"zsiq_media_videofoot"},a||d?I("div",{class:"zsiq_media_posrel"},u&&!i?I("div",{class:"zsiqmico-more zsiq_media_wbtn",title:de("options"),onMouseUp:this.__showDropDownList.bind(this)}):"",I("div",{class:"zsiq_media_options",style:(this.showSSList?"display:block;":"display:none;")+" right : "+this.moreOptionsUIPosition.right+";"},d?I("div",{class:"zsiq_media_option_li",onclick:function(){return o(s,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")):"",a&&n&&this.isViewing(l)?I("div",{class:"zsiq_media_option_li zsiq_media_red",onclick:function(){return o(s,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")):"")):"",u&&i?I("div",{class:"zsiqmico-more zsiq_media_wbtn zsiq_media_disable"}):"",I("span",{class:"zsiqmico-chat zsiq_media_wbtn",style:"display:none;"}),this.embed&&a&&(c||this.isConnecting(t)||this.isRequested(t))&&!i?I("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn zsiq_media_mL13",title:de(e?"unmute":"mute"),onClick:function(){return o(s,"audio","mute")}}):"",(this.embed||this.fullscreen||!r)&&!a&&u&&m?I("span",{title:de("call"),class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",onclick:this.__callCbk.bind(this)}):"",this.embed&&a&&i?I("span",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13 zsiq_media_disable"}):"",this.embed&&a&&c?I("span",{title:de(h),class:"zsiqmico-endcall zsiq_media_rbtn zsiq_media_mL13",onclick:function(){return o(s,"audio","reject")}}):"",this.embed&&!a&&n&&this.isViewing(l)?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_mL13",title:de(p),onclick:function(){return o(s,"screen_share","reject")}}):"")},e.prototype.getUI=function(){var e=this,t=this.state,i=t.screen_share,n=t.timer,a=(t.chid,i?i.stream:""),t=this.container.mediaUIHandler.isScreenRecordAllowed()&&this.container.mediaUIHandler.isScreenRecordingEnabled()&&this.container.commonImpl.isSmartFlow(i.media_id);return a?I("div",{class:"zsiq_media_videomain "+(this.fullscreen?"zsiq-media-maxscreen":"zsiq-media-minscreen")+" "+(this.showcntrl||!n?"zsiq_showcntl":"")+" ",onMouseMove:this.showCntrl.bind(this),onMouseOver:this.showCntrl.bind(this),onMouseDown:this.__swapHandlerClickCbk.bind(this)},this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_left_corner",position:"top_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_border",position:"top_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_right_corner",position:"top_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_right_border",position:"right_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_right_corner",position:"bottom_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_border",position:"bottom_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_left_corner",position:"bottom_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_left_border",position:"left_border"}),I("div",{class:"zsiq_media_videohdr"},I("div",{class:"zsiq_media_videotime"},n&&t?I("em",{title:de("recording"),class:"zsiqmico-record zsiq_media_mR10",style:"cursor: pointer;"}):"",pe(this.state)),I("div",{class:"zsiq_media_videohdrico"},I("span",{class:"zsiqmico-settings",style:"display:none;"}),I("span",{class:this.fullscreen?"zsiqmico-minscreen":"zsiqmico-maxscreen",onclick:this.switchFullscreen.bind(this)}))),this.getScreenShareButtons(),I("div",null,I("video",{autoplay:!0,name:"media",srcObject:a,class:this.isReconnecting(i.status)?"zsiq_media_blur":"",onloadedmetadata:function(){return e.metadata=!0}})),"reconnecting"!=i.status&&this.metadata?"":I("div",{class:"zsiq_media_vloader"})):""},e.prototype.render=function(){var e=this.state,t=e.screen_share,e=e.audio;return t&&this.isViewing(t.type)&&!this.isRequested(t.status)||e&&this.isConnected(e.status)?this.getUI():""},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(u);function se(){var e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],t={Chrome:"https://support.google.com/chrome/answer/2693767?hl=en",Firefox:"https://support.mozilla.org/en-US/questions/1168156",Opera:"https://help.opera.com/en/latest/web-preferences/#microphone",Safari:"https://support.apple.com/en-in/guide/safari/websites-ibrwe2159f50/mac"};t[e]&&window.open(t[e],"_blank")}function re(i,n,a,o,s,r,c){function d(){$(e).remove()}var e,t=o(n),t=(t&&t[0].toLowerCase(),function(){var e=$(parent.document.body).find(".siq_media");window.currentRecorder&&window.currentRecorder.destroy();var t=Recorder();i.uiHandler.setCallUIposition("#user_busy"),s||(d(),e.append($Temp.getAudioRecordedUI(a(0,n),i.mediaUIHandler.getEscapedText(o(n)),r().top,r().left)),i.mediaUIHandler.removeCallUIPosition()),(window.currentRecorder=t).init(s,n,c)});e=s?($Support.EmbedObj.clogo,f(I("div",{class:"siqdc-home",id:"audiorec"},I("div",{class:"siqdc-homehdr"},$Support.EmbedObj.embedname||""),I("p",{class:"siqdc-homedec",id:"sqico-timer"},LSResource.getRealValue("av.info.oprbusy")),I("div",{class:"flexG w100",id:"sqico-canvas"}),I("div",{class:"siqdc-icons"},I("span",{class:"siqdc-iconsub",id:"startRecord"},I("em",{class:"sqico-muteaudio",onclick:t}),I("span",null,LSResource.getRealValue("av.info.voicemsg"))),I("span",{class:"siqdc-iconsub",cntrl:"recordAgain",style:"display:none"},I("em",{class:"sqico-muteaudio",cntrl:"recordAgain"}),I("span",null,LSResource.getRealValue("av.info.voicemsg"))),I("span",{class:"siqdc-iconsub",cntrl:"playRecord",style:"display:none"},I("em",{class:"sqico-play",cntrl:"playRecord"}),I("span",null," ",LSResource.getRealValue("av.info.play"))),I("span",{class:"siqdc-iconsub",cntrl:"pauseRecord",style:"display:none"},I("em",{class:"sqico-pause",cntrl:"pauseRecord"}),I("span",null," ",LSResource.getRealValue("av.info.pause"))),I("div",{class:"progress flexM",cntrl:"stopRecord",style:"display:none"},I("svg",{class:"progress-circle",width:"160px",height:"160px",xmlns:"http://www.w3.org/2000/svg"},I("circle",{class:"progress-circle-back",cx:"107",cy:"47",r:"44"}),I("circle",{class:"progress-circle-prog",cx:"107",cy:"47",r:"44"})),I("em",{class:"siqico-stop",cntrl:"stopRecord"}),I("span",null," ",LSResource.getRealValue("av.info.stop"))),I("span",{class:"siqdc-iconsub",cntrl:"uploadRecord",style:"display:none"},I("em",{class:"sqico-videosend",cntrl:"uploadRecord"}),I("span",null,LSResource.getRealValue("av.info.send"))))))):f(I("div",{class:"zsiq_media_headshot_main",id:"user_busy",style:"top:"+r().top+"px; left:"+r().left+"px;"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},I("span",{class:"zsiqmico-close",onclick:d,onMouseUp:function(){i.mediaUIHandler.removeCallUIPosition()}}),I("div",{class:"zsiq_media_userimg"},I("img",{src:a&&a(0,n),alt:o?o(n):"Operator",draggable:"false"})),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},o(n)),I("div",{class:"zsiq_media_elips"},LSResource.getRealValue("av.info.userbusy")),I("div",{class:"siq_media_btns siq_media_flexM"},I("div",{class:"zsiqmico-record zsiq_media_wbtn",title:LSResource.getRealValue("av.info.voicemessage"),onclick:t}),I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){i.mediaUIHandler.isRecordingON()||(d(),ae(i,n))}}))))))),s?(CallImpl.isCallWithChat=!0,document.querySelector(".onlycall_main").append(e)):(C(e,!0),$(parent.document.body).find(".siq_media").append(e))}var ce=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=this.container.constants,this.disableDrag=!0,this.placeholder_prepend=!0,n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.getAudioCallStatusText=function(){var e=this.state.audio.status,t=this.state.timer;return{timer:t,connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),initiated:LSResource.getRealValue("audiovideo.ringing"),mediapermission:LSResource.getRealValue("av.info.waitingformediapermission")}[t?"timer":e]||""},e.prototype.getUI=function(){var e=this,t=this.state,i=t.url,n=t.handler,a=t.name,o=t.chid,s=t.audio,r=t.screen_share,c=s&&s.status,d=(r&&r.status,-1==["initiated","requested"].indexOf(c)&&i&&i(s.media_id,o)||$Support.EmbedObj.clogo,"initiated"==c),l="mediapermission"==c,u=this.container.mediaUIHandler.isScreenShareAllowed(),t=this.container.mediaUIHandler.isCallInitiatedFromOldUI(s.media_id),i=r&&r.type==this.constants.viewing;return $Support.getParent().$zoho.salesiq.floatwindow.visible("show"),i&&($Support.getParent().$zoho.salesiq.floatwindow.visible("hide"),$Support.getParent().$zoho.salesiq.floatbutton.visible("hide")),I("div",{class:"siqdc-home"},I("div",{class:"siqdc-homehdr"},a&&a(o)||""),I("p",{class:"siqdc-homedec"},this.getAudioCallStatusText()),I("div",{class:"siqdc-icons"},I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-"+(s.mute?"sqico-muteaudio":"microphone")+" bg-aaa "+(l?"cmn_disable":""),onclick:function(){return l?"":n(o,"audio","mute")}}),I("span",null,s&&de(s.mute?"unmute":"mute"))),I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-rbtn "+(d||l?"cmn_disable":""),onclick:function(){return d||l?"":n(o,"audio","reject")}}),I("span",null,s&&de(c==this.constants.connected?"end":"cancel"))),!t&&s&&c==this.constants.connected&&u&&!r?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-screenshare bg-grn",onclick:function(){return e.container.uiHandler.shareScreen(o)}}),I("span",null,de("screenshare"))):"",!t&&r&&r.type==this.constants.sharing?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-ssend bg-red",onclick:function(){return n(o,"screen_share","reject")}}),I("span",null,de("stopsharing"))):""))},e.prototype.render=function(){var e=this.state,t=e.isDirectCall,i=e.audio;e.status;return t&&i?this.getUI():""},e}(u);function de(e){var t={mute:LSResource.getRealValue("av.info.mute"),unmute:LSResource.getRealValue("av.info.unmute"),end:LSResource.getRealValue("common.end"),reject:LSResource.getRealValue("common.reject"),screenshare:LSResource.getRealValue("common.screenshare"),swap:LSResource.getRealValue("av.info.swap"),call:LSResource.getRealValue("av.info.call"),cancel:LSResource.getRealValue("common.cancel"),accept:LSResource.getRealValue("common.accept"),stopsharing:LSResource.getRealValue("av.info.endscreen"),options:LSResource.getRealValue("av.info.options"),recording:LSResource.getRealValue("av.info.recording")};return t[e]||""}function le(e){try{var t=e.consent;return f(I("div",{class:"dc-ratingpop",id:"onlycallconsent"},I("div",null,t.desc),I("div",{class:"btndiv"},I("span",{class:"updatebtn",onclick:t.accept_cbk},t.type==w.screen?LSResource.getRealValue("common.share"):LSResource.getRealValue("common.gdpr.agent.accept")),I("span",{class:"c666 curP","data-type":"cancel",onclick:t.reject_cbk},LSResource.getRealValue("common.decline")))))}catch(e){}}function ue(e,t){void 0===t&&(t=!0);var i=e.audio.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("av.info.failed")}[e&&t?"timer":i]||""}function pe(e,t){void 0===t&&(t=!0);var i=e.screen_share.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue(t?"common.connected":"ss.info.viewing"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("screenshare.info.failed")}[e&&t?"timer":i]||""}function he(e){return SiqAVRouter.container.mediaUIHandler.getChatWinObjById(e)}function me(e,t){void 0===e&&(e=0);var i=SiqAVRouter.container.mediaUIHandler,t=he(t).attenderimagefkey,e=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t+"/photo.ls?mid="+e,i=i.canShowOperatorImage();return JSON.parse(i)&&t?e:$Support.EmbedObj.clogo}function _e(e){return SiqAVRouter.container.mediaUIHandler.getDecodedText(ye[e])||""}function fe(){return SiqAVRouter.container.mediaUIHandler.getCallUIPosition()}function ge(e){var t=this;this.container=e,this.invitations=null,this.ss_invitation={},this.states={},window.onbeforeunload=function(){if(e.commonImpl.updateMediaCache(w.siq_directcall,w.is_refreshed,!0),e.commonImpl.updateMediaCache(w.siq_unifiedMedia,w.is_refreshed,!0),Object.keys(t.states).length)return""},this.siqdom=document.createElement("div"),this.siqdom.setAttribute("class","siq_media"),this.siqdom.setAttribute("data-id","zsalesiq"),this.container.mediaUIHandler.getBody()[0].appendChild(this.siqdom)}var ye={};function Ce(){return SiqAVRouter.container.mediaUIHandler.isEmbed()?$(parent.document.body):$("body")}ge.prototype.initiateHeadshot=function(e,t){this.states[e]||(this.states[e]={chid:e,isDirectCall:t},this.states[e].headshot=new ne(this.states[e],document.querySelector(".onlycall_main"),this.container),this.states[e].directCallUI=new ce(this.states[e],document.querySelector(".onlycall_main"),this.container))},ge.prototype.__getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},ge.prototype.updateCallInvitationState=function(e,t,i){e=this.__getType(e);var n={audio:{connecting:this.makeAudioCallConnecting,connected:this.makeAudioCallConnected,ended:this.makeAudioCallEnded,cancelled:this.makeAudioCallCancelled,rejected:this.makeAudioCallRejected,missed:this.makeAudioCallMissed,reconnecting:this.makeAudioReconnecting,failed:this.makeAudioCallFailed,showConsent:this.showAudioConsent},screen_share:{connecting:this.makeScreenShareConnecting,connected:this.makeScreenShareConnected,ended:this.makeScreenShareEnded,cancelled:this.makeScreenShareCancelled,rejected:this.makeScreenShareRejected,missed:this.makeScreenShareMissed,reconnecting:this.makeScreenShareReconnecting,failed:this.MakeScreenShareFailed,showConsent:this.showScreenConsent}},i=n[e]&&n[e][i];try{i&&i.call(this,e,t)}catch(e){}},ge.prototype.playScreenShareStream=function(e){var t=e.stream,i=e.mid,n=(e.endCbk,e.chid),e=this.container.mediaUIHandler;this.initiateHeadshot(n);n=this.states[n];n.screen_share=n.screen_share||{},$.extend(!0,n,{screen_share:{stream:t,type:"viewing",status:"connected",media_id:i}});try{n.player||(n.player=new oe(n,this.siqdom,this.container),e.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_SHOWN,add_info:e.getMediaActivityAddInfo()},mid:i}))}catch(e){}},ge.prototype.handleAudioCallInvite=function(e,t){var i=this.container.mediaUIHandler;ye[t.chid]=he(t.chid)&&he(t.chid).attendername,"audio"==(e=this.__getType(e))?(this.showAudioCallInvitation(t),this.invitations=!0,i.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INVITATION_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t.media_id||t.id})):"screen_share"==e&&this.showScreenShareInvitation(t);t=parent.document.querySelector(".zsiqmico-close");t&&t.click()},ge.prototype.clearAudioCallInvite=function(e,t,i){var n=this.container.mediaUIHandler;try{n.isEmbed()&&n.clearConformBox()&&n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:t}),"audio"==e&&i&&this.__callTerminate(e,{chid:i,media_id:t,isDirectCall:!1},"rejected")}catch(e){}},ge.prototype.showAudioCallInvitation=function(e){var t=e.chid,i=e.rejectCbk,n=e.acceptCbk,a=e.media_id;this.initiateHeadshot(t);e=this.states[t];$.extend(!0,e,{handler:this.handleActionHandler.bind(this),name:_e,url:me,chid:t,audio:{mute:!1,media_id:a,reject_cbk:i,accept_cbk:n,is_invited:!0,status:"invited"}}),this.__updateState(t)},ge.prototype.handleAudioCallInitiate=function(e,t){var i=this,n=t.chid,a=t.cancelCbk,o=t.muteCbk,s=t.media_id,r=t.isDirectCall,c=this.container.mediaUIHandler;r?(this.states[n]=this.states.directcall,delete this.states.directcall):this.initiateHeadshot(n,r),ye[n]=he(n)&&he(n).attendername;var d=this.states[n],t=parent.document.querySelector(".zsiqmico-close");t&&t.click(),$.extend(!0,d,{handler:this.handleActionHandler.bind(this),name:_e,url:me,chid:n,audio:{mute:!!r&&d.audio.mute,media_id:s,reject_cbk:a,mute_cbk:function(){o(),$.extend(!0,d,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},is_invited:!1,status:"requested"}}),this.__updateState(n),c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s})},ge.prototype.initiateDirectCallUI=function(e){function t(){e(),$.extend(!0,o,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)}var i=this,n="directcall";if(e=void 0===e?null:e){var a=this.states[n];return $.extend(!0,a,{audio:{mute:!1,mute_cbk:t,status:"initiated"}}),void this.__updateState(n)}this.initiateHeadshot(n,!0);var o=this.states[n];$.extend(!0,o,{audio:{mute:!1,mute_cbk:t,status:"mediapermission"}}),this.__updateState(n)},ge.prototype.makeAudioCallConnecting=function(e,t){var i=this,n=t.chid,a=t.muteCbk,o=t.rejectCbk,s=t.media_id,r=(t.name,t.isDirectCall),c=this.container.mediaUIHandler,d=this.states[n];EmbedSound.stop(),ye[t.chid]=he(t.chid).attendername,$.extend(!0,d,{isDirectCall:r,audio:{mute_cbk:function(){a(),$.extend(!0,d,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},reject_cbk:o,status:"connecting"}}),this.__updateState(n),c.checkCallHostType({chid:n,mid:s,hostType:"downstream"})&&c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s}),r&&this.stopSoundNotification()},ge.prototype.makeAudioCallConnected=function(e,t){t.media_id;var i=t.chid,n=t.callEndCbk,a=t.isDirectCall,o=this.container.constants.connected;EmbedSound.stop(),this.initiateHeadshot(i),this.ss_invitation[i]&&delete this.ss_invitation[i];var s=this.states[i],t=s.audio.status==o?s.audio.connected_time:(new Date).getTime();$.extend(!0,s,{isDirectCall:a,audio:{reject_cbk:n,status:o,connected_time:t}}),setTimeout(this.startTimer.bind(this,i,e),500),this.__updateState(i)},ge.prototype.makeAudioReconnecting=function(e,t){this.__makeReconnecting(e,t)},ge.prototype.makeAudioCallEnded=function(e,t){this.__callTerminate(e,t,"ended")},ge.prototype.makeAudioCallCancelled=function(e,t){this.__callTerminate(e,t,"cancelled")},ge.prototype.makeAudioCallRejected=function(e,t){var i=t.isConsent||!1,n=this.states[t.chid],a=this.container.mediaUIHandler;n.isDirectCall&&(i?a.endSession(t.chid):a.initMissedChat(t.chid,"CALLENDED","2",!0)),this.__callTerminate(e,t,"rejected")},ge.prototype.makeAudioCallMissed=function(e,t){this.__callTerminate(e,t,"missed")},ge.prototype.makeAudioCallFailed=function(e,t){this.__callTerminate(e,t,"failed")},ge.prototype.__recordSound=function(e,t,i,n,a){var o=this,s=this.container.mediaUIHandler,r=s.isChatExist(e),c=s.getAttenderId(e),d=this.states&&this.states[e]&&this.states[e].screen_share&&"connected"==this.states[e].screen_share.status;(s.getSupportRepCount(e)<2&&r&&!d&&("rejected"==n&&c==i||"missed"==n)||t)&&(re(this.container,e,me,_e,t,fe,a),this.__updateState(e),$(".zsiq_media_headshot_main .zsiqmico-close").on("click",function(){return o.__updateState(e)}))},ge.prototype.__callTerminate=function(e,t,i){var n=this,a=t.chid,o=t.media_id,s=t.isDirectCall,r=t.lsuid,c=this.container.mediaUIHandler,d=this.states[a],l=d.audio.is_invited;c.checkIsChatEndTimerAlive(a)||c.stopNotifSound(),d&&d.audio?(this.invitations=l?null:this.invitations,$.extend(!0,d,{audio:{status:i}}),"rejected"!=i&&"missed"!=i||s||this.setCallUIposition(".zsiq_media_headshot_main"),setTimeout(function(){var e=d.isDirectCall;delete d.audio,n.__updateState(a),n.__checkAndDestroyInstance(a),l||-1==["rejected","missed"].indexOf(i)||n.__recordSound(a,e,r,i,o),e&&"ended"==i&&n.implementRatingUI(a),e&&"cancelled"==i&&n.directCallCancelled()},500),this.__updateState(a),t=c.checkCallHostType({chid:a,mid:o,hostType:"downstream"})&&["cancelled","rejected","missed"].includes(i)?w.activity.MEDIA_AUDIO_INVITATION_CLEARED:w.activity.MEDIA_AUDIO_UI_CLEARED,c.getActiveTab()&&c.sendMediaActivity({param:{action_type:t,add_info:c.getMediaActivityAddInfo()},mid:o}),s&&(this.stopSoundNotification(),clearTimeout(c.getChatWinObjById(a).waitTimer))):d&&this.__checkAndDestroyInstance(a)},ge.prototype.__checkAndDestroyInstance=function(e){try{var t=Object.keys(this.states[e]);0==["audio","screen_share"].filter(function(e){return-1!=t.indexOf(e)}).length&&(this.stopTimer(e),delete this.states[e])}catch(e){}},ge.prototype.setCallUIposition=function(e){var t=this.container.mediaUIHandler,i=$(Ce()).find(e);i[0]&&(e=getComputedStyle(i[0]),i=parseInt(e.getPropertyValue("left"))||0,e=parseInt(e.getPropertyValue("top"))||0,t.setCallUIPosition(e,i))},ge.prototype.showScreenShareInvitation=function(e){var t=e.chid,i=e.rejectCbk,n=e.acceptCbk,a=e.media_id,o=this.container.mediaUIHandler;this.initiateHeadshot(t);function s(){o.clearConformBox()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:a}),n()}function r(e){void 0===e&&(e=!0),o.clearConformBox()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:a}),e&&i()}var c,d,l,u,p,h;d=(c={name:_e,acceptHandler:s,rejectHandler:r,chid:t}).name,l=c.acceptHandler,u=c.rejectHandler,p=c.chid,e=(h=SiqAVRouter.container).mediaUIHandler,c=h.uiHandler,h=e.getMediaIdByChid(p),h=e.getCallStatusData(h),c=c.__getConsentContent("screen"),c=f(I("div",{class:"zsiq_popup",id:"zsiqssconfirmbox"},I("div",{class:"zsiq_popupsub"},I("div",{class:"zsiq_popup_child"},I("em",{class:"siqico-close zsiq_center",onClick:u}),I("em",{class:"siqico-screenshare zsiq_popuplogo"}),I("div",{class:"zsiq_popup_hdr"},LSResource.getRealValue("common.screensharerequest")),I("div",{class:"zsiq_popup_desc"},LSResource.getRealValue("screenshare.request.desc",d(p))),I("div",{class:"zsiq_popup_btn zsiq_center"},I("span",{class:"zsiq_center",id:"zsiqconfirmss",onClick:l},LSResource.getRealValue("common.share")),I("span",{class:"zsiq_center zsiq_cancelbtn",id:"zsiqdecliness",onClick:u},LSResource.getRealValue("common.decline")))),e.isScreenRecordingEnabled()&&e.isScreenRecordAllowed()&&!e.isScreenConsentAllowed()&&"smart"==h.connection_type?I("div",{class:"siq-note-cont"},I("div",{class:"siq-note-title"},LSResource.getRealValue("common.disclaimer")," "),I("p",{class:"siq-note-desc"},c," ")):""))),$(Ce()).append(c),o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN,add_info:o.getMediaActivityAddInfo()},mid:a}),this.ss_invitation[t]={rejectHandler:r,acceptHandler:s,media_id:a,template:c}},ge.prototype.showScreenShareMaking=function(e,t){var i=t.chid,n=t.cancelCbk,a=t.media_id,o=t.ss_type;this.initiateHeadshot(i);t=this.states[i],o=o||(0==this.container.mediaUIHandler.getScreenShareType(i,a)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:_e,url:me,chid:i,screen_share:{media_id:a,reject_cbk:n,status:"requested",type:o}}),this.__updateState(i)},ge.prototype.makeScreenShareConnecting=function(e,t){var i=t.chid,n=t.muteCbk,a=t.rejectCbk,o=t.media_id,s=(t.name,t.ss_type);ye[i]=he(i).attendername,this.initiateHeadshot(i);t=this.states[i],s=s||(0==this.container.mediaUIHandler.getScreenShareType(i,o)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:_e,url:me,chid:i,screen_share:{media_id:o,mute_cbk:n,reject_cbk:a,status:"connecting",type:s}}),this.__updateState(i)},ge.prototype.makeScreenShareConnected=function(e,t){var i=this,n=this.container.mediaUIHandler,a=t.media_id,o=t.chid,s=t.callEndCbk,r=t.ss_type;ye[o]=he(o).attendername,this.initiateHeadshot(o);t=this.states[o],r=r||(0==n.getScreenShareType(o,a)?"sharing":"viewing");$.extend(!0,t,{handler:this.handleActionHandler.bind(this),name:_e,url:me,screen_share:{reject_cbk:s,status:"connected",connected_time:(new Date).getTime(),type:r,media_id:a,swap_cbk:function(){return i.__swapScreen(n.getActiveMediaID(o),o)}}}),setTimeout(this.startTimer.bind(this,o,e),500),this.__updateState(o)},ge.prototype.makeScreenShareReconnecting=function(e,t){this.__makeReconnecting(e,t)},ge.prototype.makeScreenShareEnded=function(e,t){this.__ssTerminate(e,t,"ended")},ge.prototype.makeScreenShareCancelled=function(e,t){this.__ssTerminate(e,t,"cancelled")},ge.prototype.makeScreenShareRejected=function(e,t){this.__ssTerminate(e,t,"rejected")},ge.prototype.makeScreenShareMissed=function(e,t){this.__ssTerminate(e,t,"missed")},ge.prototype.MakeScreenShareFailed=function(e,t){this.__ssTerminate(e,t,"failed")},ge.prototype.__ssTerminate=function(e,t,i){var n=this,a=t.chid,o=(t.media_id,this.states[a]);this.ss_invitation[a]&&(this.ss_invitation[a].rejectHandler(!1),delete this.ss_invitation[a]),o&&o.screen_share?(o&&o.screen_share&&!o.audio&&this.stopTimer(a,e),$.extend(!0,o,{screen_share:{status:i}}),setTimeout(function(){delete o.screen_share,n.__updateState(a),n.__checkAndDestroyInstance(a),n.deletePlayer(a)},500),this.__updateState(a)):o&&this.__checkAndDestroyInstance(a)},ge.prototype.showDialog=function(){},ge.prototype.enableOutingCallUI=function(){},ge.prototype.handleActionHandler=function(e,t,i){i=this.states[e]&&this.states[e][t]&&this.states[e][t][i+"_cbk"];i&&i.call(this)},ge.prototype.getTimeDiff=function(e){var t=(new Date).getTime()-e,e=(e=Math.floor(t%36e5/6e4))<10?"0"+e:e,t=(t=Math.floor(t%6e4/1e3))<10?"0"+t:t;return isFinite(e)&&isFinite(t)?e+":"+t:""},ge.prototype.startTimer=function(t,e){var i,n=this;this.states[t].timer_ref||(i=this.states[t][e].connected_time,this.states[t].timer_ref=setInterval(function(){var e=n.states[t];$.extend(!0,e,{timer:n.getTimeDiff(i)}),n.__updateState(t)},1e3))},ge.prototype.stopTimer=function(e){e=this.states[e];clearInterval(e.timer_ref),delete e.timer,this.__updateState(e.chid)},ge.prototype.playSoundNotification=function(e,t){var i=this.container.constants.WAITING_TIME_SECS;this.container.mediaUIHandler.playNotifSound({type:t=void 0===t?"audiocall":t,duration:i,tone:e=void 0===e?"incomingcall":e})},ge.prototype.stopSoundNotification=function(){this.container.mediaUIHandler.stopNotifSound()},ge.prototype.__updateState=function(e){e=this.states[e];e&&[e.headshot,e.headshotInvite,e.player,e.directCallUI].forEach(function(e){e&&e.updateState()}),this.handleMinimizeState()},ge.prototype.__swapScreen=function(t,e){var i=this.container.mediaUIHandler,n=(i.getEncryChid(e),he(e),function(e){"Escape"===e.key&&($(Ce()).find(".zsiq_media_popup").remove(),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t}))}),a=f(I("div",{class:"zsiq_media_popup"},I("span",null,LSResource.getRealValue("screenshare.swap.sharing")),I("div",{class:"zsiq_media_btn"},I("span",{onClick:function(){$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SWAP},mid:t}),i.swapScreenShare({chid:e,id:t}),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.continue")),I("span",{class:"zsiq_media_cancelbtn",onClick:function(){window.parent.removeEventListener("keydown",n),$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.cancel")))));$(Ce()).append(a),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t}),window.parent.addEventListener("keydown",n),window.parent.focus()},ge.prototype.__makeReconnecting=function(e,t){var i=t.chid,t=t.media_id;this.states[i][e="viewing"==this.getCurrentScreenshareType(i)?"screen_share":e].status="reconnecting",this.__updateState(i);e="audio"==e?w.activity.MEDIA_AUDIO_RECONNECT_STATE:w.activity.MEDIA_SCREENSHARE_RECONNECT_STATE;this.container.mediaUIHandler.sendMediaActivity({param:{action_type:e},mid:t})},ge.prototype.shareScreen=function(e,t,i){var n=this.container.mediaUIHandler,a=n.getMediaIdByChid(e),o=n.getCallStatusData(a);n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SHARESCREEN},mid:a}),o.connection_type==w.connectionType.PEER2PEER||n.isScreenConsentAllowed()||!n.isScreenRecordingEnabled()||"audio_call"==n.getMediaRecordingConsentDetails().type?n.addScreenShareTrack({chid:e,id:a}):n.showScreenShareConsentUI(a)},ge.prototype.mediaPermissionUI=function(e){var t,i,n=(t=e,e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],i=f(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",id:"allowmicbannerui",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(i).remove()}},I("div",{class:"zsiq-cal-hnt-cont "+("Chrome"==e?"":"zsiq-"+e)},I("div",{class:"zsiq-trtp-anim"}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("span",{class:"zsiq-alw-mic siqico-mic"}),I("div",{class:"zsiq-alw-mic-desc",html:t?LSResource.getRealValue("voicenotes.info.pleaseallowmicrophone"):LSResource.getRealValue("av.info.pleaseallowmicrophone")})))));return $(Ce()).append(n),function(){return $(n).remove()}},ge.prototype.mediaPermissionUnlock=function(e){var t,i,n,a=(t=e,i=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],n=f(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(n).remove()}},I("div",{class:"zsiq-cal-hnt-cont zsiq-isblk "+("Chrome"==i?"":"zsiq-"+i)},I("div",{class:"zsiq-trtp-anim "}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("div",{html:t?LSResource.getRealValue("voicenotes.info.pleasetaponlock","<em class='siqico-lock'></em>"):LSResource.getRealValue("av.info.pleasetaponlock","<em class='siqico-lock'></em>")}),I("p",null,"(",LSResource.getRealValue("common.or"),")"),I("div",null,LSResource.getRealValue("av.info.enablemicrophonesetting")),I("div",{class:"calndr-sedulbtn",style:"",onclick:se}," ",LSResource.getRealValue("chatwindow.mailcopy.clickhere")," ")))));$(Ce()).append(a),$(Ce()).find("#allowmicbannerui").remove();e=e?LSResource.getRealValue("voicenotes.info.microphone.blocked"):LSResource.getRealValue("av.info.microphone.blocked");return $UI.showBanner(e,!0,null,8e3),function(){return $(a).remove()}},ge.prototype.handleCallClash=function(e,t){e()},ge.prototype.handleMinimizeState=function(){var e=this.invitations,t=this.container.mediaUIHandler.getActiveCallData();e||t?($Support.getParent().$ZSIQWidgetUI.updateCallUI(),e?$Support.getParent().$ZSIQWidgetUI.updateIncomingCallUI():$Support.getParent().$ZSIQWidgetUI.removeIncomingCallUI()):$Support.getParent().$ZSIQWidgetUI.removeCallUI()},ge.prototype.forceEndCall=function(){var e,t=this.container.mediaUIHandler;for(e in this.states)t.endCallByChid(e),t.triggerIconCheck(e)},ge.prototype.implementRatingUI=function(e){var t,i,n,a=this.container.mediaUIHandler,i=(i=e,n=f(I("div",{class:"siqdc-home"},I("div",{class:"siqdc-homehdr"},(t=_e)&&t(i)),I("p",{class:"siqdc-homedec"},LSResource.getRealValue("av.info.rating")),I("div",{class:"siqdc-icons dc-radin"},I("span",{class:"siqdc-iconsub"},I("em",{class:"reaction_ico sad_icon","data-reaction":"sad",documentclick:"sendCallRating"}),I("span",null,LSResource.getRealValue("common.sad"))),I("span",{class:"siqdc-iconsub"},I("em",{class:"reaction_ico neutral_icon","data-reaction":"neutral",documentclick:"sendCallRating"}),I("span",null,LSResource.getRealValue("common.neutral"))),I("span",{class:"siqdc-iconsub"},I("em",{class:"reaction_ico happy_icon","data-reaction":"happy",documentclick:"sendCallRating"}),I("span",null,LSResource.getRealValue("common.happy")))),I("span",{class:"dcskip flexC",onclick:function(){$(n).remove(),$Support.showCallList(),$("body").removeClass("onlycallview"),$Support.container.find("header").removeClass("siqdc-hdr")}},LSResource.getRealValue("common.skip")," ",I("em",{class:"sqico-skip flexM"})))));CallImpl.isCallWithChat=a.getEncryChid(e),SiqAVRouter.chatwinobj=a.getChatWinObjById(e),a.getChatWinObjById(e).hideMaskDiv(),JSON.parse($Support.EmbedObj.eprops.reaction[0])?document.querySelector(".onlycall_main").append(i):this.implementRatingFdbkUI(SiqAVRouter.chatwinobj)},ge.prototype.implementRatingFdbkUI=function(e){e=function(e){ZSIQConversationManager.getChatWinObjById(e.chatID).RCHID,$Support.isSignature($Support.EmbedObj);var t=f(I("div",{class:"siqdc-home"},I("div",{class:"dc-feedback"},I("div",{class:"flexC"},e.rating?I("span",{calss:"reaction_ico "+e.rating+"_icon"}):"",I("span",{class:"reaction_ico neutral_icon"}),I("span",null,"Feedback"),I("span",{class:"sqico-close flexM",onclick:function(){$(t).remove(),$Support.showCallList(),$("body").removeClass("onlycallview"),$Support.container.find("header").removeClass("siqdc-hdr")}})),I("input",{type:"text",dockeyup:"feedback",dockeydown:"textarea",id:"fdbkarea","data-validate":"required",placeholder:LSResource.getRealValue("av.info.fdkbckmsg"),autofocus:"",style:"overflow: hidden;"}),I("div",{class:"dcsave-btn flexM",documentclick:"sendCallFb"},LSResource.getRealValue("embed.submit")))));return t}(e);JSON.parse($Support.EmbedObj.eprops.feedback[0])?($(".siqdc-home").remove(),document.querySelector(".onlycall_main").append(e)):this.directCallCancelled()},ge.prototype.implementFdbkSuccessUI=function(e){$("body").removeClass("onlycallview"),$Support.container.find("header").removeClass("siqdc-hdr"),$(".siqdc-home").remove(),$Support.showCallList()},ge.prototype.directCallCancelled=function(){$("#audiorec,#audiocal").remove(),$("body").prepend(CallUIHandler.getCallCancelledHtml()),$Support.isSignature($Support.EmbedObj)&&$("div.actbtn").remove(),$($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handleMinCall()},ge.prototype.deleteScreenShareState=function(e){this.states[e]&&this.states[e].screen_share&&delete this.states[e].screen_share},ge.prototype.deletePlayer=function(e){this.states[e]&&this.states[e].player&&(clearTimeout(this.states[e].player.showCntrlTimer),delete this.states[e].player)},ge.prototype.clearAllStates=function(e){this.states[e]&&delete this.states[e]},ge.prototype.getCurrentScreenshareType=function(e){e=this.states[e];return e&&e.screen_share&&e.screen_share.type?e.screen_share.type:null},ge.prototype.getUIPosition=function(e){e=getComputedStyle(this.siqdom.querySelector(e));if(e)return{left:parseInt(e.getPropertyValue("left"))||0,top:parseInt(e.getPropertyValue("top"))||0,bottom:parseInt(e.getPropertyValue("bottom"))||0,right:parseInt(e.getPropertyValue("right"))||0,width:parseInt(e.getPropertyValue("width"))||0,height:parseInt(e.getPropertyValue("height"))||0}},ge.prototype.showAudioConsent=function(e,t){t.chid;var i=t.rejectCbk,t=t.acceptCbk,t={consent:{desc:this.__getConsentContent("audio"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:i,accept_cbk:t,type:w.audio}};$Support.container.find(".onlycall_main").append(le(t))},ge.prototype.showScreenConsent=function(e,t){var i=t.rejectCbk,t=t.acceptCbk;consent={desc:this.__getConsentContent("screen"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:i,accept_cbk:t,type:w.screen};t={consent:consent};$Support.container.find(".onlycall_main").append(le(t))},ge.prototype.__getConsentContent=function(e){var t=this.container.mediaUIHandler.getMediaRecordingConsentDetails(),t={audio_default:LSResource.getRealValue("av.info.audiorecordingconsent.defaultvalue"),screen_default:LSResource.getRealValue("av.info.screenrecordingconsent.defaultvalue"),audio:t&&t.call_consent_message,screen:t&&t.screenshare_consent_message};return t[e]||t[e+"_default"]},ge.prototype.clearConsentState=function(e){$("#onlycallconsent").remove()},$(document).ready(function(){var e,n={},t=$Support.getParent();(e=n).commonImpl=new _(e),e.audioImpl=new p(e),e.videoImpl=new m(e),e.screen_shareImpl=new h(e),n.ajaxHandler=new W(n),n.detailsHandler=new F(n),n.mediaUIHandler=new ie(n),n.detailsHandler.isOnlyCallEnabled()?n.uiHandler=new ge(n):n.uiHandler=new V(n),n.logger=LSDebugger.postDebugInfo,n.lsrouter=new te(n),window.SiqAVRouter=new ee(n),window.avUIhandler=n.uiHandler,n.commonImpl.checkOnGoingCall(),n.checkDirectCallOnload=function(){var e,t=n.commonImpl.getMediaCache(n.constants.siq_directcall);t&&t.is_refreshed&&(i=t.chid,e=t.media_id,t.type,"outgoing"==(t=t.status)?($Support.audioid=e,n.detailsHandler.initMissedChat(i,"CALLENDED","2",!0)):"connected"==t&&(n.audioImpl.endOngoingCall(i,e),n.detailsHandler.endSession(i)),n.commonImpl.removeMediaCache(n.constants.siq_directcall));var i=n.commonImpl.getMediaCache(n.constants.siq_unifiedMedia);i&&i.is_refreshed&&(n.commonImpl.handleMediaOnRefresh(i),n.commonImpl.removeMediaCache(n.constants.siq_unifiedMedia))},!n.detailsHandler.isChatLive()&&t.$zohosq.values.initiatecall&&t.$zohosq.call.start(),!n.detailsHandler.isChatLive()&&t.$zohosq.values.isDirectCall&&t.$zohosq.call.start(),t.$zohosq.values.isInitialLoad&&t.$zohosq.values.initialLoadData&&n.lsrouter.handleMessage(t.$zohosq.values.initialLoadData)})}();
