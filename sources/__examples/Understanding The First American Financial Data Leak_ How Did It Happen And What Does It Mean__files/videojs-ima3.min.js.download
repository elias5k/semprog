/*! @name @brightcove/videojs-ima3 @version 4.2.0 @license UNLICENSED */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["video.js","global/window","global/document"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).videojs,e.window,e.document)}(this,(function(e,t,a){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=n(e),r=n(t),o=n(a),d="6.9.0";var s=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},l=function(e,t,a){s(0,a),e.trigger({type:t+a.type,originalEvent:a})};function u(e){"playing"===e.type?function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&l(e,"content",t):l(e,"ad",t))}(this,e):"ended"===e.type?function(e,t){e.ads.isInAdMode()?e.ads.isContentResuming()?(s(0,t),e.trigger("resumeended")):l(e,"ad",t):e.ads._contentHasEnded||e.ads.stitchedAds()||(l(e,"content",t),e.trigger("readyforpostroll"))}(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())l(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;l(e,"content",t)}}(this,e):"play"===e.type?function(e,t){e.ads.inAdBreak()?l(e,"ad",t):e.ads.isContentResuming()&&l(e,"content",t)}(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?l(this,"content",e):l(this,"ad",e))}var c={},g=function(){!function(e){if(i.default.dom.isInFrame()&&"function"!=typeof r.default.__tcfapi){for(var t,a=r.default,n={};a;){try{if(a.frames.__tcfapiLocator){t=a;break}}catch(e){}if(a===r.default.top)break;a=a.parent}if(!t)return;r.default.__tcfapi=function(e,a,i,r){var o=Math.random()+"",d={__tcfapiCall:{command:e,parameter:r,version:a,callId:o}};n[o]=i,t.postMessage(d,"*")},r.default.addEventListener("message",(function(e){var t={};try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){}var a=t.__tcfapiReturn;a&&"function"==typeof n[a.callId]&&(n[a.callId](a.returnValue,a.success),n[a.callId]=null)}),!1)}}(),"function"==typeof r.default.__tcfapi&&r.default.__tcfapi("addEventListener",2,(function(e,t){t&&(c=e)}))},m=function(e,t){return t?encodeURIComponent(e):e},p=function(e,t,a){if(e&&e[a])for(var n=e[a],i=Object.keys(n),r=0;r<i.length;r++){t["{mediainfo."+a+"."+i[r]+"}"]=n[i[r]]}};function f(e,t,a){var n=this,d={};e=e.replace(/{([^}=]+)=([^}]+)}/g,(function(e,t,a){return d["{"+t+"}"]=a,"{"+t+"}"})),void 0===t&&(t=!1);var s={};for(var l in void 0!==a&&(s=a),s["{player.id}"]=this.options_["data-player"]||this.id_,s["{player.height}"]=this.currentHeight(),s["{player.width}"]=this.currentWidth(),s["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",s["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",s["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",s["{player.duration}"]=this.duration(),s["{player.pageUrl}"]=i.default.dom.isInFrame()?o.default.referrer:r.default.location.href,s["{playlistinfo.id}"]=this.playlistinfo?this.playlistinfo.id:"",s["{playlistinfo.name}"]=this.playlistinfo?this.playlistinfo.name:"",s["{timestamp}"]=(new Date).getTime(),s["{document.referrer}"]=o.default.referrer,s["{window.location.href}"]=r.default.location.href,s["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach((function(e){n.mediainfo&&n.mediainfo[e]?s["{mediainfo."+e+"}"]=n.mediainfo[e]:d["{mediainfo."+e+"}"]?s["{mediainfo."+e+"}"]=d["{mediainfo."+e+"}"]:s["{mediainfo."+e+"}"]=""})),p(this.mediainfo,s,"custom_fields"),p(this.mediainfo,s,"customFields"),Object.keys(c).forEach((function(e){s["{tcf."+e+"}"]=c[e]})),s["{tcf.gdprAppliesInt}"]=c.gdprApplies?1:0,s)e=e.split(l).join(m(s[l],t));for(var u in e=e.replace(/{pageVariable\.([^}]+)}/g,(function(e,a){for(var n,o=r.default,s=a.split("."),l=0;l<s.length;l++)l===s.length-1?n=o[s[l]]:o=o[s[l]];var u=typeof n;return null===n?"null":void 0===n?d["{pageVariable."+a+"}"]?d["{pageVariable."+a+"}"]:(i.default.log.warn('Page variable "'+a+'" not found'),""):"string"!==u&&"number"!==u&&"boolean"!==u?(i.default.log.warn('Page variable "'+a+'" is not a supported type'),""):m(String(n),t)})),d)e=e.replace(u,d[u]);return e}var h={processMetadataTracks:function(e,t){for(var a=e.textTracks(),n=function(a){"metadata"===a.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(a),t(e,a))},i=0;i<a.length;i++)n(a[i]);a.addEventListener("addtrack",(function(e){n(e.track)}))},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}},v=function(e,t){return void 0!==t&&e.ads.includedCues[t]},y=function(e,t){void 0!==t&&""!==t&&(e.ads.includedCues[t]=!0)};function A(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}h.processAdTrack=function(e,t,a,n){e.ads.includedCues={};for(var r=0;r<t.length;r++){var o=t[r],d=this.getSupportedAdCue(e,o);if(!this.isSupportedAdCue(e,o))return void i.default.log.warn("Skipping as this is not a supported ad cue.",o);var s=this.getCueId(e,o),l=o.startTime;if(v(e,s))return void i.default.log("Skipping ad already seen with ID "+s);n&&n(e,d,s,l),a(e,d,s,l),y(e,s)}};var C={},S=i.default;C.isMiddlewareMediatorSupported=function(){return!S.browser.IS_IOS&&!S.browser.IS_ANDROID&&!!(S.use&&S.middleware&&S.middleware.TERMINATOR)},C.playMiddleware=function(e){return{setSource:function(e,t){t(null,e)},callPlay:function(){if(e.ads&&!0===e.ads._shouldBlockPlay)return e.ads.debug("Using playMiddleware to block content playback"),e.ads._playBlocked=!0,S.middleware.TERMINATOR},play:function(t,a){e.ads&&e.ads._playBlocked&&t?(e.ads.debug("Play call to Tech was terminated."),e.trigger("play"),e.addClass("vjs-has-started"),e.ads._playBlocked=!1):a&&a.catch&&a.catch((function(t){"NotAllowedError"!==t.name||i.default.browser.IS_SAFARI||e.trigger("pause")}))}}},C.testHook=function(e){S=e};var _=C.playMiddleware,M=C.isMiddlewareMediatorSupported;var P=function(){function e(){}return e.getState=function(t){if(t)return e.states_&&e.states_[t]?e.states_[t]:void 0},e.registerState=function(t,a){if("string"!=typeof t||!t)throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.');return e.states_||(e.states_={}),e.states_[t]=a,a},e}(),b=function(){function e(e){this.player=e}e._getName=function(){return"Anonymous State"};var t=e.prototype;return t.transitionTo=function(e){var t=this.player;this.cleanup(t);var a=new e(t);t.ads._state=a,t.ads.debug(this.constructor._getName()+" -> "+a.constructor._getName());for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];a.init.apply(a,[t].concat(i))},t.init=function(){},t.cleanup=function(){},t.onPlay=function(){},t.onPlaying=function(){},t.onEnded=function(){},t.onAdEnded=function(){},t.onAdsReady=function(){i.default.log.warn("Unexpected adsready event")},t.onAdsError=function(){},t.onAdsCanceled=function(){},t.onAdTimeout=function(){},t.onAdStarted=function(){},t.onContentChanged=function(){},t.onContentResumed=function(){},t.onReadyForPostroll=function(){i.default.log.warn("Unexpected readyforpostroll event")},t.onNoPreroll=function(){},t.onNoPostroll=function(){},t.startLinearAdMode=function(){i.default.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.endLinearAdMode=function(){i.default.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.skipLinearAdMode=function(){i.default.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},t.isWaitingForAdBreak=function(){return!1},t.isContentResuming=function(){return!1},t.inAdBreak=function(){return!1},t.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e?this.onNoPostroll(t):"adended"===e&&this.onAdEnded(t)},e}();function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}P.registerState("State",b);var k=function(e){function t(t){var a;return(a=e.call(this,t)||this).contentResuming=!1,a.waitingForAdBreak=!1,a}R(t,e);var a=t.prototype;return a.isAdState=function(){return!0},a.onPlaying=function(){var e=P.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},a.onContentResumed=function(){var e=P.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},a.isWaitingForAdBreak=function(){return this.waitingForAdBreak},a.isContentResuming=function(){return this.contentResuming},a.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},t}(b);P.registerState("AdState",k);var T=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var a=t.prototype;return a.isAdState=function(){return!1},a.onContentChanged=function(e){var t=P.getState("BeforePreroll"),a=P.getState("Preroll");e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(t):(this.transitionTo(a,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(b);P.registerState("ContentState",T);var w,L=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"AdsDone"};var a=t.prototype;return a.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},a.startLinearAdMode=function(){i.default.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},t}(P.getState("ContentState"));P.registerState("AdsDone",L);var I={start:function(e){e.ads.debug("Starting ad break"),e.ads._inLinearAdMode=!0,e.trigger("adstart"),e.ads.shouldTakeSnapshots()&&(e.ads.snapshot=function(e){var t;t=i.default.browser.IS_IOS&&e.ads.isLive(e)&&e.seekable().length>0?e.currentTime()-e.seekable().end(0):e.currentTime();var a=e.$(".vjs-tech"),n=e.textTracks?e.textTracks():[],r=[],o={ended:e.ended(),currentSrc:e.currentSrc(),sources:e.currentSources(),src:e.tech_.src(),currentTime:t,type:e.currentType()};a&&(o.style=a.getAttribute("style"));for(var d=0;d<n.length;d++){var s=n[d];r.push({track:s,mode:s.mode}),s.mode="disabled"}return o.suppressedTracks=r,o}(e)),e.ads.shouldPlayContentBehindAd(e)&&(e.ads.preAdVolume_=e.volume(),e.volume(0)),e.addClass("vjs-ad-playing"),e.hasClass("vjs-live")&&e.removeClass("vjs-live"),e.ads.removeNativePoster()},end:function(e,t){e.ads.debug("Ending ad break"),void 0===t&&(t=function(){}),e.ads.adType=null,e.ads._inLinearAdMode=!1,e.trigger("adend"),e.removeClass("vjs-ad-playing"),e.ads.isLive(e)&&e.addClass("vjs-live"),e.ads.shouldTakeSnapshots()?function(e,t){var a=e.ads.snapshot;if(void 0===t&&(t=function(){}),!0===e.ads.disableNextSnapshotRestore)return e.ads.disableNextSnapshotRestore=!1,delete e.ads.snapshot,void t();var n,r=e.$(".vjs-tech"),o=20,d=a.suppressedTracks,s=function(){for(var e=0;e<d.length;e++)(n=d[e]).track.mode=n.mode},l=function(){var t;if(i.default.browser.IS_IOS&&e.ads.isLive(e)){if(a.currentTime<0&&(t=e.seekable().length>0?e.seekable().end(0)+a.currentTime:e.currentTime(),e.currentTime(t)),e.paused()){var n=e.play();n&&n.catch&&n.catch((function(e){i.default.log.warn("Play promise rejected in IOS snapshot resume",e)}))}}else if(a.ended)e.currentTime(e.duration());else{e.currentTime(a.currentTime);var r=e.play();r&&r.catch&&r.catch((function(e){i.default.log.warn("Play promise rejected in snapshot resume",e)}))}e.ads.shouldRemoveAutoplay_&&(e.autoplay(!1),e.ads.shouldRemoveAutoplay_=!1)},u=function t(){if(e.off("contentcanplay",t),w&&e.clearTimeout(w),(r=e.el().querySelector(".vjs-tech")).readyState>1)return l();if(void 0===r.seekable)return l();if(r.seekable.length>0)return l();if(o--)e.setTimeout(t,50);else try{l()}catch(e){i.default.log.warn("Failed to resume the content after an advertisement",e)}};if("style"in a&&r.setAttribute("style",a.style||""),e.ads.videoElementRecycled())e.one("resumeended",(function(){delete e.ads.snapshot,t()})),e.one("contentloadedmetadata",s),i.default.browser.IS_IOS&&!e.autoplay()&&(e.autoplay(!0),e.ads.shouldRemoveAutoplay_=!0),e.src(a.sources),e.one("contentcanplay",u),w=e.setTimeout(u,2e3);else{if(s(),!e.ended()){var c=e.play();c&&c.catch&&c.catch((function(e){i.default.log.warn("Play promise rejected in snapshot restore",e)}))}delete e.ads.snapshot,t()}}(e,t):(e.volume(e.ads.preAdVolume_),t())}},E=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"Preroll"};var a=t.prototype;return a.init=function(e,t,a){if(this.waitingForAdBreak=!0,e.addClass("vjs-ad-loading"),a||e.ads.nopreroll_)return this.resumeAfterNoPreroll(e);var n=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(n=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout((function(){e.trigger("adtimeout")}),n),t?this.handleAdsReady():this.adsReady=!1},a.onAdsReady=function(e){e.ads.inAdBreak()?i.default.log.warn("Unexpected adsready event (Preroll)"):(e.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},a.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},a.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",(function(){t.ads.debug("Received loadstart event"),e()})))},a.noPreroll=function(){var e=this;this.afterLoadStart((function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.resumeAfterNoPreroll(e.player)}))},a.readyForPreroll=function(){var e=this.player;this.afterLoadStart((function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")}))},a.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},a.onAdsError=function(e){var t=this;i.default.log("adserror (Preroll)"),this.inAdBreak()?e.ads.endLinearAdMode():this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},a.startLinearAdMode=function(){var e=this.player;!this.adsReady||e.ads.inAdBreak()||this.isContentResuming()?i.default.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(e),e.ads.adType="preroll",this.waitingForAdBreak=!1,I.start(e),e.ads._shouldBlockPlay=!1)},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,I.end(e))},a.skipLinearAdMode=function(){var e=this,t=this.player;t.ads.inAdBreak()||this.isContentResuming()?i.default.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart((function(){t.trigger("adskip"),t.ads.debug("skipLinearAdMode (Preroll)"),e.resumeAfterNoPreroll(t)}))},a.onAdTimeout=function(e){var t=this;this.afterLoadStart((function(){e.ads.debug("adtimeout (Preroll)"),t.resumeAfterNoPreroll(e)}))},a.onNoPreroll=function(e){e.ads.inAdBreak()||this.isContentResuming()?i.default.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},a.resumeAfterNoPreroll=function(e){if(this.contentResuming=!0,e.ads._shouldBlockPlay=!1,this.cleanupPartial(e),e.ads._playRequested||e.ads._pausedOnContentupdate)if(e.paused()){e.ads.debug("resumeAfterNoPreroll: attempting to resume playback (Preroll)");var t=e.play();t&&t.then&&t.then(null,(function(e){}))}else e.ads.debug("resumeAfterNoPreroll: already playing (Preroll)"),e.trigger("play"),e.trigger("playing")},a.cleanup=function(e){e.ads._hasThereBeenALoadStartDuringPlayerLife||i.default.log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(e)},a.cleanupPartial=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming"),this.clearTimeout(e)},a.clearTimeout=function(e){e.clearTimeout(this._timeout),this._timeout=null},t}(P.getState("AdState"));P.registerState("Preroll",E);var B=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"BeforePreroll"};var a=t.prototype;return a.init=function(e){this.adsReady=!1,this.shouldResumeToContent=!1,e.ads._shouldBlockPlay=!e.ads.settings.allowVjsAutoplay||!e.autoplay()},a.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},a.onPlay=function(e){var t=P.getState("Preroll");e.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(t,this.adsReady,this.shouldResumeToContent)},a.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},a.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},a.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},a.skipLinearAdMode=function(){var e=this.player;e.trigger("adskip"),e.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},a.onContentChanged=function(){this.init(this.player)},t}(P.getState("ContentState"));P.registerState("BeforePreroll",B);var q=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"Midroll"};var a=t.prototype;return a.init=function(e){e.ads.adType="midroll",I.start(e),e.addClass("vjs-ad-loading")},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,e.addClass("vjs-ad-content-resuming"),e.removeClass("vjs-ad-loading"),I.end(e))},a.onAdsError=function(e){this.inAdBreak()&&e.ads.endLinearAdMode()},a.cleanup=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming")},t}(P.getState("AdState"));P.registerState("Midroll",q);var D=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"Postroll"};var a=t.prototype;return a.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_){this.resumeContent(e);var t=P.getState("AdsDone");this.transitionTo(t)}else{e.addClass("vjs-ad-loading");var a=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(a=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout((function(){e.trigger("adtimeout")}),a)}},a.startLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?i.default.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(e.ads.adType="postroll",e.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,I.start(e))},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this,t=this.player,a=P.getState("AdsDone");this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),I.end(t,(function(){e.transitionTo(a)})))},a.skipLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?i.default.log.warn("Unexpected skipLinearAdMode invocation"):(e.ads.debug("Postroll abort (skipLinearAdMode)"),e.trigger("adskip"),this.abort(e))},a.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},a.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort(e)},a.onContentChanged=function(e){if(this.isContentResuming()){var t=P.getState("BeforePreroll");this.transitionTo(t)}else if(!this.inAdBreak()){var a=P.getState("Preroll");this.transitionTo(a)}},a.onNoPostroll=function(e){this.isContentResuming()||this.inAdBreak()?i.default.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(e)},a.resumeContent=function(e){this.contentResuming=!0,e.addClass("vjs-ad-content-resuming")},a.abort=function(e){var t=P.getState("AdsDone");this.resumeContent(e),e.removeClass("vjs-ad-loading"),this.transitionTo(t)},a.cleanup=function(e){e.removeClass("vjs-ad-content-resuming"),e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},t}(P.getState("AdState"));P.registerState("Postroll",D);var O=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"ContentPlayback"};var a=t.prototype;return a.init=function(e){e.ads._shouldBlockPlay=!1},a.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},a.onReadyForPostroll=function(e){var t=P.getState("Postroll");e.ads.debug("Received readyforpostroll event"),this.transitionTo(t)},a.startLinearAdMode=function(){var e=P.getState("Midroll");this.transitionTo(e)},t}(P.getState("ContentState"));P.registerState("ContentPlayback",O);var N=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"StitchedContentPlayback"};var a=t.prototype;return a.init=function(){this.player.ads._shouldBlockPlay=!1},a.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},a.startLinearAdMode=function(){var e=P.getState("StitchedAdRoll");this.transitionTo(e)},t}(P.getState("ContentState"));P.registerState("StitchedContentPlayback",N);var j=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t._getName=function(){return"StitchedAdRoll"};var a=t.prototype;return a.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",I.start(this.player)},a.onPlaying=function(){},a.onContentResumed=function(){},a.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},a.endLinearAdMode=function(){var e=P.getState("StitchedContentPlayback");I.end(this.player),this.transitionTo(e)},t}(P.getState("AdState"));P.registerState("StitchedAdRoll",j);var U=C.isMiddlewareMediatorSupported,V=i.default.getTech("Html5").Events,F={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0,allowVjsAutoplay:i.default.options.normalizeAutoplay||!1},x=function(e){var t=this,a=i.default.mergeOptions(F,e),n=[];V.concat(["firstplay","loadedalldata"]).forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),t.on(n,u),U()||function(e,t){t&&i.default.log("Using cancelContentPlay to block content playback"),e.on("play",A)}(t,a.debug),t.setTimeout((function(){t.ads._hasThereBeenALoadStartDuringPlayerLife||""===t.src()||i.default.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")}),5e3),t.on("ended",(function(){t.hasClass("vjs-has-started")||t.addClass("vjs-has-started")})),t.on("contenttimeupdate",(function(){t.removeClass("vjs-waiting")})),t.on(["addurationchange","adcanplay"],(function(){if(!t.ads.settings.stitchedAds&&!t.hasStarted()&&(!t.ads.snapshot||t.currentSrc()!==t.ads.snapshot.currentSrc)&&t.ads.inAdBreak()){var e=t.play();e&&e.catch&&e.catch((function(e){i.default.log.warn("Play promise rejected when playing ad",e)}))}})),t.on("nopreroll",(function(){t.ads.debug("Received nopreroll event"),t.ads.nopreroll_=!0})),t.on("nopostroll",(function(){t.ads.debug("Received nopostroll event"),t.ads.nopostroll_=!0})),t.on("playing",(function(){t.ads._cancelledPlay=!1,t.ads._pausedOnContentupdate=!1})),t.on("play",(function(){t.ads._playRequested=!0})),t.one("loadstart",(function(){t.ads._hasThereBeenALoadStartDuringPlayerLife=!0})),t.on("loadeddata",(function(){t.ads._hasThereBeenALoadedData=!0})),t.on("loadedmetadata",(function(){t.ads._hasThereBeenALoadedMetaData=!0})),t.ads=function(e){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:d,reset:function(){e.ads.disableNextSnapshotRestore=!1,e.ads._contentEnding=!1,e.ads._contentHasEnded=!1,e.ads.snapshot=null,e.ads.adType=null,e.ads._hasThereBeenALoadedData=!1,e.ads._hasThereBeenALoadedMetaData=!1,e.ads._cancelledPlay=!1,e.ads._shouldBlockPlay=!1,e.ads._playBlocked=!1,e.ads.nopreroll_=!1,e.ads.nopostroll_=!1,e.ads._playRequested=!1},startLinearAdMode:function(){e.ads._state.startLinearAdMode()},endLinearAdMode:function(){e.ads._state.endLinearAdMode()},skipLinearAdMode:function(){e.ads._state.skipLinearAdMode()},stitchedAds:function(e){return void 0!==e&&(i.default.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!e),this.settings.stitchedAds},videoElementRecycled:function(){if(e.ads.shouldPlayContentBehindAd(e))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var t=e.tech_.src()!==this.snapshot.src,a=e.currentSrc()!==this.snapshot.currentSrc;return t||a},isLive:function(t){return void 0===t&&(t=e),"boolean"==typeof t.ads.settings.contentIsLive?t.ads.settings.contentIsLive:t.duration()===1/0||"8"===i.default.browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){if(void 0===t&&(t=e),t)return!!t.ads.settings.liveCuePoints&&!i.default.browser.IS_IOS&&!i.default.browser.IS_ANDROID&&t.duration()===1/0;throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(t){return void 0===t&&(t=e),!this.shouldPlayContentBehindAd(t)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var t=e.$(".vjs-tech");t&&t.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];1===t.length&&"string"==typeof t[0]?i.default.log("ADS: "+t[0]):i.default.log.apply(i.default,["ADS:"].concat(t))}}}}(t),t.ads.settings=a,a.stitchedAds=!!a.stitchedAds,a.stitchedAds?t.ads._state=new(P.getState("StitchedContentPlayback"))(t):t.ads._state=new(P.getState("BeforePreroll"))(t),t.ads._state.init(t),t.ads.cueTextTracks=h,t.ads.adMacroReplacement=f.bind(t),function(e){e.ads.contentSrc=e.currentSrc(),e.ads._seenInitialLoadstart=!1,e.on("loadstart",(function(){if(!e.ads.inAdBreak()){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.ads._seenInitialLoadstart&&e.trigger({type:"contentchanged"}),e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t),e.ads._seenInitialLoadstart=!0}}))}(t),t.on("contentchanged",t.ads.reset);var r=function(){var e=t.textTracks();if(!t.ads.shouldPlayContentBehindAd(t)&&t.ads.inAdBreak()&&t.tech_.featuresNativeTextTracks&&i.default.browser.IS_IOS&&!Array.isArray(t.textTracks()))for(var a=0;a<e.length;a++){var n=e[a];"showing"===n.mode&&(n.mode="disabled")}};t.ready((function(){t.textTracks().addEventListener("change",r)})),t.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],(function(e){t.ads._state.handleEvent(e.type)})),t.on("dispose",(function(){t.ads.reset(),t.textTracks().removeEventListener("change",r)})),g(),t.ads.listenToTcf=g};x.VERSION=d,function(e){!function(){if(i.default.getPlugin)return Boolean(i.default.getPlugin("ads"));var e=i.default.getComponent("Player");return Boolean(e&&e.prototype.ads)}()&&((i.default.registerPlugin||i.default.plugin)("ads",e),M()&&!i.default.usingContribAdsMiddleware_&&(i.default.use("*",_),i.default.usingContribAdsMiddleware_=!0,i.default.log.debug("Play middleware has been registered with videojs")))}(x);var H,W="1.0.1";(i.default.registerPlugin||i.default.plugin)("contribAds6Shim",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,a=void 0,n=void 0,r=0,o=!1;this.contribAds6Shim={VERSION:W},t.ads.state=a=n="content-set",Object.defineProperty(t.ads,"state",{get:function(){return(!0===e.warnOnGetState||"number"==typeof e.warnOnGetState&&r<e.warnOnGetState)&&(i.default.log.warn("player.ads.state is deprecated. Please use the public methods provided by videojs-contrib-ads 6 instead: https://github.com/videojs/videojs-contrib-ads#public-methods"),r++),e.stateUsageEvent&&!o&&(t.trigger({type:"usage",name:"contrib-ads-state-access"}),o=!0),n},set:function(t){t!==n&&(a=n,n=t,e.debug&&i.default.log("CA6Shim: "+a+" -> "+n))}}),t.on("contentchanged",(function(){t.paused()?t.ads.state="content-set":t.ads.state="ads-ready?"})),t.on("play",(function(){"content-set"===n?t.ads.state="ads-ready?":"ads-ready"===n&&(t.ads.state="preroll?")})),t.on("adsready",(function(){"content-set"===n?t.ads.state="ads-ready":"ads-ready?"===n&&(t.ads.state="preroll?")})),t.on(["adserror","adtimeout","adskip"],(function(){"ads-ready?"!==n&&"preroll?"!==n||(t.ads.state="content-playback")})),t.on("adstart",(function(){t.ads.state="ad-playback"})),t.on("adend",(function(){t.ads.state="content-resuming"})),t.on("playing",(function(){"content-playback"!==n&&(t.trigger("contentplayback"),e.debug&&i.default.log("CA6Shim: Triggered contentplayback")),t.ads.state="content-playback"})),t.on("contentended",(function(){"content-playback"===n&&(t.ads.state="postroll?")})),t.on("ended",(function(){t.ads.state="content-playback"}))}));var z=function(e,t){var a=t.cues,n=t.label,i=t.inBandMetadataTrackDispatchType,r=t.kind;if("metadata"===r)return"media-cues"===n||(!(!i||"metadata"!==r)||(!a||!a.length||e.ima3.cueState_.cueModule.isSupportedAdCue(e,a[0])))},Q=function(e,t,a,n,i){0===n&&e.ima3.cueState_.prerollPlayed||i<=1&&e.ima3.cueState_.postrollPlayed||(!function(e,t,a){var n,i=Math.abs(a-e.duration()),r=Math.abs(a-e.currentTime());if(0===a){if(e.ima3.cueState_.prerollPlayed)return;e.ima3.cueState_.prerollPlayed=!0,e.ads.adType="preroll"}if(i<=1){if(e.ima3.cueState_.postrollPlayed)return;e.ima3.cueState_.postrollPlayed=!0}r>=1||(n=!e.ima3.settings.useMediaCuePoints&&t.serverUrl?t.serverUrl:e.ima3.settings.serverUrl,n=e.ima3.adMacroReplacement(n),t.duration&&(/\?/.test(n)?n+="&breaklength="+t.duration:n+="?breaklength="+t.duration),e.ima3.isReady_&&(e.ima3.log("Oncue ad request at "+a+" seconds"),e.ima3.adrequest(n)))}(e,t,n),e.ima3.cueState_.usedActiveCues[a]=!0)},G=function(e,t,a,n,i){0===n&&0===e.currentTime()&&(e.ima3.cueState_.prerollPlayed||e.ima3.cueState_.prerollHandledEarly||(e.paused()&&!e.ads._playRequested?(e.ima3.cueState_.prerollHandledEarly=!0,e.ima3.oneUnlessContentUpdate_("play",(function(){Q(e,t,a,n,i)}))):e.ads.isInAdMode()&&!e.ads.isContentResuming()&&e.ads._playRequested&&Q(e,t,a,n,i)))},J=function(e){return e.mediainfo?Math.max(e.duration(),e.mediainfo.duration):e.duration()},Y=function(e,t,a,n){var i,r=J(e),o=Math.abs(n-r);e.ads.isAdPlaying()&&((i=t)&&i.text&&"ad"===i.text.toLowerCase()||i&&i.name&&"adcue"===i.name.toLowerCase())||(a?e.ima3.cueState_.usedActiveCues[a]||t.name&&"adcancel"===t.name.toLowerCase()||(0===n?G(e,t,a,n,o):o<=1&&!e.ima3.cueState_.postrollHandled?(e.ima3.cueState_.postrollHandled=!0,e.ima3.oneUnlessContentUpdate_("contentended",(function(){Q(e,t,a,n,o)}))):e.ima3.isReady_&&!e.ads.isInAdMode()&&Q(e,t,a,n,o)):e.ima3.log.error("The cue does not have an ID and cannot be used",t))},X=function(e,t,a,n){e.ima3.settings.useMediaCuePoints||"adCancel"!==t.name||!e.ima3.adsManager||e.ima3.cueState_.usedActiveCues[a]||(e.ima3.cueState_.usedActiveCues[a]=!0,e.ima3.adsManager.stop(),e.ima3.log("Cancelling oncue ad at "+n+" seconds"))},$=function(e){return function(){var t=this.activeCues;if(!e.scrubbing()&&t&&t.length){var a=[t[t.length-1]];if(!z(e,this))return void this.removeEventListener("cuechange",e.ima3.cueState_.adCueChangeHandler);e.ima3.cueState_.cueModule.processAdTrack(e,a,Y,X)}}},K=function(e,t){var a,n,i=t.cues;if(z(e,t)){if(i&&void 0!==i.length){for(var r=0;r<i.length;r++){var o=e.mediainfo?Math.max(e.duration(),e.mediainfo.duration):e.duration();Math.abs(i[r].startTime-o)<=1?a=i[r]:0===i[r].startTime&&(n=i[r])}if(n||"media-cues"!==t.label){if(n){var d=e.ima3.cueState_.cueModule.getSupportedAdCue(e,n),s=e.ima3.cueState_.cueModule.getCueId(e,n),l=n.startTime,u=Math.abs(l-J(e));G(e,d,s,l,u)}}else e.trigger("nopreroll");a||"media-cues"!==t.label||e.trigger("nopostroll")}t.addEventListener("cuechange",e.ima3.cueState_.adCueChangeHandler)}},Z=H={init:function(e,t){t.useMediaCuePoints||e.on("loadedmetadata",(function(){e.trigger("nopreroll"),H.liveCuePointHandler(e,e.ads.cueTextTracks)})),e.trigger("adsready"),e.on("contentchanged",(function(){e.trigger("adsready")}))},liveCuePointHandler:function(e,t){!function(e,t){e.ima3.cueState_={cueModule:t,adCueChangeHandler:$(e),usedActiveCues:{},prerollHandledEarly:!1,prerollPlayed:!1,postrollHandled:!1,postrollPlayed:!1}}(e,t),e.ima3.cueState_.cueModule.setMetadataTrackMode=function(e){e.mode="hidden"},e.ima3.cueState_.cueModule.getCueId=function(e,t){var a=e.ima3.cueState_.cueModule.getSupportedAdCue(e,t);return a?a.id:null},e.ima3.cueState_.cueModule.isSupportedAdCue=function(e,t){return null!==e.ima3.cueState_.cueModule.getSupportedAdCue(e,t)},e.ima3.cueState_.cueModule.getSupportedAdCue=function(e,t){return"oncue"!==e.ima3.settings.requestMode||e.ima3.settings.useMediaCuePoints?null:function(e){var t;if(e&&!e.value||"TXXX"!==e.value.key)return null;try{t=JSON.parse(e.value.data)}catch(e){return i.default.log.error("ERROR: Parsing JSON. Please confirm that JSON is valid.",e.message),null}if(!t.name)return null;var a=t.name.toLowerCase();return"adcue"!==a&&"adcancel"!==a?null:t}(t)},e.ima3.cueState_.cueModule.processMetadataTracks(e,K)}};function ee(e){var t=!1,a=!1,n=null,r=null,o=function(){e.tech(!0).trigger("durationchange"),e.trigger("timeupdate"),e.trigger("progress")};e.on("ima3-started",(function(){e.removeClass("vjs-ima3-paused"),e.trigger("play"),t=!1,e.ads.inAdBreak()&&!e.ads.videoElementRecycled()&&(n=e.volume(),r=e.muted())})),e.on("ads-ad-started",(function(){a=!0,"boolean"==typeof r&&r?e.muted(r):"number"==typeof n&&e.volume(n),o()})),e.on("ima3-resumed",(function(){e.removeClass("vjs-ima3-paused"),e.trigger("play"),t=!1})),e.on("ima3-paused",(function(){e.addClass("vjs-ima3-paused"),e.trigger("pause"),t=!0})),e.on(["ima3-complete","ima3-content-resume-requested"],(function(){a=!1,o()}));var d=function(t){return function(n){return e.usingPlugin("ima3")&&e.ads.isAdPlaying()&&a?t(n):n}};return{currentTime:d((function(){var t=e.duration();if("number"!=typeof t||!e.ima3.adsManager)return 0;var a=e.ima3.adsManager.getRemainingTime();return"number"!=typeof a||a<=0||a>t?0:t-a})),duration:d((function(){var t=e.ima3.currentAd;if(!t)return 0;var a=t.getDuration();return a>0?a:0})),buffered:d((function(t){for(var a=[],n=e.duration(),r=0;r<t.length;r++){var o=t.start(r),d=t.end(r);o>n||(d>n?a.push([o,n]):a.push([o,d]))}return i.default.createTimeRanges(a)})),callPause:d((function(){return t=!0,e.ima3.adsManager.pause(),e.trigger("pause"),i.default.middleware.TERMINATOR})),paused:d((function(){return t})),callPlay:d((function(){return t=!1,e.ima3.adsManager.resume(),e.trigger("play"),i.default.middleware.TERMINATOR})),setVolume:d((function(t){return e.ima3.adsManager.setVolume(t),e.ima3.volume=t,e.trigger("volumechange"),t})),volume:d((function(){return e.ima3.adsManager.getVolume()||e.ima3.volume})),setMuted:d((function(t){return e.ima3.adsManager.setVolume(t?0:e.ima3.volume||1),t})),muted:d((function(){return 0===e.ima3.adsManager.getVolume()})),ended:d((function(){return!1}))}}function te(e){if("string"==typeof e){var t=e.match(/^([\d]+)\.([\d]+)\.([\d]+)/);if(t)return[Number(t[1]),Number(t[2]),Number(t[3])]}}var ae,ne=te("6.9.0");function ie(e){return i.default.getPlugin?i.default.getPlugin(e):i.default.getComponent("Player").prototype[e]}function re(e){return{width:parseInt(ae.computedStyle(e.el(),"width"),10),height:parseInt(ae.computedStyle(e.el(),"height"),10)}}function oe(e){if(+e<0)return i.default.log.error("duration "+e+" can't be a negative number"),"00:00:00.000";if(+e>=86400)return i.default.log.error("duration "+e+" can't be over 24h"),"00:00:00.000";var t=1e3*e,a=parseInt(t%1e3,10),n=parseInt(t/1e3%60,10),r=parseInt(t/6e4%60,10),o=parseInt(t/36e5%24,10);return a<10?a="00"+a:a<100&&(a="0"+a),(o=o<10?"0"+o:o)+":"+(r=r<10?"0"+r:r)+":"+(n=n<10?"0"+n:n)+"."+a}function de(e){e.ima3.adsManager&&(e.ima3.log("[util.destroyAdsManager] Call AdsManager.destroy."),e.ima3.adsManager.destroy(),e.ima3.adsManager=null),e.ima3.managerCleanup&&(e.ima3.managerCleanup(),e.ima3.managerCleanup=null)}function se(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)a.hasOwnProperty(n)&&(e[n]=a[n])}return e}var le,ue=function(e){if(void 0!==e)return"application/javascript"===e.getContentType();throw new Error("Cannot check if the current ad is a VPAID when there is no ad.")},ce=function(e){return!(!e||0!==e.getCuePoints().length)},ge=ae={computedStyle:function(e,t){return"function"==typeof getComputedStyle?r.default.getComputedStyle(e)[t]:e.currentStyle[t]},getPlayerDimensions:re,secondsToTime:oe,destroyAdsManager:de,extend:se,loadScript:function(e,t){var a=o.default.createElement("script"),n=o.default.querySelector("head");a.async=!0,a.charset="utf-8",a.src=e,a.onload=function(){return t(null)},a.onerror=function(e){t(e),a.parentNode.removeChild(a),a=null},n.insertBefore(a,n.firstChild)},isEconomicsFree:function(e){return"object"==typeof e.mediainfo&&"FREE"===e.mediainfo.economics},isVpaid:ue,isVast:ce,isVmap:function(e){return!(!e||0===e.getCuePoints().length)},includesPreroll:function(e){return ce(e)||e.getCuePoints().indexOf(0)>=0},includesPostroll:function(e){return e.getCuePoints().indexOf(-1)>=0},usingLiveAdCuepoints:function(e){return"oncue"===e.requestMode&&!e.useMediaCuePoints},usingMediaCuepoints:function(e){return"oncue"===e.requestMode&&e.useMediaCuePoints}},me=le={_addPlayerDimensions:function(e,t){(0,i.default.ima3.extend)(t,{linearAdSlotWidth:e.width,linearAdSlotHeight:e.height,nonLinearAdSlotWidth:e.width,nonLinearAdSlotHeight:e.height})},_addVmap:function(e,t,a){e.ima3.isReady_?t.adsResponse=a:e.ima3.oneUnlessContentUpdate_("ima3-ready",(function(){t.adsResponse=a}))},_adsRequest:function(e,t,a){var n=e.ima3.settings.requestMode,i=e.ima3.settings.useMediaCuePoints,o=r.default.google.ima;if(!o||o&&!o.AdsRequest)throw new Error("An ad request was made before the plugin is ready");e.ima3.log("[adsRequest] Create ima.AdsRequest.");var d=new o.AdsRequest;le._addPlayerDimensions(ge.getPlayerDimensions(e),d),"oncue"===n&&i&&a?le._addVmap(e,d,a):d.adTagUrl=t,e.ima3.adsRequest=d;var s=function(t){var a=!(!t||"autoplay-success"!==t.type);d.setAdWillAutoPlay(a),d.setAdWillPlayMuted(e.muted()),function(t){var a=e.ima3.settings.omidAccessModeRules||{};for(var n in t.omidAccessModeRules=e.ima3.adsRequest.omidAccessModeRules||{},a)t.omidAccessModeRules[o.OmidAccessMode[n]]=a[n].map((function(e){return new RegExp(e)}))}(d),e.trigger({type:"ads-before-request",adsRequest:d}),e.ima3.adsLoader.requestAds(d),e.trigger("ads-request")};e.ima3._contentchangedSeen?s({type:e.autoplay()?"autoplay-success":"autoplay-failure"}):!1===e.autoplay()?s():e.ima3._autoplayResultEvent?s(e.ima3._autoplayResultEvent):e.any(["autoplay-success","autoplay-failure"],s)},_handleEconomicsFree:function(e){e.trigger("nopreroll"),e.trigger("nopostroll")},_isRepeatForSourceAllowed:function(e){var t=e.ima3.settings.requestMode;return"onload"!==t&&"onplay"!==t},_isRepeatForSource:function(e){return e.ima3.lastSrc_===e.currentSrc()},_handleMissingAdTagUrl:function(e){e.trigger("adscanceled"),e.trigger("nopreroll"),e.trigger("nopostroll")},_afterServerUrlFunctionCheck:function(e,t,a){var n,i=e.ima3.settings.requestMode;null!=t&&(n=e.ima3.adMacroReplacement(t)),"oncue"===i||n?le._adsRequest(e,n,a):le._handleMissingAdTagUrl(e)},_handleServerUrlFunctionResponse:function(e,t){ge.isEconomicsFree(e)?le._handleEconomicsFree(e):le._afterServerUrlFunctionCheck(e,t)},_afterPlay:function(e,t,a){var n=e.ima3.settings.useMediaCuePoints;ge.isEconomicsFree(e)?le._handleEconomicsFree(e):(n||(t=t||e.ima3.settings.serverUrl),n||"function"!=typeof t?le._afterServerUrlFunctionCheck(e,t,a):t((function(t){le._handleServerUrlFunctionResponse(e,t)})))},_shouldWaitUntilPlay:function(e){var t=e.ima3.settings.requestMode,a=e.ima3.settings.useMediaCuePoints;return("onplay"===t||"oncue"===t&&a)&&!e.ima3._playSeen&&e.paused()&&!e.ads._pausedOnContentupdate},_waitUntilPlay:function(e,t,a){ge.isEconomicsFree(e)?le._handleEconomicsFree(e):(e.ima3._requestAdsOnPlay=function(){le._afterPlay(e,t,a)},e.one("play",e.ima3._requestAdsOnPlay))},requestAds:function(e,t,a){e.ima3.log("[requestAds] Beginning ad request process."),!le._isRepeatForSource(e)||le._isRepeatForSourceAllowed(e)?le._shouldWaitUntilPlay(e)?le._waitUntilPlay(e,t,a):le._afterPlay(e,t,a):e.ima3.log("Cancelling repeat adsRequest for "+e.currentSrc())}},pe=function(e){e.trigger("nopreroll"),e.trigger("nopostroll")},fe=function(e,t){t.ima3.isReady_?t.mediainfo&&"FREE"===t.mediainfo.economics?t.ima3.log("On demand adRequest attempted on video with advertising disabled."):e?(t.ima3.log("Clearing any previous VAST ad data and triggering ondemand adrequest."),t.ads.startLinearAdMode(),de(t),me.requestAds(t,e),t.addClass("ima3-ad-loading")):t.ima3.log("On demand adRequest attempted without an adTagUrl!"):t.ima3.log.error("Cannot make an ad request when the plugin is not ready. Skipping ad...")},he={0:"PREROLL","-1":"POSTROLL"},ve=function(e,t,a){""!==a&&(e.currentAdEventInfo[t]?e.currentAdEventInfo[t].push(a):e.currentAdEventInfo[t]=[a])},ye=function(e,t){void 0!==e.ima3.currentAd&&(e.ads.ad.id=e.ima3.currentAd.getAdId(),e.ads.ad.duration=e.ima3.currentAd.getDuration(),e.ads.ad.currentTime=e.ima3.adsManager?e.ima3.currentAd.getDuration()-e.ima3.adsManager.getRemainingTime():e.ima3.currentAd.getDuration(),e.ads.ad.timeOffset=e.ima3.currentAd.getAdPodInfo().getTimeOffset(),e.ads.ad.index=e.ima3.currentAd.getAdPodInfo().getAdPosition()-1,e.ads.ad.type=he[e.ima3.currentAd.getAdPodInfo().getTimeOffset()]||"MIDROLL",e.ads.pod.id=e.ima3.currentAd.getAdPodInfo().getPodIndex(),e.ads.pod.size=e.ima3.currentAd.getAdPodInfo().getTotalAds(),"ima3-started"===t&&(!function(e,t){if(void 0!==t){var a=e.ima3;a.currentAdEventInfo.adPodId=e.ads.pod.id,a.currentAdEventInfo.adPodLength=e.ads.pod.size,a.currentAdEventInfo.adType=e.ads.adType,ve(a,"adId",e.ads.ad.id),ve(a,"creativeLength",e.ads.ad.duration),ve(a,"creativeIndex",e.ads.ad.index),ve(a,"creativeId",t.getCreativeId()),ve(a,"creativeAdId",t.getCreativeAdId()),ve(a,"creativeFormat",t.getContentType()),ve(a,"creativeUrl",t.getMediaUrl()),ve(a,"surveyUrl",t.getSurveyUrl()),ve(a,"adTitle",t.getTitle()),ve(a,"wrapperCreativeIds",t.getWrapperCreativeIds()),ve(a,"advertiserName",t.getAdvertiserName()),ve(a,"dealId",t.getDealId()),ve(a,"adSystem",t.getAdSystem()),ve(a,"wrapperAdSystems",t.getWrapperAdSystems())}}(e,e.ima3.currentAd),ve(e.ima3,"started",e.ads.ad.index))),"ima3-complete"===t&&ve(e.ima3,"completed",e.ads.ad.index)},Ae=function(e,t,a){var n={},i=t||"";if(e.bcinfo&&(n["{player.url}"]=e.bcinfo.scriptUrl),a&&a.metadata&&-1!==t.indexOf("{mediainfo.ad_keys}")){var r=encodeURIComponent(a.metadata);i=t.replace("{mediainfo.ad_keys}",r)}return e.ads.adMacroReplacement(i,!0,n)},Ce="4.2.0";function Se(e){var t=e.mediainfo,a=e.ima3.settings.serverUrl;if(t&&"AD_SUPPORTED"===t.economics&&t.cuePoints.length>0){for(var n='<vmap:VMAP xmlns:vmap="http://www.iab.net/videosuite/vmap" version="1.0">\n',i=!1,r=0;r<t.cuePoints.length;r++)if("AD"===t.cuePoints[r].type){i=!0,t.cuePoints[r].time<1?n+='<vmap:AdBreak timeOffset="start" breakType="linear" breakId="'+t.cuePoints[r].name+'">\n':t.duration-t.cuePoints[r].time<1?n+='<vmap:AdBreak timeOffset="end" breakType="linear" breakId="'+t.cuePoints[r].name+'">\n':n+='<vmap:AdBreak timeOffset="'+oe(t.cuePoints[r].time)+'" breakType="linear" breakId="'+t.cuePoints[r].name+'">\n';var o=Ae(e,a,t.cuePoints[r]);n+=' <vmap:AdSource id="'+t.cuePoints[r].id+'" allowMultipleAds="true" followRedirects="true">\n<vmap:AdTagURI templateType="vast3">\n<![CDATA['+o+"]]>\n</vmap:AdTagURI>\n</vmap:AdSource>\n</vmap:AdBreak>\n"}return n+="</vmap:VMAP>",i||(n=null),n}}var _e={"ima3-click":"ads-click","ima3-started":"ads-ad-started","ima3-complete":"ads-ad-ended","ima3-first-quartile":"ads-first-quartile","ima3-midpoint":"ads-midpoint","ima3-third-quartile":"ads-third-quartile","ima3-volume-changed":"ads-volumechange","ima3-paused":"ads-pause","ima3-resumed":"ads-play","ima3-skipped":"ads-ad-skipped","ima3-all-ads-completed":"ads-allpods-completed","ads-request":"ads-request","ads-pod-ended":"ads-pod-ended","ads-pod-started":"ads-pod-started","ads-load":"ads-load"},Me=function(e,t,a,n){var i=function(a){e.trigger({type:n,emitter:t,originalEvent:a}),ye(e,n);var i=_e[n];if(i){var r={type:i};"ads-ad-started"!==i&&"ads-ad-ended"!==i||(r.indexInBreak=e.ads.ad.index),e.trigger(r)}};return t.addEventListener(a,i,!1),i},Pe=function(e,t,a){var n={},i=t.ima3._eventMapping.eventTypes;for(var r in void 0===a&&(a=Me),i)n[r]=a(t,e,r,i[r]);return function(){for(var t in n)e.removeEventListener(t,n[t])}},be=function(e){return"ima3-"+e.toLowerCase().replace(/_/g,"-")},Re=function e(t,a,n,i,r,o){var d=re(t);return function(){a===n.ViewMode.FULLSCREEN?t.ima3.adsManager.resize(t.el().offsetWidth,t.el().offsetHeight,a):t.ima3.adsManager.resize(d.width,d.height,a),d.width===r&&d.height===o||i>=0&&setTimeout(e(t,a,n,i-1,d.width,d.height),1e3)}},ke=function(e){for(var t=e.textTracks(),a=0;a<t.length;a++)"metadata"===t[a].kind&&"disabled"===t[a].mode&&(t[a].mode="hidden")},Te=function(e){e.on("fullscreenchange",(function(t){var a=r.default.google.ima;i.default.IS_ANY_SAFARI&&ke(e);var n=e.hasClass("vjs-fullscreen");if(e.ima3&&e.ima3.adsManager){var o=n?a.ViewMode.FULLSCREEN:a.ViewMode.NORMAL,d=re(e);o===a.ViewMode.FULLSCREEN?e.ima3.adsManager.resize(e.el().offsetWidth,e.el().offsetHeight,o):e.ima3.adsManager.resize(d.width,d.height,o),setTimeout(Re(e,o,a,3,d.width,d.height),1e3)}})),e.on("playerresize",(function(){if(e.ima3.adsManager){var t=re(e);e.ima3.adsManager.resize(t.width,t.height,r.default.google.ima.ViewMode.NORMAL)}}))},we=function(e,t){var a=e.AdError.ErrorCode;for(var n in a)if(a.hasOwnProperty(n)&&!n.match("COMPANION|NONLINEAR|OVERLAY")&&t.getErrorCode()===a[n]&&"adLoadError"===t.getType())return!0;return!1},Le=function(e){var t=e.ima3.adsManager;ge.isVast(t)?(e.ima3.log("[hardTimeout] Call util.destroyAdsManager for VAST ads."),ge.destroyAdsManager(e),e.trigger("ad-hard-timeout"),e.ima3.log("ima3-hard-timeout")):ge.isVmap(t)&&ge.includesPreroll(t)&&(e.ima3.log("[hardTimeout] Call adsManager.discardAdBreak for VMAP."),e.ima3.adsManager.discardAdBreak(),e.trigger("ad-hard-timeout"),e.ima3.log("ima3-hard-timeout"))},Ie=function(e){e.ima3.adDisplayContainer&&!e.ima3.adDisplayContainer.initialized&&(e.ima3.log("[initializeAdDisplayContainer] Call adDisplayContainer.initialize()."),e.ima3.adDisplayContainer.initialize(),e.ima3.adDisplayContainer.initialized=!0)},Ee=function(e){var t=r.default.google.ima,a=ge.getPlayerDimensions(e);e.ima3.log("[startAdsManager]");try{e.muted()&&e.ima3.adsManager.setVolume(0),Ie(e),e.trigger("ads-load"),e.ima3.log("[startAdsManager] trigger ads-load."),e.ima3.log("[startAdsManager] Call AdsManager.init()."),e.ima3.adsManager.init(a.width,a.height,t.ViewMode.NORMAL),e.ima3.log("[startAdsManager] Call AdsManager.start()."),e.ima3.adsManager.start()}catch(t){e.ima3.log("[startAdsManager] adError caught, trigger adserror."),e.ima3.log.warn("Error starting ads manager",t),e.trigger("adserror")}},Be=function(e){e.ima3.adsManager.discardAdBreak(),e.ima3.adsManager.skip(),e.ima3.managerCleanup=null,e.ads.inAdBreak()&&e.ads.endLinearAdMode()},qe=function(e,t){if(t.ima3SdkSettings)for(var a in t.ima3SdkSettings){var n="set"+a.charAt(0).toUpperCase()+a.slice(1);"function"==typeof e.settings[n]?e.settings[n](t.ima3SdkSettings[a]):i.default.log.warn('Invalid ima3SdkSetting: "'+a+'"')}},De=function(e,t,a){var n=r.default.google.ima,o={};if(e.trigger({type:"ima3-ready",imaSdk:"ondemand"===t.requestMode?n:null}),e.ima3.log("[onSdkLoad]"),function(e){e._eventMapping={},e.settings.eventMap=_e;for(var t=r.default.google.ima,a={},n=["AdErrorEvent","AdEvent","AdsManagerLoadedEvent"],i=n.length;i--;)if(t[n[i]]&&t[n[i]].Type){var o=t[n[i]].Type;for(var d in o)o.hasOwnProperty(d)&&(a[o[d]]=be(d))}e._eventMapping.eventTypes=a}(e.ima3),qe(n,t),t.vpaidMode){if("number"!=typeof n.ImaSdkSettings.VpaidMode[t.vpaidMode])throw new Error('Invalid VPAID Mode: "'+t.vpaidMode+'"');n.settings.setVpaidMode(n.ImaSdkSettings.VpaidMode[t.vpaidMode])}var d=e.el().querySelector(".vjs-tech");e.ima3.log("[onSdkLoad] Create ima.adDisplayContainer."),e.ima3.adDisplayContainer=new n.AdDisplayContainer(a,d,t.clickTrackingElement),e.ima3.adDisplayContainer.initialized=!1;var s="click";if((i.default.browser.IS_IOS||i.default.browser.IS_ANDROID)&&(s="touchend"),e.one(s,(function(){Ie(e)})),e.ima3.log("[onSdkLoad] Create ima.AdsLoader."),e.ima3.adsLoader=new n.AdsLoader(e.ima3.adDisplayContainer),e.ima3.adsLoader){var l=e.ima3.adsLoader.getVersion();e.ima3.log("[onSdkLoad] IMA SDK Version: "+l)}var u=e.ima3.adsLoader.getSettings();u.setPlayerVersion(e.ima3.version),u.setPlayerType("brightcove/player-html5"),e.ima3.loaderCleanup=Pe(e.ima3.adsLoader,e);var c=e.currentSrc();ge.usingMediaCuepoints(t)&&function(e,t,a){e.ima3.log("[handleMediaCuepoints]"),e.ima3._loadstartSeen&&e.ima3.settings.serverUrl&&e.mediainfo?(e.ima3.log("[handleMediaCuepoints] Call createMediaCuepointVmap to set adRequestData.vmap if loadstart was previously seen."),a.vmap=Se(e)):e.ima3.oneUnlessContentUpdate_("loadstart",(function(){e.ima3.log("[handleMediaCuepoints.oneUnlessContentUpdate.player.on] loadstart: Received loadstart event."),setTimeout((function(){e.ima3.settings.serverUrl?(e.ima3.log("[handleMediaCuepoints.oneUnlessContentUpdate_] Call createMediaCuepointVmap to set adRequestData.vmap."),a.vmap=Se(e)):e.ima3.log.error("[handleMediaCuepoints.oneUnlessContentUpdate_] IMA3 serverUrl isnt provided.")}),0)}))}(e,0,o),function(e,t,a){if(e.ima3.log("[handleWaitForLoadstart]"),"ondemand"!==t.requestMode&&!ge.usingLiveAdCuepoints(t)){var n=function(){e.mediainfo&&"FREE"===e.mediainfo.economics?(e.trigger("adscanceled"),e.trigger("nopreroll"),e.trigger("nopostroll")):(e.ima3.log("[handleWaitForLoadstart] Call adsRequest.requestAds with adRequestData.vmap after loadstart."),me.requestAds(e,null,a.vmap))};e.ima3._loadstartSeen?(e.ima3.log("[handleWaitForLoadstart] Call afterLoadStart if loadstart was seen."),n()):e.one("loadstart",(function(){e.ima3.log("[handleWaitForLoadstart.player.on] loadstart: Received loadstart event."),setTimeout((function(){e.ima3.log("[handleWaitForLoadstart.setTimeout] Call afterLoadStart on loadstart event."),n()}),0)}))}}(e,t,o),e.ima3.currentSrc_=e.currentSrc(),e.on("dispose",(function(){e.ima3.log("[onSdkLoad.player.on] dispose: Call destroyAdsManager."),ge.destroyAdsManager(e),i.default._ima3sawDispose=!0})),e.on("contentchanged",(function(){e.ima3.log("[onSdkLoad.player.on] contentchanged: Call handleContentChanged."),function(e,t,a,n){e.ima3.log("[handleContentChanged]"),setTimeout((function(){if(a=e.currentSrc(),e.ima3.log("[handleContentChanged] Call util.destroyAdsManager on contentchanged event."),ge.destroyAdsManager(e),e.ima3._checkedForAdManagerStart=!1,e.ima3.lastSrc_=e.ima3.currentSrc_,e.ima3.currentSrc_=e.currentSrc(),ge.isEconomicsFree(e))return e.trigger("adscanceled"),e.trigger("nopreroll"),void e.trigger("nopostroll");"ondemand"!==t.requestMode?a&&""!==a&&"ondemand"!==t.requestMode&&!ge.usingLiveAdCuepoints(t)&&(e.ima3.log("[handleContentChanged] Call adRequest.requestAds with mediaCuepointsGeneratedVmap= ",n),me.requestAds(e,null,n)):pe(e)}),0)}(e,t,c,o.vmap)}));var g=function(){!function(e){e.ima3&&e.ima3.adsManager&&e.ima3.adsManager.skip&&e.ima3.adsManager.skip(),e.ima3.log("[postrollAdtimeoutHandler] Call util.destroyAdsManager."),ge.destroyAdsManager(e),e.trigger("ad-hard-timeout"),e.ima3.log("ima3-hard-timeout")}(e)};e.on("contentended",(function(){e.ima3.log("[onSdkLoad.player.on] contentended: Call adsLoader.contentComplete."),e.one("adtimeout",g),e.ima3.adsLoader.contentComplete()})),e.on("contentupdate",(function(){e.off("adtimeout",g),e.ima3.log("[onSdkLoad.player.on] contentupdate: Call adsLoader.contentComplete."),e.ima3.adsLoader.contentComplete()})),e.on(["contentupdate","adend","ima3-ready"],(function(){e.ads.ad={},e.ads.pod={}})),e.ima3.el=a},Oe=function(e){var t=e.ima3.adsManager.getCuePoints(),a=t&&t.length>0,n=!(!e.ima3.adsRequest||!e.ima3.adsRequest.adsResponse);return ge.usingMediaCuepoints(e.ima3.settings)&&a&&!n},Ne=function(e,t){e.ima3.log("[onContentPauseRequested]"),"ondemand"===t.requestMode||ge.usingLiveAdCuepoints(t)||(e.ima3.log("[onContentPauseRequested] Call startLinearAdMode if requestmode not ondemand or not usingLiveAdCuepoints."),e.ads.startLinearAdMode()),i.default._ima3sawDispose&&!i.default._ima3adAfterDispose&&(e.trigger({type:"usage",name:"ima3-ad-after-dispose"}),i.default._ima3adAfterDispose=!0)},je=function(e){e.ima3.log("[onContentResumeRequested]"),e.ads.inAdBreak()?(e.ima3.log("[onContentResumeRequested] Call endLinearAdMode if inAdBreak."),e.ads.endLinearAdMode(),e.removeClass("ima3-ad-loading"),e.removeClass("vjs-vpaid-playing"),e.trigger("ads-pod-ended")):(e.ima3.log("[onContentResumeRequested] Call skipLinearAdMode if not inAdBreak."),e.ads.skipLinearAdMode())},Ue=function(e){var t="Non-fatal error occurred";if(e){var a=e.getErrorCode(),n=e.getMessage();a&&(t+=": AdError "+a),n&&(t+=": "+n)}return t},Ve=function(e){e.ima3.log("[onPluginInit]"),e.on("analytics_request",(function(t){e.ima3.log("[onPluginInit.player.on] analytics_request: "+t.params.event+" event triggered.")})),e.on(["ima3-ads-manager-loaded","ima3-ready","ima3-loaded","ima3-impression","ima3-viewable-impression","ima3-started","ima3-first-quartile","ima3-midpoint","ima3-third-quartile","ima3-skippable-state-changed","ima3-complete","ima3-all-ads-completed","ima3-ad-error","ima3-click","ima3-paused","ima3-resumed","ima3-content-pause-requested","ima3-content-resume-requested","ima3-skip","ima3-user-closed","ima3-linear-changed","ima3-ad-buffering","ima3-ad-metadata","ima3-interaction"],(function(t){e.ima3.log("[onPluginInit.player.on] IMA SDK Event "+t.type+" received.")})),e.on("adstart",(function(t){e.ima3.log("[onPluginInit.player.on] adstart: Received adstart event."),e.ads.shouldPlayContentBehindAd(e)||(e.ima3.log("[onPluginInit.player.on] adstart: Pause player if not LIVE and playing content behind ad."),e.pause()),e.hasStarted(!0),e.ima3.currentAdEventInfo={},"oncue"!==e.ima3.settings.requestmode&&e.duration()===1/0&&e.trigger({type:"usage",name:"ima3-live-preroll"})})),e.on("adend",(function(){e.ima3.log("[onPluginInit.player.on] adend: Received adend event."),e.duration()===1/0&&e.trigger("playing")}))},Fe=function(e,t){var a=o.default.createElement("div");a.className="vjs-ima3-ad-container",e.ima3.insertAdContainer(a),e.ima3.adrequest=function(a){fe(a||t.serverUrl,e)},e.on("ima3-content-pause-requested",(function(a){e.ima3.log("[onPlayerReady.player.on] ima3-content-pause-requested: Received ON_CONTENT_PAUSE_REQUESTED event."),Ne(e,t)})),e.on("ima3-content-resume-requested",(function(t){e.ima3.log("[onPlayerReady.player.on] ima3-content-resume-requested: Received ON_CONTENT_RESUME_REQUESTED event."),je(e)})),Te(e),e.on("ima3-started",(function(t){e.ima3.log("[onPlayerReady.player.on] ima3-started: Received STARTED event indicating ad has initiated playback."),e.removeClass("ima3-ad-loading"),e.ima3.log("ima3-started"),e.ima3.currentAd=t.originalEvent.getAd()})),e.on("ima3-log",(function(t){var a=t.originalEvent.getAdData().adError;e.ima3.log("ima3-log:",Ue(a))})),e.on("ima3-ad-error",(function(t){e.ima3.log("[onPlayerReady.player.on] ima3-ad-error: Received AD_ERROR event.");var a,n={};t.originalEvent&&(a=(n=t.originalEvent.getError()).getErrorCode(),e.ima3.log("ima3-ad-error",n.toString()),(we(r.default.google.ima,n)&&"onload"===e.ima3.settings.requestMode||"onplay"===e.ima3.settings.requestMode)&&e.trigger("nopostroll")),e.removeClass("ima3-ad-loading"),e.trigger({type:"adserror",errorCode:a})})),t.hardTimeouts&&e.on("adtimeout",(function(){if(e.ima3.log("[onPlayerReady.player.on] adtimeout: Received adtimeout event"),e.ima3.adsManager)Le(e);else{var t=function(){Le(e)};e.one("ima3-ads-manager-loaded",t),e.one(["adstart","contentupdate","dispose"],(function(a){e.off("ima3-ads-manager-loaded",t)}))}})),e.on("ima3-loaded",(function(t){e.ima3.log("[onPlayerReady.player.on] ima3-loaded: Received LOADED event indicating ad has loaded.");var a=t.originalEvent.getAd();e.ima3.log("[onPlayerReady.player.on] ima3-loaded: Ad",function(e){var t=e.getAdPodInfo();return{id:e.getAdId(),adPodInfo:{adPosition:t.getAdPosition(),isBumper:t.getIsBumper(),maxDuration:t.getMaxDuration(),podIndex:t.getPodIndex(),timeOffset:t.getTimeOffset(),totalAds:t.getTotalAds()},adSystem:e.getAdSystem(),advertiserName:e.getAdvertiserName(),apiFramework:e.getApiFramework(),contentType:e.getContentType(),creativeAdId:e.getCreativeAdId(),creativeId:e.getCreativeId(),dealId:e.getDealId(),description:e.getDescription(),duration:e.getDuration(),height:e.getHeight(),width:e.getWidth(),isLinear:e.isLinear(),mediaUrl:e.getMediaUrl(),minSuggestedDuration:e.getMinSuggestedDuration(),skippable:e.isSkippable(),skipTimeOffSet:e.getSkipTimeOffset(),surveyUrl:e.getSurveyUrl(),title:e.getTitle(),universalAdIdRegistry:e.getUniversalAdIdRegistry(),universalAdIds:e.getUniversalAdIds().map((function(e){return{universalAdRegistry:e.getAdIdRegistry(),universalAdIdValue:e.getAdIdValue()}})),universalAdIdValue:e.getUniversalAdIdValue(),vastMediaBitrate:e.getVastMediaBitrate(),vastMediaHeight:e.getVastMediaHeight(),vastMediaWidth:e.getVastMediaWidth(),wrapperAdIds:e.getWrapperAdIds(),wrapperAdSystems:e.getWrapperAdSystems(),wrapperCreativeIds:e.getWrapperCreativeIds()}}(a)),e.trigger("ads-loading"),e.removeClass("ima3-ad-loading"),a&&!a.isLinear()&&(e.addClass("vjs-ima3-overlay"),e.ima3.log("[onPlayerReady.player.on] ima3-sdk-loaded: Call startLinearAdMode."),e.ads.startLinearAdMode(),e.ima3.log("[onPlayerReady.player.on] imad-sdk-loaded: Call endLinearAdMode."),e.ads.endLinearAdMode())})),e.on("ima3-complete",(function(t){e.ima3.log("[onPlayerReady.player.on] ima3-complete: Received COMPLETED event.");var a=t.originalEvent.getAd();e.ima3.log("ima3-complete"),delete e.ima3.currentAd,a&&(a.isLinear()?e.addClass("ima3-ad-loading"):e.removeClass("vjs-ima3-overlay"))})),e.on(["readyforpreroll","playing"],(function(a){e.ima3.log("[onPlayerReady.player.on] "+a.type+": Received "+a.type+" event"),(!i.default.browser.IS_ANY_SAFARI||"string"!=typeof e.autoplay()||"playing"!==a.type||e.ima3._checkedForAdManagerStart||e.ima3.adsManager)&&(e.ima3._checkedForAdManagerStart||(e.ima3._checkedForAdManagerStart=!0,!e.ima3.adsManager||ge.usingLiveAdCuepoints(t)||"ondemand"===t.requestMode||ge.isEconomicsFree(e)||(e.ima3.log("[onPlayerReady.player.on] "+a.type+": Call startAdsManager for onload or onplay requestmodes."),Ee(e))))})),e.on("adserror",(function(){e.ima3.log("[onPlayerReady.player.on] adserror: Received ADS_ERROR event."),e.ima3.log("[onPlayerReady.player.on] adserror: Call destroyAdsManager"),ge.destroyAdsManager(e)})),e.on("adscanceled",(function(){e.ima3.log("[onPlayerReady.player.on] adscanceled: Received ADS_CANCELED event."),e.ima3.log("[onPlayerReady.player.on] adscanceled: Call destroyAdsManager."),ge.destroyAdsManager(e)})),e.on("ima3-ads-manager-loaded",(function(t){e.ima3.log("[onPlayerReady.player.on] ima-ads-manager-loaded: Received LOADED event."),function(e,t){e.ima3.log("[onAdsManagerLoaded]"),e.ima3.managerCleanup&&(e.ima3.log("[onAdsManagerLoaded] Call destroyAdsManager."),ge.destroyAdsManager(e));var a={currentTime:e.currentTime(),duration:e.duration()};e.on("timeupdate",(function(){a.currentTime=e.currentTime()}));var n=t.originalEvent.getAdsManager(a,e.ima3.adsRenderingSettings_);e.ima3.adsManager=n,e.trigger("ads-response-received");var i=e.ima3.settings;if(Oe(e))return Be(e),void e.ima3.log.error("Cancelling VMAP ad because thead server cannot return a vmap when using cuepoints");e.ima3.managerCleanup=Pe(n,e),"ondemand"===i.requestMode||"oncue"===i.requestMode?(e.ima3.log("[onAdsManagerLoaded] Call startAdsManager if requestMode equals ondemand or oncue."),Ee(e)):e.trigger("adsready"),"oncue"!==i.requestMode&&(ge.includesPreroll(n)||e.trigger("nopreroll"),ge.includesPostroll(n)||e.trigger("nopostroll"))}(e,t)})),i.default.use&&!i.default._imaMiddlewareSetup&&(i.default.log.debug("Setting up IMA middleware"),i.default.use("*",(function(e){return{setSource:function(t,a){if(e&&e.ads&&"function"==typeof e.ads.inAdBreak&&e.ads.inAdBreak()){e.ima3.adsManager.discardAdBreak(),e.ads.disableNextSnapshotRestore=!0,e.ads.endLinearAdMode(),e.trigger("contentresumed");var n=e.play();n&&n.catch&&n.catch((function(){}))}a(null,t)}}})),i.default._imaMiddlewareSetup=!0),r.default.google&&r.default.google.ima?De(e,t,a):ge.loadScript(t.sdkurl,(function(n){if(n)return e.trigger({type:"adserror",error:n});De(e,t,a)}))},xe=/^(file|data):/.test(r.default.location.protocol)?"http:":"",He={sdkurl:xe+"//imasdk.googleapis.com/js/sdkloader/ima3.js",serverUrl:xe+"//pubads.g.doubleclick.net/gampad/ads?sz=400x300&iu=%2F6062%2Fiab_vast_samples&ciu_szs=300x250%2C728x90&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&cust_params=iab_vast_samples%3Dlinear",timeout:4e3,requestMode:"onload",hardTimeouts:!0,showVpaidControls:!1,debug:!1};i.default.ima3={extend:se};var We=function(e){var t=this,a=function(e,t){void 0===t&&(t={});var a=se({},He,t);if(e.ima3.defaults=He,t.useMediaCuePoints&&"oncue"!==t.requestMode)throw new Error('useMediaCuePoints must be used with requestMode "oncue" rather than the currently set '+t.requestMode);return"onplay"===a.requestMode&&e.autoplay()&&(a.requestMode="onload"),a.timeout&&(a.prerollTimeout=a.postrollTimeout=a.timeout),a.contribAdsPrerollTimeout&&(a.prerollTimeout=a.contribAdsPrerollTimeout),a.contribAdsPostrollTimeout&&(a.postrollTimeout=a.contribAdsPostrollTimeout),"function"==typeof e.debug&&e.debug()&&(a.debug=!0),a.debug&&!t.hasOwnProperty("sdkurl")&&(a.sdkurl=xe+"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js"),a.liveCuePoints="oncue"===a.requestMode,a}(this,e);e&&e.hasOwnProperty("asyncAutoplaySupport")&&i.default.log.warn("Brightcove IMA3: The asyncAutoplaySupport option no longer has any effect. We recommend removing it."),!1!==this.autoplay()&&(a.allowVjsAutoplay=!0,this.addClass("vjs-ima3-not-playing-yet"),this.any(["autoplay-success","autoplay-failure"],(function(e){"autoplay-success"!==e.type||t.ima3._adsErrorSeen||t.pause(),t.removeClass("vjs-ima3-not-playing-yet"),t.ima3._autoplayResultEvent=e})),i.default.browser.IS_IOS||i.default.browser.IS_ANDROID||this.addClass("vjs-ima3-autoplay")),a.showVpaidControls||this.addClass("vjs-vpaid-controls-disabled"),this.addClass("vjs-ad-controls"),this.on("ima3-content-pause-requested",(function(e){t.addClass("ima3-ad-loading"),t.trigger("ads-pod-started"),"application/javascript"===e.originalEvent.getAd().getContentType()&&t.addClass("vjs-vpaid-playing")})),this.on(["ima3-complete","ima3-content-resume-requested"],(function(e){var a=t.getChild("ControlBar"),n=a.getChild("ProgressControl").getChild("SeekBar").getChild("PlayProgressBar");a.removeClass("vjs-ad-control-bar"),n.hasClass("vjs-play-progress-resetting")||n.addClass("vjs-play-progress-resetting"),n.el().style.width="0"})),this.on("ima3-started",(function(e){var a=t.getChild("ControlBar"),n=a.getChild("ProgressControl").getChild("SeekBar").getChild("PlayProgressBar");n.el().style.width="0",a.hasClass("vjs-ad-control-bar")||a.addClass("vjs-ad-control-bar"),n.removeClass("vjs-play-progress-resetting")})),this.on("ima3-ad-progress",(function(){t.trigger("timeupdate")})),this.on("adserror",(function(){t.ima3._adsErrorSeen=!0})),this.on(["dispose","contentchanged"],(function(){var e;(e=t).ima3._loadstartSeen=!1,e.ima3._playSeen=!1,e.ima3._adsErrorSeen=!1,e.ima3._autoplayResultEvent=void 0,void 0!==e.ima3._requestAdsOnPlay&&e.off("play",e.ima3._requestAdsOnPlay)})),this.on("loadstart",(function(){t.ima3._loadstartSeen=!0})),this.on("play",(function(){t.ima3._playSeen=!0})),this.on("contentchanged",(function(){t.pause(),t.ads.settings.allowVjsAutoplay=!1,t.ima3._contentchangedSeen=!0})),this.ads(a),this.ads.ad={},this.ads.pod={id:void 0,size:void 0},this.contribAds6Shim(i.default.mergeOptions({},a.contribAds6Shim||{})),"oncue"===a.requestMode?Z.init(this,a):"ondemand"===a.requestMode&&pe(this),this.ima3=function(e,t){var a=e.el().querySelector(".vjs-tech"),n=e.log.createLogger("IMA3"),i={readyQueue_:[],isReady_:!1,player:e,tech:a,settings:t,ready:function(t){return t&&(e.ima3.isReady_?t.call(e):(void 0===e.ima3.readyQueue_&&(e.ima3.readyQueue_=[]),e.ima3.readyQueue_.push(t))),e.ima3},adMacroReplacement:function(t){return Ae(e,t)},insertAdContainer:function(t){!function(e,t){var a=e.el().querySelector(".vjs-big-play-button");e.el().insertBefore(t,a)}(e,t)},currentAdEventInfo:{},addToCurrentAdEventInfo:function(t,a){ve(e,t,a)},setAdsRenderingSettings:function(t){!function(e,t){e.ima3.adsRenderingSettings_=t,e.ima3.adsManager&&e.ima3.adsManager.updateAdsRenderingSettings(t)}(e,t)},log:n,toggleLogger:function(e){e?(n.level("debug"),n.history.enable()):(n.level("warn"),n.history.disable())},oneHandlers_:[],oneUnlessContentUpdate_:function(t,a){!function(e,t,a){e.ima3.oneHandlers_.push({type:t,handler:a}),e.one(t,a)}(e,t,a)},isVpaid:function(){return ue(e.ima3.currentAd)},version:Ce,VERSION:Ce};return e.on("contentupdate",(function(){for(var t=e.ima3.oneHandlers_,a=0;a<t.length;a++){var n=t[a];e.off(n.type,n.handler)}e.ima3.oneHandlers_=[]})),e.on("ima3-ready",(function(){e.ima3.isReady_=!0;for(var t=0;t<e.ima3.readyQueue_.length;t++)e.ima3.readyQueue_[t].call(e);e.ima3.readyQueue_=[]})),i.toggleLogger(t.debug),e.on("debugon",(function(){return e.ima3.toggleLogger(!0)})),e.on("debugoff",(function(){return e.ima3.toggleLogger(!1)})),i}(this,a),Ve(this),this.ready((function(){var e=i.default.getTech("Html5");if(!e||!e.isSupported())throw new Error("Html5 is not available on this platform.");Fe(t,a),t.addClass("vjs-ima3-html5")}),!0)};We.version=Ce,We.VERSION=Ce,function(e){if(ie("ima3"))return!1;var t=ie("ads");(function(e,t){var a=te(e),n=t?te(t):ne;return!(!n||!a||a[0]!==n[0]||a[1]<n[1]||!(a[1]>n[1]||a[2]>=n[2]))})(t.VERSION)||i.default.log.error('The IMA plugin depends on contrib-ads version "'+ne+'", but it saw version "'+t.VERSION+'". This is not a compatible configuration. The IMA plugin will attempt to continue initializing, but this problem should be addressed. If you are using ad failover, please select compatible versions of the SSAI and IMA plugins.'),i.default.use("*",ee),(i.default.registerPlugin||i.default.plugin)("ima3",e)}(We)}));
